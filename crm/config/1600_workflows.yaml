workflows:
  CRM-Contact-SetLabel:
    enabled: true
    meta:
      name: CRM - Contact - Set Label
      visual: null
      description: Set label for contact record
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
            id: "23"
            xywh:
              - 2360
              - 2280
              - 200
              - 80
            value: Check if First/Last name exists
            parent: "1"
          description: ""
        stepID: "23"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "41"
            xywh:
              - 2840
              - 2120
              - 200
              - 80
            value: Assign record.values.RecordLabel
            parent: "1"
          description: ""
        stepID: "41"
        results: []
        arguments:
          - expr: record.values.FirstName + ' ' + record.values.LastName
            type: String
            target: record.values.RecordLabel
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "43"
            xywh:
              - 2840
              - 2280
              - 200
              - 80
            value: Assign record.values.RecordLabel
            parent: "1"
          description: ""
        stepID: "43"
        results: []
        arguments:
          - expr: record.values.FirstName
            type: String
            target: record.values.RecordLabel
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "45"
            xywh:
              - 2840
              - 2440
              - 200
              - 80
            value: Assign record.values.RecordLabel
            parent: "1"
          description: ""
        stepID: "45"
        results: []
        arguments:
          - expr: record.values.LastName
            type: String
            target: record.values.RecordLabel
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "74"
            xywh:
              - 3160
              - 2280
              - 200
              - 80
            value: Check if related Account exists
            parent: "1"
          description: ""
        stepID: "74"
        results: []
        arguments: []
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "76"
            xywh:
              - 3560
              - 2280
              - 200
              - 80
            value: null
            parent: "1"
          description: ""
        stepID: "76"
        results: []
        arguments: []
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "78"
            xywh:
              - 3160
              - 2440
              - 200
              - 80
            value: Get related Account
            parent: "1"
          description: ""
        stepID: "78"
        results:
          - expr: record
            target: accountRecord
        arguments:
          - type: Handle
            value: Account
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.values.AccountId
            type: ID
            target: record
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "85"
            xywh:
              - 3160
              - 2600
              - 200
              - 80
            value: If related Account has AccountName
            parent: "1"
          description: ""
        stepID: "85"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "86"
            xywh:
              - 3160
              - 2760
              - 200
              - 80
            value: Add AccountName to RecordLabel
            parent: "1"
          description: ""
        stepID: "86"
        results: []
        arguments:
          - expr: record.values.RecordLabel + " (" + accountRecord.values.AccountName +")"
            type: String
            target: record.values.RecordLabel
    paths:
      - expr: '(record.values.FirstName ? true : false) && (record.values.LastName ? true : false)'
        meta:
          name: ""
          visual:
            id: "42"
            style: exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - FirstName & LastName'
            parent: "1"
            points: []
          description: ""
        childID: "41"
        parentID: "23"
      - expr: 'record.values.FirstName ? true : false'
        meta:
          name: ""
          visual:
            id: "44"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Only FirstName '
            parent: "1"
            points:
              - x: 2712
                "y": 2320
              - x: 2712
                "y": 2320
          description: ""
        childID: "43"
        parentID: "23"
      - expr: 'record.values.LastName ? true : false'
        meta:
          name: ""
          visual:
            id: "46"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#3 - Only LastName'
            parent: "1"
            points: []
          description: ""
        childID: "45"
        parentID: "23"
      - expr: '(record.values.AccountId  ? true : false)'
        meta:
          name: ""
          visual:
            id: "79"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "78"
        parentID: "74"
      - meta:
          name: ""
          visual:
            id: "80"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "76"
        parentID: "74"
      - expr: '(accountRecord.values.AccountName ? true : false)'
        meta:
          name: ""
          visual:
            id: "87"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "86"
        parentID: "85"
      - meta:
          name: ""
          visual:
            id: "89"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points:
              - x: 3660
                "y": 2640
          description: ""
        childID: "76"
        parentID: "85"
      - meta:
          name: ""
          visual:
            id: "90"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "74"
        parentID: "41"
      - meta:
          name: ""
          visual:
            id: "91"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "74"
        parentID: "43"
      - meta:
          name: ""
          visual:
            id: "92"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "74"
        parentID: "45"
      - meta:
          name: ""
          visual:
            id: "93"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "85"
        parentID: "78"
    triggers:
      - resourceType: compose:record
        eventType: beforeCreate
        constraints:
          - op: =
            name: module
            values:
              - Contact
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 23
        meta:
          visual:
            id: "2"
            xywh:
              - 2080
              - 2280
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "39"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "23"
                parentID: "2"
            value: Create Contact
            parent: "1"
          description: ""
  CRM-Case-InformContact:
    enabled: true
    meta:
      name: CRM - Case - Inform Contact
      visual: null
      description: Inform the contact via email of the Case solution
    steps:
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 3360
              - 2760
              - 200
              - 80
            value: Send Email
            parent: "1"
          description: ""
        stepID: "13"
        results: []
        arguments:
          - expr: '"Corteza - Case: " + record.values.CaseNumber + " - " + record.values.Subject'
            type: String
            target: subject
          - expr: record.values.SuppliedEmail
            type: String
            target: to
          - expr: emailRow1 + emailRow2 + emailRow3
            type: String
            target: html
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 3120
              - 2760
              - 200
              - 80
            value: Prepare Email body
            parent: "1"
          description: ""
        stepID: "17"
        results: []
        arguments:
          - expr: '"<h1>Solution of case: " + record.values.CaseNumber + " - " + record.values.Subject + "<br>"'
            type: String
            target: emailRow1
          - expr: '"<strong>Solution Title:</strong> " + (record.values.SolutionName ? record.values.SolutionName : "/") + "<br>"'
            type: String
            target: emailRow2
          - expr: '"<strong>Solution Details:</strong> " + (record.values.SolutionNote? record.values.SolutionNote: "/") + "<br>"'
            type: Any
            target: emailRow3
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2720
              - 2600
              - 200
              - 80
            value: 'Warning: Not Closed'
            parent: "1"
          description: ""
        stepID: "20"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: You can only inform the client of a solution when the case status is "Closed".
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2720
              - 2760
              - 200
              - 80
            value: Check if Closed and has Email
            parent: "1"
          description: ""
        stepID: "21"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 2720
              - 2920
              - 200
              - 80
            value: 'Warning: No Email'
            parent: "1"
          description: ""
        stepID: "24"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: There is no supplied email. Please fill in an email address in the "Contact Email" field
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "27"
            xywh:
              - 3600
              - 2760
              - 200
              - 80
            value: הצלחה
            parent: "1"
          description: ""
        stepID: "27"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: The case solution has been sent via email
            target: message
          - type: String
            value: הצלחה
            target: variant
    paths:
      - meta:
          name: ""
          visual:
            id: "19"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "13"
        parentID: "17"
      - expr: record.values.Status != "Closed"
        meta:
          name: ""
          visual:
            id: "23"
            style: exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: '#1 - If Status not "Closed"'
            parent: "1"
            points: []
          description: ""
        childID: "20"
        parentID: "21"
      - expr: 'record.values.SuppliedEmail ? false : true'
        meta:
          name: ""
          visual:
            id: "25"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - If no SuppliedEmail'
            parent: "1"
            points: []
          description: ""
        childID: "24"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "26"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#3 - Else'
            parent: "1"
            points: []
          description: ""
        childID: "17"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "28"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "27"
        parentID: "13"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.name
            values:
              - Case
          - op: =
            name: namespace.name
            values:
              - crm
        enabled: true
        stepID: 21
        meta:
          visual:
            id: "2"
            xywh:
              - 2480
              - 2760
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "22"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "21"
                parentID: "2"
            value: Manual
            parent: "1"
          description: ""
  CRM-Solution-InsertNumber:
    enabled: true
    meta:
      name: CRM - Solution - Insert Number
      visual: null
      description: Sets the solution number based on the settings
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2080
              - 200
              - 80
            value: Get Settings
            parent: "1"
          description: ""
        stepID: "3"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2960
              - 2080
              - 200
              - 80
            value: Set SolutionNumber
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments:
          - expr: 'settings.values.SolutionNextNumber ? settings.values.SolutionNextNumber : 0'
            type: Integer
            target: nextSolutionNumber
          - expr: nextSolutionNumber
            type: Integer
            target: record.values.SolutionNumber
          - expr: nextSolutionNumber + 1
            type: Integer
            target: settings.values.SolutionNextNumber
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2960
              - 2240
              - 200
              - 80
            value: Save Settings
            parent: "1"
          description: ""
        stepID: "7"
        results: []
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2560
              - 2080
              - 200
              - 80
            value: Check if has number
            parent: "1"
          description: ""
        stepID: "11"
        results: []
        arguments: []
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2560
              - 2240
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        stepID: "14"
        results: []
        arguments: []
    paths:
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "5"
      - expr: 'record.values.SolutionNumber ? false : true'
        meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - No Number'
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "11"
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "11"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "15"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Has number'
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "11"
    triggers:
      - resourceType: compose:record
        eventType: beforeCreate
        constraints:
          - op: =
            name: module.handle
            values:
              - Solution
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2080
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Solution Before Create Solution
            parent: "1"
          description: ""
  CRM-Account-CreateNewOpportunity:
    enabled: true
    meta:
      name: CRM - Account - Create New Opportunity
      visual: null
      description: Creates new Opportunity record from an existing Account
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2400
              - 2080
              - 200
              - 80
            value: Get Settings
            parent: "1"
          description: ""
        stepID: "3"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "55"
            xywh:
              - 2400
              - 2200
              - 200
              - 80
            value: Get Contacts
            parent: "1"
          description: ""
        stepID: "55"
        results:
          - expr: records
            target: contacts
          - expr: total
            target: numOfContacts
        arguments:
          - type: Handle
            value: Contact
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"AccountId = " + record.recordID + " AND IsPrimary"'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 2400
              - 2320
              - 200
              - 80
            value: Check for contact
            parent: "1"
          description: ""
        stepID: "61"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 2400
              - 2480
              - 200
              - 80
            value: Set contact
            parent: "1"
          description: ""
        stepID: "66"
        results: []
        arguments:
          - expr: contacts[0]
            type: ComposeRecord
            target: contact
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "81"
            xywh:
              - 2680
              - 2080
              - 200
              - 80
            value: Make Opportunity
            parent: "1"
          description: ""
        stepID: "81"
        results:
          - expr: record
            target: opportunity
        arguments:
          - type: Handle
            value: Opportunity
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "83"
            xywh:
              - 2680
              - 2200
              - 200
              - 80
            value: Set Opportunity values
            parent: "1"
          description: ""
        stepID: "83"
        results: []
        arguments:
          - expr: '"(unnamed)"'
            type: String
            target: opportunity.values.Name
          - expr: record.recordID
            type: ID
            target: opportunity.values.AccountId
          - expr: "false"
            type: Boolean
            target: opportunity.values.IsClosed
          - expr: "false"
            type: Boolean
            target: opportunity.values.IsWon
          - expr: modMonth(now(), 1)
            type: DateTime
            target: opportunity.values.CloseDate
          - expr: settings.values.OpportunityProbability
            type: Integer
            target: opportunity.values.Probability
          - expr: settings.values.OpportunityForecaseCategory
            type: String
            target: opportunity.values.ForecastCategory
          - expr: settings.values.OpportunityStagename
            type: String
            target: opportunity.values.StageName
          - expr: opportunity.values.OwnerId
            type: ID
            target: opportunity.values.OwnerId
          - expr: 'record.values.CampaignId ? record.values.CampaignId : []'
            type: Array
            target: opportunity.values.CampaignId
          - expr: record.values.AccountSource
            type: String
            target: opportunity.values.LeadSource
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "86"
            xywh:
              - 2680
              - 2320
              - 200
              - 80
            value: Save Opportunity
            parent: "1"
          description: ""
        stepID: "86"
        results:
          - expr: record
            target: opportunity
        arguments:
          - expr: opportunity
            type: ComposeRecord
            target: record
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "88"
            xywh:
              - 2960
              - 2080
              - 200
              - 80
            value: Make OpportunityContactRole
            parent: "1"
          description: ""
        stepID: "88"
        results:
          - expr: record
            target: opportunityContactRole
        arguments:
          - type: Handle
            value: OpportunityContactRole
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "89"
            xywh:
              - 2960
              - 2192
              - 200
              - 80
            value: Set OpportunityContactRolevalues
            parent: "1"
          description: ""
        stepID: "89"
        results: []
        arguments:
          - expr: contact.recordID
            type: ID
            target: opportunityContactRole.values.ContactId
          - expr: opportunity.recordID
            type: ID
            target: opportunityContactRole.values.OpportunityId
          - expr: "true"
            type: Boolean
            target: opportunityContactRole.values.IsPrimary
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "91"
            xywh:
              - 2960
              - 2320
              - 200
              - 80
            value: Save OpportunityContactRole
            parent: "1"
          description: ""
        stepID: "91"
        results:
          - expr: record
            target: opportunity
        arguments:
          - expr: opportunity
            type: ComposeRecord
            target: record
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "103"
            xywh:
              - 3240
              - 2080
              - 200
              - 80
            value: Show success
            parent: "1"
          description: ""
        stepID: "103"
        results: []
        arguments:
          - expr: '"Success"'
            type: String
            target: title
          - expr: '"The new opportunity has been created."'
            type: String
            target: message
          - type: String
            value: הצלחה
            target: variant
          - expr: "true"
            type: Boolean
            target: sticky
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "105"
            xywh:
              - 3240
              - 2200
              - 200
              - 80
            value: Go to editor
            parent: "1"
          description: ""
        stepID: "105"
        results: []
        arguments:
          - type: Handle
            value: Opportunity
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: opportunity
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "107"
            xywh:
              - 2120
              - 2480
              - 200
              - 80
            value: Show warning
            parent: "1"
          description: ""
        stepID: "107"
        results: []
        arguments:
          - expr: '"Warning"'
            type: String
            target: title
          - expr: '"The primary contact is not defined"'
            type: String
            target: message
          - type: String
            value: אזהרה
            target: variant
          - expr: "true"
            type: Boolean
            target: sticky
    paths:
      - expr: numOfContacts > 0
        meta:
          name: ""
          visual:
            id: "67"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has contact'
            parent: "1"
            points: []
          description: ""
        childID: "66"
        parentID: "61"
      - meta:
          name: ""
          visual:
            id: "85"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "81"
        parentID: "66"
      - meta:
          name: ""
          visual:
            id: "90"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "89"
        parentID: "88"
      - meta:
          name: ""
          visual:
            id: "92"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "91"
        parentID: "89"
      - meta:
          name: ""
          visual:
            id: "93"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "88"
        parentID: "86"
      - meta:
          name: ""
          visual:
            id: "104"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "103"
        parentID: "91"
      - meta:
          name: ""
          visual:
            id: "108"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - No Contact'
            parent: "1"
            points: []
          description: ""
        childID: "107"
        parentID: "61"
      - meta:
          name: ""
          visual:
            id: "109"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "105"
        parentID: "103"
      - meta:
          name: ""
          visual:
            id: "112"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "86"
        parentID: "83"
      - meta:
          name: ""
          visual:
            id: "116"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "83"
        parentID: "81"
      - meta:
          name: ""
          visual:
            id: "117"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "55"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "120"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "61"
        parentID: "55"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Account
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2120
              - 2080
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "34"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Account
            parent: "1"
          description: ""
  CRM-Case-SetStatusToClosed:
    enabled: true
    meta:
      name: CRM - Case - Set Status To Closed
      visual: null
      description: Sets status of Case record to "Closed"
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 360
              - 40
              - 200
              - 80
            value: Check if Case Closed
            parent: "19"
          description: ""
        stepID: "3"
        results: []
        arguments: []
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 760
              - 40
              - 200
              - 80
            value: Check for Solution
            parent: "19"
          description: ""
        stepID: "7"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 1160
              - 40
              - 200
              - 80
            value: Update status
            parent: "19"
          description: ""
        stepID: "11"
        results: []
        arguments:
          - expr: now()
            type: DateTime
            target: record.values.ClosedDate
          - expr: '"Closed"'
            type: String
            target: record.values.Status
          - expr: "true"
            type: Boolean
            target: record.values.IsClosed
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 1160
              - 200
              - 200
              - 80
            value: Make Update
            parent: "19"
          description: ""
        stepID: "13"
        results:
          - expr: record
            target: caseUpdate
        arguments:
          - type: Handle
            value: CaseUpdate
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 1440
              - 40
              - 200
              - 80
            value: Set Update values
            parent: "19"
          description: ""
        stepID: "15"
        results: []
        arguments:
          - expr: '"State set to \"Closed\""'
            type: String
            target: caseUpdate.values.Description
          - expr: '"State change"'
            type: String
            target: caseUpdate.values.Type
          - expr: record.recordID
            type: ID
            target: caseUpdate.values.CaseId
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 1440
              - 200
              - 200
              - 80
            value: Save Update
            parent: "19"
          description: ""
        stepID: "17"
        results:
          - expr: record
            target: caseUpdate
        arguments:
          - expr: caseUpdate
            type: ComposeRecord
            target: record
      - ref: swimlane
        kind: visual
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 1960
              - 1920
              - 1680
              - 320
            value: Prepare and create Case Update
            parent: "1"
          description: ""
        stepID: "19"
        results: []
        arguments: []
      - ref: swimlane
        kind: visual
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 1960
              - 2320
              - 1440
              - 320
            value: Handle Existing Solution
            parent: "1"
          description: ""
        stepID: "20"
        results: []
        arguments: []
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 80
              - 40
              - 200
              - 80
            value: Check for Solution
            parent: "20"
          description: ""
        stepID: "21"
        results: []
        arguments: []
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 80
              - 200
              - 200
              - 80
            value: Get Solution
            parent: "20"
          description: ""
        stepID: "23"
        results:
          - expr: record
            target: solution
        arguments:
          - type: Handle
            value: Solution
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.values.SolutionId
            type: ID
            target: record
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2600
              - 2360
              - 200
              - 80
            value: Check SubmitAsSolution
            parent: "1"
          description: ""
        stepID: "26"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 360
              - 200
              - 200
              - 80
            value: Update record
            parent: "20"
          description: ""
        stepID: "28"
        results: []
        arguments:
          - expr: solution.values.SolutionName
            type: String
            target: record.values.SolutionName
          - expr: solution.values.SolutionNote
            type: String
            target: record.values.SolutionNote
          - expr: solution.values.File
            type: Array
            target: record.values.SolutionFile
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "30"
            xywh:
              - 2600
              - 2520
              - 200
              - 80
            value: Save record
            parent: "1"
          description: ""
        stepID: "30"
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
      - ref: swimlane
        kind: visual
        meta:
          name: ""
          visual:
            id: "34"
            xywh:
              - 1960
              - 2720
              - 1440
              - 160
            value: Create Solution
            parent: "1"
          description: ""
        stepID: "34"
        results: []
        arguments: []
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "35"
            xywh:
              - 3160
              - 2360
              - 200
              - 80
            value: Get Settings
            parent: "1"
          description: ""
        stepID: "35"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 1200
              - 200
              - 200
              - 80
            value: Set nextSolutionNumber
            parent: "20"
          description: ""
        stepID: "38"
        results: []
        arguments:
          - expr: 'settings.values.SolutionNextNumber ? settings.values.SolutionNextNumber : 0'
            type: Integer
            target: nextSolutionNumber
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "40"
            xywh:
              - 80
              - 40
              - 200
              - 80
            value: Make Solution
            parent: "34"
          description: ""
        stepID: "40"
        results:
          - expr: record
            target: solution
        arguments:
          - type: Handle
            value: Solution
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "42"
            xywh:
              - 360
              - 40
              - 200
              - 80
            value: Set Solution Values
            parent: "34"
          description: ""
        stepID: "42"
        results: []
        arguments:
          - expr: record.values.SolutionName
            type: String
            target: solution.values.SolutionName
          - expr: record.values.SolutionNote
            type: String
            target: solution.values.SolutionNote
          - expr: record.values.SolutionFile
            type: ID
            target: solution.values.File
          - expr: '"New"'
            type: String
            target: solution.values.Status
          - expr: "true"
            type: Boolean
            target: solution.values.IsPublished
          - expr: record.recordID
            type: ID
            target: solution.values.CaseId
          - expr: nextSolutionNumber
            type: Integer
            target: solution.values.SolutionNumber
          - expr: record.values.ProductId
            type: ID
            target: solution.values.ProductId
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "44"
            xywh:
              - 640
              - 40
              - 200
              - 80
            value: Save Solution
            parent: "34"
          description: ""
        stepID: "44"
        results:
          - expr: record
            target: solution
        arguments:
          - expr: solution
            type: ComposeRecord
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "46"
            xywh:
              - 920
              - 40
              - 200
              - 80
            value: Set SolutionNextNumber
            parent: "34"
          description: ""
        stepID: "46"
        results: []
        arguments:
          - expr: settings.values.SolutionNextNumber + 1
            type: Integer
            target: settings.values.SolutionNextNumber
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "48"
            xywh:
              - 1200
              - 40
              - 200
              - 80
            value: Save Settings
            parent: "34"
          description: ""
        stepID: "48"
        results:
          - expr: record
            target: settings
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "51"
            xywh:
              - 360
              - 200
              - 200
              - 80
            value: 'Warning: This case is already closed'
            parent: "19"
          description: ""
        stepID: "51"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: This case is already closed
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "62"
            xywh:
              - 760
              - 200
              - 200
              - 80
            value: 'Warning: Unable to close the case. Please add a solution name or select an existing solution before closing the case.'
            parent: "19"
          description: ""
        stepID: "62"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Unable to close the case. Please add a solution name or select an existing solution before closing the case
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 920
              - 200
              - 200
              - 80
            value: Refresh page
            parent: "20"
          description: ""
        stepID: "63"
        results: []
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
    paths:
      - expr: record.values.Status == "Closed"
        meta:
          name: ""
          visual:
            id: "6"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Yes'
            parent: "19"
            points: []
          description: ""
        childID: "51"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No'
            parent: "19"
            points: []
          description: ""
        childID: "7"
        parentID: "3"
      - expr: '(record.values.SolutionName ? false : true) &&  (record.values.SolutionId ? false : true) && (record.values.SubmitAsSolution ? false : true)'
        meta:
          name: ""
          visual:
            id: "10"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - No'
            parent: "19"
            points: []
          description: ""
        childID: "62"
        parentID: "7"
      - meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Yes'
            parent: "19"
            points: []
          description: ""
        childID: "11"
        parentID: "7"
      - meta:
          name: ""
          visual:
            id: "14"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "19"
            points: []
          description: ""
        childID: "13"
        parentID: "11"
      - meta:
          name: ""
          visual:
            id: "16"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "19"
            points: []
          description: ""
        childID: "15"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "18"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "19"
            points: []
          description: ""
        childID: "17"
        parentID: "15"
      - meta:
          name: ""
          visual:
            id: "22"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "17"
      - expr: record.values.SolutionId
        meta:
          name: ""
          visual:
            id: "24"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Solution'
            parent: "20"
            points: []
          description: ""
        childID: "23"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "20"
            points: []
          description: ""
        childID: "28"
        parentID: "23"
      - meta:
          name: ""
          visual:
            id: "31"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "30"
        parentID: "28"
      - expr: 'record.values.SubmitAsSolution ? true : false'
        meta:
          name: ""
          visual:
            id: "36"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "35"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "30"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "38"
        parentID: "35"
      - meta:
          name: ""
          visual:
            id: "41"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "40"
        parentID: "38"
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "34"
            points: []
          description: ""
        childID: "42"
        parentID: "40"
      - meta:
          name: ""
          visual:
            id: "45"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "34"
            points: []
          description: ""
        childID: "44"
        parentID: "42"
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "34"
            points: []
          description: ""
        childID: "46"
        parentID: "44"
      - meta:
          name: ""
          visual:
            id: "49"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "34"
            points: []
          description: ""
        childID: "48"
        parentID: "46"
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points:
              - x: 3260
                "y": 2704
              - x: 2700
                "y": 2704
          description: ""
        childID: "30"
        parentID: "48"
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "63"
        parentID: "30"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Case
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 80
              - 40
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "58"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "19"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Case
            parent: "19"
          description: ""
  CRM-Quote-ApplyTermBooks:
    enabled: true
    meta:
      name: CRM - Quote - Apply Term Books
      visual: null
      description: ""
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2400
              - 1920
              - 200
              - 80
            value: Set termbooks ids
            parent: "1"
            defaultName: false
          description: ""
        stepID: "4"
        results: []
        arguments:
          - expr: record.values.TermbookIds
            type: Array
            target: termbookIds
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2680
              - 1920
              - 200
              - 80
            value: Check Termbook Ids
            parent: "1"
            defaultName: false
          description: ""
        stepID: "8"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 3120
              - 1920
              - 200
              - 80
            value: 'Warning: no termbooks'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "12"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: נא לבחור לפחות ספר תנאים אחד
            target: message
          - type: String
            value: warning
            target: variant
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 2120
              - 2080
              - 200
              - 80
            value: Iterate term books
            parent: "1"
            defaultName: false
          description: ""
        stepID: "13"
        results:
          - expr: item
            target: termbookId
        arguments:
          - expr: termbookIds
            type: Array
            target: items
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2120
              - 2480
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "16"
        results: []
        arguments: []
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 2120
              - 2280
              - 200
              - 80
            value: Add items to quote
            parent: "1"
            defaultName: false
          description: ""
        stepID: "24"
        results:
          - expr: record
            target: TermbookEntry
        arguments:
          - type: Handle
            value: TermbookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"TermbookId = " + termbookId'
            type: String
            target: query
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 3408
              - 2280
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "28"
        results: []
        arguments: []
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "31"
            xywh:
              - 2520
              - 2280
              - 200
              - 80
            value: 'Prepare quote term '
            parent: "1"
            defaultName: false
          description: ""
        stepID: "31"
        results:
          - expr: record
            target: QuoteTermItem
        arguments:
          - type: Handle
            value: QuoteTermItem
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "32"
            xywh:
              - 2800
              - 2280
              - 200
              - 80
            value: Set quote term item fields
            parent: "1"
            defaultName: false
          description: ""
        stepID: "32"
        results: []
        arguments:
          - expr: TermbookEntry.values.Name
            type: String
            target: QuoteTermItem.values.Name
          - expr: TermbookEntry.values.Description
            type: Array
            target: QuoteTermItem.values.Description
          - expr: record.recordID
            type: ID
            target: QuoteTermItem.values.QuoteId
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "35"
            xywh:
              - 3080
              - 2280
              - 200
              - 80
            value: Save quote term item
            parent: "1"
            defaultName: false
          description: ""
        stepID: "35"
        results:
          - expr: record
            target: QuoteTermItem
        arguments:
          - expr: QuoteTermItem
            type: ComposeRecord
            target: record
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "39"
            xywh:
              - 2120
              - 2640
              - 200
              - 80
            value: הצלחה
            parent: "1"
            defaultName: false
          description: ""
        stepID: "39"
        results: []
        arguments:
          - type: String
            value: ספרי תנאים יושמו
            target: title
          - type: String
            value: כל התנאים מספרי התנאים שנבחרו יובאו להצעה
            target: message
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "42"
            xywh:
              - 2400
              - 2640
              - 200
              - 80
            value: redirect to quote edit page
            parent: "1"
            defaultName: false
          description: ""
        stepID: "42"
        results: []
        arguments:
          - type: Handle
            value: Quote
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
    paths:
      - meta:
          name: ""
          visual:
            id: "7"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "8"
        parentID: "4"
      - expr: count(termbookIds) != 0
        meta:
          name: ""
          visual:
            id: "9"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Termbooks'
            parent: "1"
            points: []
          description: ""
        childID: "13"
        parentID: "8"
      - meta:
          name: ""
          visual:
            id: "11"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No termbooks'
            parent: "1"
            points: []
          description: ""
        childID: "12"
        parentID: "8"
      - meta:
          name: ""
          visual:
            id: "15"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "24"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "31"
        parentID: "24"
      - meta:
          name: ""
          visual:
            id: "33"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "32"
        parentID: "31"
      - meta:
          name: ""
          visual:
            id: "36"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "35"
        parentID: "32"
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "28"
        parentID: "35"
      - meta:
          name: ""
          visual:
            id: "38"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "24"
      - meta:
          name: ""
          visual:
            id: "41"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "39"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "42"
        parentID: "39"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 4
        meta:
          visual:
            id: "3"
            xywh:
              - 2120
              - 1920
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "6"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "4"
                parentID: "3"
            value: On manual Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-SendToPriContact:
    enabled: true
    meta:
      name: CRM - Quote - Send To Pri Contact
      visual: null
      description: Send this Quote via email to the primary contact
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2040
              - 200
              - 80
            value: Check recipient
            parent: "1"
          description: ""
        stepID: "3"
        results: []
        arguments: []
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2680
              - 2040
              - 200
              - 80
            value: Get LineItems
            parent: "1"
          description: ""
        stepID: "6"
        results:
          - expr: records
            target: lineItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2960
              - 2360
              - 200
              - 80
            value: Send Mail
            parent: "1"
          description: ""
        stepID: "11"
        results: []
        arguments:
          - expr: '"Corteza - Quote: " + record.values.QuoteNumber + " - " + record.values.Name'
            type: String
            target: subject
          - expr: record.values.Email
            type: String
            target: to
          - expr: html.document
            type: Reader
            target: html
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 2320
              - 2200
              - 200
              - 80
            value: 'אזהרה: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי.'
            parent: "1"
          description: ""
        stepID: "15"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2960
              - 2520
              - 200
              - 80
            value: 'הצלחה: הצעת המחיר נשלחה במייל'
            parent: "1"
          description: ""
        stepID: "16"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נשלחה במייל
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2960
              - 2200
              - 200
              - 80
            value: Quote to HTML
            parent: "1"
          description: ""
        stepID: "19"
        results:
          - expr: document
            target: html
        arguments:
          - type: Handle
            value: quote
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "31"
            xywh:
              - 2960
              - 2040
              - 200
              - 80
            value: Set Render Variables
            parent: "1"
          description: ""
        stepID: "31"
        results: []
        arguments:
          - type: Vars
            target: renderVariables
          - expr: record
            type: ComposeRecord
            target: renderVariables.quote
          - expr: lineItems
            type: Array
            target: renderVariables.lineItems
    paths:
      - expr: 'record.values.Email ? true : false'
        meta:
          name: ""
          visual:
            id: "7"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Yes'
            parent: "1"
            points: []
          description: ""
        childID: "6"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - No'
            parent: "1"
            points: []
          description: ""
        childID: "15"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "14"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "11"
      - meta:
          name: ""
          visual:
            id: "21"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "11"
        parentID: "19"
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "31"
        parentID: "6"
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: null
          description: ""
        childID: "19"
        parentID: "31"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Quote
            parent: "1"
          description: ""
  CRM-Quote-SendToCustomEmail:
    enabled: true
    meta:
      name: CRM - Quote - Send To Custom Email
      visual: null
      description: Sends quote email to custom address
    steps:
      - ref: input
        kind: prompt
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2040
              - 200
              - 80
            value: Prompt for Email
            parent: "1"
          description: ""
        stepID: "3"
        results:
          - expr: value
            target: email
        arguments:
          - type: String
            value: הזנת מייל מותאם
            target: title
          - type: String
            value: 'נא להזין מייל אליו תישלח ההצעה:'
            target: message
          - expr: '"אימייל"'
            type: String
            target: label
          - type: String
            value: email
            target: type
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2600
              - 2040
              - 200
              - 80
            value: Check if email entered
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments: []
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2960
              - 2040
              - 200
              - 80
            value: Get LineItems
            parent: "1"
          description: ""
        stepID: "8"
        results:
          - expr: records
            target: lineItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 3240
              - 2360
              - 200
              - 80
            value: Send Email
            parent: "1"
          description: ""
        stepID: "13"
        results: []
        arguments:
          - expr: '"Corteza - Quote: " + record.values.QuoteNumber + " - " + record.values.Name'
            type: String
            target: subject
          - expr: email
            type: String
            target: to
          - expr: html.document
            type: Reader
            target: html
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2600
              - 2200
              - 200
              - 80
            value: 'Warning: Please enter an email to send this quote to'
            parent: "1"
          description: ""
        stepID: "19"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please enter an email to send this quote to
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 3240
              - 2520
              - 200
              - 80
            value: 'הצלחה: הצעת המחיר נשלחה במייל'
            parent: "1"
          description: ""
        stepID: "20"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נשלחה במייל
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "29"
            xywh:
              - 3240
              - 2200
              - 200
              - 80
            value: Render Template
            parent: "1"
          description: ""
        stepID: "29"
        results:
          - expr: document
            target: html
        arguments:
          - type: Handle
            value: quote
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "33"
            xywh:
              - 3240
              - 2040
              - 200
              - 80
            value: Set Render Variables
            parent: "1"
          description: ""
        stepID: "33"
        results: []
        arguments:
          - type: Vars
            target: renderVariables
          - expr: record
            type: ComposeRecord
            target: renderVariables.quote
          - expr: lineItems
            type: Array
            target: renderVariables.lineItems
    paths:
      - meta:
          name: ""
          visual:
            id: "6"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "3"
      - expr: 'email ? true : false'
        meta:
          name: ""
          visual:
            id: "9"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "8"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "10"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "19"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "21"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "20"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "32"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "13"
        parentID: "29"
      - meta:
          name: ""
          visual:
            id: "36"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "29"
        parentID: "33"
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: null
          description: ""
        childID: "33"
        parentID: "8"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Quote
            parent: "1"
          description: ""
  CRM-Quote-Pdf-SendToPriContact:
    enabled: true
    meta:
      name: CRM - Quote - Send PDF To Pri Contact
      visual: null
      description: Send this Quote as PDF via email to the primary contact
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2040
              - 200
              - 80
            value: Check recipient
            parent: "1"
            defaultName: false
          description: ""
        stepID: "3"
        results: []
        arguments: []
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2960
              - 2040
              - 200
              - 80
            value: Get Included tems
            parent: "1"
            defaultName: false
          description: ""
        stepID: "6"
        results:
          - expr: records
            type: ComposeRecord
            target: lineItems
        arguments:
          - type: Handle
            value: QuoteIncludedItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - type: String
            value: SortOrder
            target: sort
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 2320
              - 2200
              - 200
              - 80
            value: 'אזהרה: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי.'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "15"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2040
              - 3360
              - 200
              - 80
            value: 'הצלחה: הצעת המחיר נשלחה במייל'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "16"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נשלחה במייל
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "31"
            xywh:
              - 2040
              - 3040
              - 200
              - 80
            value: Set Render Variables
            parent: "1"
            defaultName: false
          description: ""
        stepID: "31"
        results: []
        arguments:
          - type: Vars
            target: renderVariables
          - expr: record
            type: ComposeRecord
            target: renderVariables.quote
          - expr: lineItems
            type: Array
            target: renderVariables.lineItems
          - expr: |-
              {
                  "documentSize": "A4",
                  "contentScale": "1",
                  "orientation": "portrait",
                  "margin": "0.3"
                }
            type: Vars
            target: renderOptions
          - expr: join([settings.values.Domain, "/api/compose",coverImgUrl],'')
            type: String
            target: renderVariables.coverImgUrl
          - expr: strftime(now(),"%d/%m/%Y")
            type: String
            target: renderVariables.now
          - expr: priContact
            type: ComposeRecord
            target: renderVariables.priContact
          - expr: productImages
            type: Vars
            target: renderVariables.productImages
          - expr: productNames
            type: Vars
            target: renderVariables.productNames
          - expr: |
              join([settings.values.Domain, "/api/compose",aboutImgUrl],"")
            type: String
            target: renderVariables.aboutImgUrl
          - expr: ExpirationDate
            type: String
            target: renderVariables.expirationDate
          - expr: termItems
            type: Any
            target: renderVariables.termItems
          - expr: productFamilies
            type: Vars
            target: renderVariables.productFamilies
          - expr: extensionItems
            type: Array
            target: renderVariables.extensionItems
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "99"
            xywh:
              - 2040
              - 3200
              - 200
              - 80
            value: Mail Message Template
            parent: "1"
            defaultName: false
          description: ""
        stepID: "99"
        results:
          - expr: document
            target: mailHtml
        arguments:
          - type: Handle
            value: quote_pdf_email
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "113"
            xywh:
              - 2320
              - 3040
              - 200
              - 80
            value: Quote to HTML
            parent: "1"
            defaultName: false
          description: ""
        stepID: "113"
        results:
          - expr: document
            target: html
        arguments:
          - type: Handle
            value: quote_pdf
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "119"
            xywh:
              - 2320
              - 3200
              - 200
              - 80
            value: Prepare Automation Script Vars
            parent: "1"
            defaultName: false
          description: ""
        stepID: "119"
        results: []
        arguments:
          - expr: html.document
            type: String
            target: templateHtml
          - expr: mailHtml.document
            type: String
            target: messageHtml
          - expr: headerHtml.document
            type: String
            target: headerHtml
          - expr: footerHtml.document
            type: String
            target: footerHtml
          - expr: join([record.values.Name,record.values.QuoteNumber]," - ")
            type: String
            target: quoteName
      - ref: corredorExec
        kind: function
        meta:
          name: ""
          visual:
            id: "124"
            xywh:
              - 2600
              - 3200
              - 200
              - 80
            value: Send PDF using Auto Script
            parent: "1"
            defaultName: false
          description: ""
        stepID: "124"
        results:
          - expr: results
            type: Vars
            target: res
        arguments:
          - type: String
            value: /server-scripts/tilnet-scripts/crm/send-pdf.js:default
            target: script
          - expr: |-
              {
                "record":record,
                "templateHtml": templateHtml,
                "headerHtml": headerHtml,
                "footerHtml": footerHtml,
                "mailTo": record.values.Email,
                "mailSubject":  quoteName,
                "quoteFileName":  join([quoteName],".pdf"),
                "messageHtml": messageHtml
              }
            type: Vars
            target: args
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "152"
            xywh:
              - 2040
              - 2360
              - 200
              - 80
            value: get settings
            parent: "1"
            defaultName: false
          description: ""
        stepID: "152"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "153"
            xywh:
              - 2320
              - 2360
              - 200
              - 80
            value: Prepare settings
            parent: "1"
            defaultName: false
          description: ""
        stepID: "153"
        results: []
        arguments:
          - expr: settings.values.DefaultQuoteImage
            type: String
            target: DefaultQuoteImage
          - expr: settings.values.DefaultAboutImage
            type: String
            target: DefaultAboutImage
      - ref: oauth2Authenticate
        kind: function
        meta:
          name: ""
          visual:
            id: "154"
            xywh:
              - 2600
              - 2360
              - 200
              - 80
            value: get api token
            parent: "1"
            defaultName: false
          description: ""
        stepID: "154"
        results:
          - expr: accessToken
            type: String
            target: accessToken
        arguments:
          - type: String
            value: "255224430584660239"
            target: client
          - type: String
            value: 5ymwycOOMwdpwWOsBwmYVndbf4QAOF1zX46lr1SZloYzSwtPvaX126Mar0HPgAYB
            target: secret
          - type: String
            value: profile api
            target: scope
          - expr: join([settings.values.Domain,"/auth/oauth2/token"],'')
            type: String
            target: tokenUrl
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "159"
            xywh:
              - 2040
              - 2880
              - 200
              - 80
            value: get cover image
            parent: "1"
            defaultName: false
          description: ""
        stepID: "159"
        results:
          - expr: status
            type: String
            target: attachemtResStatus
          - expr: body
            type: Reader
            target: attachmentReader
        arguments:
          - expr: format("%v%v%v/%v/%v", settings.values.Domain, "/api/compose/namespace/",record.namespaceID, "attachment/record", DefaultQuoteImage)
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "163"
            xywh:
              - 2320
              - 2880
              - 200
              - 80
            value: Prepare cover image results
            parent: "1"
            defaultName: false
          description: ""
        stepID: "163"
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "168"
            xywh:
              - 2600
              - 2880
              - 200
              - 80
            value: jsenv get cover image preview url
            parent: "1"
            defaultName: false
          description: ""
        stepID: "168"
        results:
          - expr: resultString
            type: String
            target: coverImgUrl
        arguments:
          - expr: attachmentString
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "172"
            xywh:
              - 2600
              - 3040
              - 200
              - 80
            value: Quote to HTML Header
            parent: "1"
            defaultName: false
          description: ""
        stepID: "172"
        results:
          - expr: document
            target: headerHtml
        arguments:
          - type: Handle
            value: quote_pdf_header
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "191"
            xywh:
              - 3800
              - 2040
              - 200
              - 80
            value: Get pri contact record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "191"
        results:
          - expr: record
            target: priContact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.values.ContactId
            type: ID
            target: record
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "192"
            xywh:
              - 2880
              - 3040
              - 200
              - 80
            value: Quote to HTML Footer
            parent: "1"
            defaultName: false
          description: ""
        stepID: "192"
        results:
          - expr: document
            target: footerHtml
        arguments:
          - type: Handle
            value: quote_pdf_footer
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "195"
            xywh:
              - 2320
              - 2520
              - 200
              - 80
            value: get product data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "195"
        results:
          - expr: item
            type: Any
            target: lineItem
        arguments:
          - expr: lineItems
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "207"
            xywh:
              - 2600
              - 2520
              - 200
              - 80
            value: set product data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "207"
        results: []
        arguments:
          - expr: lineItem.values.ProductId
            type: String
            target: ProductId
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "209"
            xywh:
              - 2880
              - 2520
              - 200
              - 80
            value: get LineItem Product record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "209"
        results:
          - expr: record
            type: ComposeRecord
            target: LineItemProduct
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: ProductId
            type: ID
            target: record
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "213"
            xywh:
              - 3160
              - 2520
              - 200
              - 80
            value: http get product image attachment
            parent: "1"
            defaultName: false
          description: ""
        stepID: "213"
        results:
          - expr: body
            type: Reader
            target: productImage
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "218"
            xywh:
              - 3440
              - 2520
              - 200
              - 80
            value: prepare product image request
            parent: "1"
            defaultName: false
          description: ""
        stepID: "218"
        results: []
        arguments:
          - expr: productImage
            type: String
            target: productImage
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: productImageUrl
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "219"
            xywh:
              - 3720
              - 2520
              - 200
              - 80
            value: jsenv image preview
            parent: "1"
            defaultName: false
          description: ""
        stepID: "219"
        results:
          - expr: resultString
            type: String
            target: imagePreviewUrl
        arguments:
          - expr: productImage
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "236"
            xywh:
              - 2040
              - 2520
              - 200
              - 80
            value: Prepare included product Data Arrays
            parent: "1"
            defaultName: false
          description: ""
        stepID: "236"
        results: []
        arguments:
          - type: Vars
            target: productImages
          - type: Vars
            target: productNames
          - type: Vars
            target: productFamilies
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "242"
            xywh:
              - 4000
              - 2520
              - 200
              - 80
            value: add product data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "242"
        results: []
        arguments:
          - expr: |-
              {
                ProductId: join([settings.values.Domain, "/api/compose",imagePreviewUrl],'')}
            type: Vars
            target: imageItem
          - expr: merge(productImages,imageItem)
            type: Vars
            target: productImages
          - expr: '{ProductId: LineItemProduct.values.Name}'
            type: Vars
            target: nameItem
          - expr: merge(productNames,nameItem)
            type: Vars
            target: productNames
          - expr: '{ProductId: LineItemProduct.values.Family}'
            type: Vars
            target: familyItem
          - expr: merge(productFamilies,familyItem)
            type: Vars
            target: productFamilies
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "244"
            xywh:
              - 4280
              - 2520
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "244"
        results: []
        arguments: []
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "251"
            xywh:
              - 2880
              - 2880
              - 200
              - 80
            value: get about image
            parent: "1"
            defaultName: false
          description: ""
        stepID: "251"
        results:
          - expr: body
            type: Reader
            target: attachmentReader
        arguments:
          - expr: format("%v%v%v/%v/%v",settings.values.Domain, "/api/compose/namespace/",record.namespaceID, "attachment/record", DefaultAboutImage)
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "252"
            xywh:
              - 3160
              - 2880
              - 200
              - 80
            value: Prepare about image results
            parent: "1"
            defaultName: false
          description: ""
        stepID: "252"
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "253"
            xywh:
              - 3440
              - 2880
              - 200
              - 80
            value: jsenv get about image preview url
            parent: "1"
            defaultName: false
          description: ""
        stepID: "253"
        results:
          - expr: resultString
            target: aboutImgUrl
        arguments:
          - expr: attachmentString
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "259"
            xywh:
              - 2600
              - 2040
              - 200
              - 80
            value: Check quote name
            parent: "1"
            defaultName: false
          description: ""
        stepID: "259"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "269"
            xywh:
              - 2600
              - 2200
              - 200
              - 80
            value: Prepare quote name
            parent: "1"
            defaultName: false
          description: ""
        stepID: "269"
        results: []
        arguments:
          - expr: '"הצעת מחיר לפיתוח"'
            type: String
            target: record.values.Name
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "271"
            xywh:
              - 4080
              - 2040
              - 200
              - 80
            value: jsenv set expiration date
            parent: "1"
            defaultName: false
          description: ""
        stepID: "271"
        results:
          - expr: resultString
            target: ExpirationDate
        arguments:
          - expr: record.values.ExpirationDate
            type: String
            target: scope
          - type: String
            value: return arguments[0].replace(/([\d]{4})-([\d]{2})-([\d]{2}).*/,"$3/$2/$1")
            target: source
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "273"
            xywh:
              - 3520
              - 2040
              - 200
              - 80
            value: Get TermItems
            parent: "1"
            defaultName: false
          description: ""
        stepID: "273"
        results:
          - expr: records
            type: ComposeRecord
            target: termItems
        arguments:
          - type: Handle
            value: QuoteTermItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - type: String
            value: Order
            target: sort
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "279"
            xywh:
              - 2880
              - 3200
              - 200
              - 80
            value: Set quote status
            parent: "1"
            defaultName: false
          description: ""
        stepID: "279"
        results: []
        arguments:
          - expr: '"Presented"'
            type: String
            target: record.values.Status
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "282"
            xywh:
              - 3160
              - 3200
              - 200
              - 80
            value: Compose record update
            parent: "1"
            defaultName: true
          description: ""
        stepID: "282"
        results:
          - expr: record
            type: ComposeRecord
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "288"
            xywh:
              - 2320
              - 3360
              - 200
              - 80
            value: Redirect user to the record page
            parent: "1"
            defaultName: true
          description: ""
        stepID: "288"
        results: []
        arguments:
          - type: Handle
            value: Quote
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.recordID
            type: ID
            target: record
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "294"
            xywh:
              - 3240
              - 2040
              - 200
              - 80
            value: Get Extension tems
            parent: "1"
            defaultName: false
          description: ""
        stepID: "294"
        results:
          - expr: records
            type: ComposeRecord
            target: extensionItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - type: String
            value: SortOrder
            target: sort
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "296"
            xywh:
              - 3992
              - 2672
              - 200
              - 80
            value: add product data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "296"
        results: []
        arguments:
          - expr: |-
              {
                ProductId: join([settings.values.Domain, "/api/compose",imagePreviewUrl],'')}
            type: Vars
            target: imageItem
          - expr: merge(productImages,imageItem)
            type: Vars
            target: productImages
          - expr: '{ProductId: LineItemProduct.values.Name}'
            type: Vars
            target: nameItem
          - expr: merge(productNames,nameItem)
            type: Vars
            target: productNames
          - expr: '{ProductId: LineItemProduct.values.Family}'
            type: Vars
            target: familyItem
          - expr: merge(productFamilies,familyItem)
            type: Vars
            target: productFamilies
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "297"
            xywh:
              - 4272
              - 2672
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "297"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "298"
            xywh:
              - 2592
              - 2672
              - 200
              - 80
            value: set product data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "298"
        results: []
        arguments:
          - expr: extensionItem.values.ProductId
            type: String
            target: ProductId
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "299"
            xywh:
              - 2872
              - 2672
              - 200
              - 80
            value: get LineItem Product record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "299"
        results:
          - expr: record
            type: ComposeRecord
            target: LineItemProduct
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: ProductId
            type: ID
            target: record
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "300"
            xywh:
              - 3712
              - 2672
              - 200
              - 80
            value: jsenv image preview
            parent: "1"
            defaultName: false
          description: ""
        stepID: "300"
        results:
          - expr: resultString
            type: String
            target: imagePreviewUrl
        arguments:
          - expr: productImage
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "301"
            xywh:
              - 3152
              - 2672
              - 200
              - 80
            value: http get product image attachment
            parent: "1"
            defaultName: false
          description: ""
        stepID: "301"
        results:
          - expr: body
            type: Reader
            target: productImage
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "302"
            xywh:
              - 3432
              - 2672
              - 200
              - 80
            value: prepare product image request
            parent: "1"
            defaultName: false
          description: ""
        stepID: "302"
        results: []
        arguments:
          - expr: productImage
            type: String
            target: productImage
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: productImageUrl
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "303"
            xywh:
              - 2312
              - 2672
              - 200
              - 80
            value: get extension product data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "303"
        results:
          - expr: item
            type: Any
            target: extensionItem
        arguments:
          - expr: extensionItems
            type: Array
            target: items
    paths:
      - expr: 'record.values.Email ? true : false'
        meta:
          name: ""
          visual:
            id: "7"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Yes'
            parent: "1"
            points: []
          description: ""
        childID: "259"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - No'
            parent: "1"
            points: []
          description: ""
        childID: "15"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "112"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "113"
        parentID: "31"
      - meta:
          name: ""
          visual:
            id: "115"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "99"
        parentID: "192"
      - meta:
          name: ""
          visual:
            id: "143"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "119"
        parentID: "99"
      - meta:
          name: ""
          visual:
            id: "156"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "153"
        parentID: "152"
      - meta:
          name: ""
          visual:
            id: "162"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "163"
        parentID: "159"
      - meta:
          name: ""
          visual:
            id: "167"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "31"
        parentID: "253"
      - meta:
          name: ""
          visual:
            id: "170"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "168"
        parentID: "163"
      - meta:
          name: ""
          visual:
            id: "171"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "124"
        parentID: "119"
      - meta:
          name: ""
          visual:
            id: "173"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "172"
        parentID: "113"
      - meta:
          name: ""
          visual:
            id: "193"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "192"
        parentID: "172"
      - meta:
          name: ""
          visual:
            id: "199"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "207"
        parentID: "195"
      - meta:
          name: ""
          visual:
            id: "208"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "209"
        parentID: "207"
      - meta:
          name: ""
          visual:
            id: "215"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "213"
        parentID: "209"
      - meta:
          name: ""
          visual:
            id: "216"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "218"
        parentID: "213"
      - meta:
          name: ""
          visual:
            id: "221"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "242"
        parentID: "219"
      - meta:
          name: ""
          visual:
            id: "226"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "294"
        parentID: "6"
      - meta:
          name: ""
          visual:
            id: "227"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "152"
        parentID: "271"
      - meta:
          name: ""
          visual:
            id: "228"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "236"
        parentID: "154"
      - meta:
          name: ""
          visual:
            id: "237"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "195"
        parentID: "236"
      - meta:
          name: ""
          visual:
            id: "238"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "219"
        parentID: "218"
      - meta:
          name: ""
          visual:
            id: "246"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "303"
        parentID: "195"
      - meta:
          name: ""
          visual:
            id: "254"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "252"
        parentID: "251"
      - meta:
          name: ""
          visual:
            id: "255"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "253"
        parentID: "252"
      - meta:
          name: ""
          visual:
            id: "256"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "251"
        parentID: "168"
      - expr: 'record.values.Name=="(unnamed)" ? true : false'
        meta:
          name: ""
          visual:
            id: "261"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "269"
        parentID: "259"
      - meta:
          name: ""
          visual:
            id: "267"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "6"
        parentID: "259"
      - meta:
          name: ""
          visual:
            id: "272"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "271"
        parentID: "191"
      - meta:
          name: ""
          visual:
            id: "274"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "191"
        parentID: "273"
      - meta:
          name: ""
          visual:
            id: "275"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "6"
        parentID: "269"
      - meta:
          name: ""
          visual:
            id: "278"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "244"
        parentID: "242"
      - meta:
          name: ""
          visual:
            id: "280"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "279"
        parentID: "124"
      - meta:
          name: ""
          visual:
            id: "284"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "282"
      - meta:
          name: ""
          visual:
            id: "287"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "282"
        parentID: "279"
      - meta:
          name: ""
          visual:
            id: "289"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "288"
        parentID: "16"
      - meta:
          name: ""
          visual:
            id: "291"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "154"
        parentID: "153"
      - meta:
          name: ""
          visual:
            id: "295"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: null
          description: ""
        childID: "273"
        parentID: "294"
      - meta:
          name: ""
          visual:
            id: "304"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "298"
        parentID: "303"
      - meta:
          name: ""
          visual:
            id: "305"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "299"
        parentID: "298"
      - meta:
          name: ""
          visual:
            id: "306"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "301"
        parentID: "299"
      - meta:
          name: ""
          visual:
            id: "307"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "302"
        parentID: "301"
      - meta:
          name: ""
          visual:
            id: "308"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "296"
        parentID: "300"
      - meta:
          name: ""
          visual:
            id: "309"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "300"
        parentID: "302"
      - meta:
          name: ""
          visual:
            id: "310"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "297"
        parentID: "296"
      - meta:
          name: ""
          visual:
            id: "312"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: null
          description: ""
        childID: "159"
        parentID: "303"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "53"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-Pdf-SendToCustomEmail:
    enabled: true
    meta:
      name: CRM - Quote - Send PDF To Custom Email
      visual: null
      description: Sends quote PDF to custom address address
    steps:
      - ref: input
        kind: prompt
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2040
              - 200
              - 80
            value: Prompt for Email
            parent: "1"
          description: ""
        stepID: "3"
        results:
          - expr: value
            target: email
        arguments:
          - type: String
            value: הזנת מייל מותאם
            target: title
          - type: String
            value: 'נא להזין מייל אליו תישלח ההצעה:'
            target: message
          - expr: '"אימייל"'
            type: String
            target: label
          - type: String
            value: email
            target: type
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2600
              - 2040
              - 200
              - 80
            value: Check if email entered
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2600
              - 2200
              - 200
              - 80
            value: 'Warning: Please enter an email to send this quote to'
            parent: "1"
          description: ""
        stepID: "19"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please enter an email to send this quote to
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "53"
            xywh:
              - 3280
              - 2040
              - 200
              - 80
            value: Get LineItems
            parent: "1"
          description: ""
        stepID: "53"
        results:
          - expr: records
            target: lineItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "54"
            xywh:
              - 3840
              - 2040
              - 200
              - 80
            value: Get pri contact record
            parent: "1"
          description: ""
        stepID: "54"
        results:
          - expr: record
            target: priContact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.values.ContactId
            type: ID
            target: record
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "55"
            xywh:
              - 2920
              - 2040
              - 200
              - 80
            value: Check quote name
            parent: "1"
          description: ""
        stepID: "55"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "56"
            xywh:
              - 2920
              - 2200
              - 200
              - 80
            value: Prepare quote name
            parent: "1"
          description: ""
        stepID: "56"
        results: []
        arguments:
          - expr: '"הצעת מחיר לפיתוח"'
            type: String
            target: record.values.Name
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "57"
            xywh:
              - 4120
              - 2040
              - 200
              - 80
            value: jsenv set expiration date
            parent: "1"
          description: ""
        stepID: "57"
        results:
          - expr: resultString
            target: ExpirationDate
        arguments:
          - expr: record.values.ExpirationDate
            type: String
            target: scope
          - type: String
            value: return arguments[0].replace(/([\d]{4})-([\d]{2})-([\d]{2}).*/,"$3/$2/$1")
            target: source
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3560
              - 2040
              - 200
              - 80
            value: Get TermItems
            parent: "1"
          description: ""
        stepID: "58"
        results:
          - expr: records
            target: termItems
        arguments:
          - type: Handle
            value: QuoteTermItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 2600
              - 3160
              - 200
              - 80
            value: 'הצלחה: הצעת המחיר נשלחה במייל'
            parent: "1"
          description: ""
        stepID: "65"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נשלחה במייל
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 2040
              - 2840
              - 200
              - 80
            value: Set Render Variables
            parent: "1"
          description: ""
        stepID: "66"
        results: []
        arguments:
          - type: Vars
            target: renderVariables
          - expr: record
            type: ComposeRecord
            target: renderVariables.quote
          - expr: lineItems
            type: Array
            target: renderVariables.lineItems
          - expr: |-
              {
                  "documentSize": "A4",
                  "contentScale": "1",
                  "orientation": "portrait",
                  "margin": "0.3"
                }
            type: Vars
            target: renderOptions
          - expr: join(["http://local.cortezaproject.org:18080/api/compose",coverImgUrl],'')
            type: String
            target: renderVariables.coverImgUrl
          - expr: strftime(now(),"%d/%m/%Y")
            type: String
            target: renderVariables.now
          - expr: priContact
            type: ComposeRecord
            target: renderVariables.priContact
          - expr: productImages
            type: Vars
            target: renderVariables.productImages
          - expr: productNames
            type: Vars
            target: renderVariables.productNames
          - expr: |
              join(["http://local.cortezaproject.org:18080/api/compose",aboutImgUrl],"")
            type: String
            target: renderVariables.aboutImgUrl
          - expr: ExpirationDate
            type: String
            target: renderVariables.expirationDate
          - expr: termItems
            type: Array
            target: renderVariables.termItems
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "67"
            xywh:
              - 2040
              - 3000
              - 200
              - 80
            value: Mail Message Template
            parent: "1"
          description: ""
        stepID: "67"
        results:
          - expr: document
            target: mailHtml
        arguments:
          - type: Handle
            value: quote_pdf_email
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "68"
            xywh:
              - 2320
              - 2840
              - 200
              - 80
            value: Quote to HTML
            parent: "1"
          description: ""
        stepID: "68"
        results:
          - expr: document
            target: html
        arguments:
          - type: Handle
            value: quote_pdf
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "69"
            xywh:
              - 2320
              - 3000
              - 200
              - 80
            value: Prepare Automation Script Vars
            parent: "1"
          description: ""
        stepID: "69"
        results: []
        arguments:
          - expr: html.document
            type: String
            target: templateHtml
          - expr: mailHtml.document
            type: String
            target: messageHtml
          - expr: headerHtml.document
            type: String
            target: headerHtml
          - expr: footerHtml.document
            type: String
            target: footerHtml
          - expr: join([record.values.Name,record.values.QuoteNumber]," - ")
            type: String
            target: quoteName
      - ref: corredorExec
        kind: function
        meta:
          name: ""
          visual:
            id: "70"
            xywh:
              - 2600
              - 3000
              - 200
              - 80
            value: Send PDF using Auto Script
            parent: "1"
          description: ""
        stepID: "70"
        results:
          - expr: results
            target: res
        arguments:
          - type: String
            value: /server-scripts/tilnet-scripts/crm/send-pdf.js:default
            target: script
          - expr: |-
              {
                "record":record,
                "templateHtml": templateHtml,
                "headerHtml": headerHtml,
                "footerHtml": footerHtml,
                "mailTo": record.values.Email,
                "mailSubject":  quoteName,
                "quoteFileName":  join([quoteName],".pdf"),
                "messageHtml": messageHtml
              }
            type: Vars
            target: args
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "71"
            xywh:
              - 2040
              - 2360
              - 200
              - 80
            value: get settings
            parent: "1"
          description: ""
        stepID: "71"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "72"
            xywh:
              - 2320
              - 2360
              - 200
              - 80
            value: Prepare settings
            parent: "1"
          description: ""
        stepID: "72"
        results: []
        arguments:
          - expr: settings.values.DefaultQuoteImage
            type: String
            target: DefaultQuoteImage
          - expr: settings.values.DefaultAboutImage
            type: String
            target: DefaultAboutImage
      - ref: oauth2Authenticate
        kind: function
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 2600
              - 2360
              - 200
              - 80
            value: get api token
            parent: "1"
          description: ""
        stepID: "73"
        results:
          - expr: accessToken
            target: accessToken
        arguments:
          - type: String
            value: "255224430584660239"
            target: client
          - type: String
            value: 5ymwycOOMwdpwWOsBwmYVndbf4QAOF1zX46lr1SZloYzSwtPvaX126Mar0HPgAYB
            target: secret
          - type: String
            value: profile api
            target: scope
          - type: String
            value: http://local.cortezaproject.org:18080/auth/oauth2/token
            target: tokenUrl
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "74"
            xywh:
              - 2040
              - 2680
              - 200
              - 80
            value: get cover image
            parent: "1"
          description: ""
        stepID: "74"
        results:
          - expr: status
            target: attachemtResStatus
          - expr: body
            target: attachmentReader
        arguments:
          - expr: format("%v%v/%v/%v", "http://local.cortezaproject.org:18080/api/compose/namespace/",record.namespaceID, "attachment/record", DefaultQuoteImage)
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 2320
              - 2680
              - 200
              - 80
            value: Prepare cover image results
            parent: "1"
          description: ""
        stepID: "75"
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "76"
            xywh:
              - 2600
              - 2680
              - 200
              - 80
            value: jsenv get cover image preview url
            parent: "1"
          description: ""
        stepID: "76"
        results:
          - expr: resultString
            target: coverImgUrl
        arguments:
          - expr: attachmentString
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "77"
            xywh:
              - 2600
              - 2840
              - 200
              - 80
            value: Quote to HTML Header
            parent: "1"
          description: ""
        stepID: "77"
        results:
          - expr: document
            target: headerHtml
        arguments:
          - type: Handle
            value: quote_pdf_header
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "78"
            xywh:
              - 2880
              - 2840
              - 200
              - 80
            value: Quote to HTML Footer
            parent: "1"
          description: ""
        stepID: "78"
        results:
          - expr: document
            target: footerHtml
        arguments:
          - type: Handle
            value: quote_pdf_footer
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "79"
            xywh:
              - 2320
              - 2520
              - 200
              - 80
            value: get product data
            parent: "1"
          description: ""
        stepID: "79"
        results:
          - expr: item
            target: lineItem
        arguments:
          - expr: lineItems
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "80"
            xywh:
              - 2600
              - 2520
              - 200
              - 80
            value: set product data
            parent: "1"
          description: ""
        stepID: "80"
        results: []
        arguments:
          - expr: lineItem.values.ProductId
            type: String
            target: ProductId
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "81"
            xywh:
              - 2880
              - 2520
              - 200
              - 80
            value: get LineItem Product record
            parent: "1"
          description: ""
        stepID: "81"
        results:
          - expr: record
            target: LineItemProduct
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: ProductId
            type: ID
            target: record
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "82"
            xywh:
              - 3160
              - 2520
              - 200
              - 80
            value: http get product image attachment
            parent: "1"
          description: ""
        stepID: "82"
        results:
          - expr: body
            target: productImage
        arguments:
          - expr: join([ "http://local.cortezaproject.org:18080/api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "83"
            xywh:
              - 3440
              - 2520
              - 200
              - 80
            value: cast product image to string
            parent: "1"
          description: ""
        stepID: "83"
        results: []
        arguments:
          - expr: productImage
            type: String
            target: productImage
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "84"
            xywh:
              - 3720
              - 2520
              - 200
              - 80
            value: jsenv image preview
            parent: "1"
          description: ""
        stepID: "84"
        results:
          - expr: resultString
            target: imagePreviewUrl
        arguments:
          - expr: productImage
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "85"
            xywh:
              - 2040
              - 2520
              - 200
              - 80
            value: Prepare product Data Arrays
            parent: "1"
          description: ""
        stepID: "85"
        results: []
        arguments:
          - type: Vars
            target: productImages
          - type: Vars
            target: productNames
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "86"
            xywh:
              - 4000
              - 2520
              - 200
              - 80
            value: add product data
            parent: "1"
          description: ""
        stepID: "86"
        results: []
        arguments:
          - expr: |-
              {
                ProductId: join(["http://local.cortezaproject.org:18080/api/compose",imagePreviewUrl],'')}
            type: Vars
            target: imageItem
          - expr: merge(productImages,imageItem)
            type: Vars
            target: productImages
          - expr: '{ProductId: LineItemProduct.values.Name}'
            type: Vars
            target: nameItem
          - expr: merge(productNames,nameItem)
            type: Vars
            target: productNames
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "87"
            xywh:
              - 4280
              - 2520
              - 200
              - 80
            value: null
            parent: "1"
          description: ""
        stepID: "87"
        results: []
        arguments: []
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "88"
            xywh:
              - 2880
              - 2680
              - 200
              - 80
            value: get about image
            parent: "1"
          description: ""
        stepID: "88"
        results:
          - expr: body
            target: attachmentReader
        arguments:
          - expr: format("%v%v/%v/%v", "http://local.cortezaproject.org:18080/api/compose/namespace/",record.namespaceID, "attachment/record", DefaultAboutImage)
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "89"
            xywh:
              - 3160
              - 2680
              - 200
              - 80
            value: Prepare about image results
            parent: "1"
          description: ""
        stepID: "89"
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "90"
            xywh:
              - 3440
              - 2680
              - 200
              - 80
            value: jsenv get about image preview url
            parent: "1"
          description: ""
        stepID: "90"
        results:
          - expr: resultString
            target: aboutImgUrl
        arguments:
          - expr: attachmentString
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
    paths:
      - meta:
          name: ""
          visual:
            id: "6"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "3"
      - expr: 'email ? true : false'
        meta:
          name: ""
          visual:
            id: "9"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "55"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "10"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "19"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "58"
        parentID: "53"
      - expr: 'record.values.Name=="(unnamed)" ? true : false'
        meta:
          name: ""
          visual:
            id: "60"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "56"
        parentID: "55"
      - meta:
          name: ""
          visual:
            id: "61"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "53"
        parentID: "55"
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "57"
        parentID: "54"
      - meta:
          name: ""
          visual:
            id: "63"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "54"
        parentID: "58"
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "53"
        parentID: "56"
      - meta:
          name: ""
          visual:
            id: "91"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "68"
        parentID: "66"
      - meta:
          name: ""
          visual:
            id: "92"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "67"
        parentID: "78"
      - meta:
          name: ""
          visual:
            id: "93"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "69"
        parentID: "67"
      - meta:
          name: ""
          visual:
            id: "94"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "72"
        parentID: "71"
      - meta:
          name: ""
          visual:
            id: "95"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "73"
        parentID: "72"
      - meta:
          name: ""
          visual:
            id: "96"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "75"
        parentID: "74"
      - meta:
          name: ""
          visual:
            id: "97"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "66"
        parentID: "90"
      - meta:
          name: ""
          visual:
            id: "98"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "76"
        parentID: "75"
      - meta:
          name: ""
          visual:
            id: "99"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "70"
        parentID: "69"
      - meta:
          name: ""
          visual:
            id: "100"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "77"
        parentID: "68"
      - meta:
          name: ""
          visual:
            id: "101"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "65"
        parentID: "70"
      - meta:
          name: ""
          visual:
            id: "102"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "78"
        parentID: "77"
      - meta:
          name: ""
          visual:
            id: "103"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "80"
        parentID: "79"
      - meta:
          name: ""
          visual:
            id: "104"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "81"
        parentID: "80"
      - meta:
          name: ""
          visual:
            id: "105"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "82"
        parentID: "81"
      - meta:
          name: ""
          visual:
            id: "106"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "83"
        parentID: "82"
      - meta:
          name: ""
          visual:
            id: "107"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "86"
        parentID: "84"
      - meta:
          name: ""
          visual:
            id: "108"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "85"
        parentID: "73"
      - meta:
          name: ""
          visual:
            id: "109"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "79"
        parentID: "85"
      - meta:
          name: ""
          visual:
            id: "110"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "84"
        parentID: "83"
      - meta:
          name: ""
          visual:
            id: "111"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "87"
        parentID: "86"
      - meta:
          name: ""
          visual:
            id: "112"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "74"
        parentID: "79"
      - meta:
          name: ""
          visual:
            id: "113"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "89"
        parentID: "88"
      - meta:
          name: ""
          visual:
            id: "114"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "90"
        parentID: "89"
      - meta:
          name: ""
          visual:
            id: "115"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "88"
        parentID: "76"
      - meta:
          name: ""
          visual:
            id: "116"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points:
              - x: 4220
                "y": 2320
              - x: 2140
                "y": 2320
          description: ""
        childID: "71"
        parentID: "57"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Quote
            parent: "1"
          description: ""
  CRM-Quote-InsertNumber:
    enabled: true
    meta:
      name: CRM - Quote - Insert Number
      visual: null
      description: Sets the Quote number based on the settings
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2080
              - 200
              - 80
            value: Get Settings
            parent: "1"
          description: ""
        stepID: "3"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2960
              - 2080
              - 200
              - 80
            value: Set QuoteNumber
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments:
          - expr: 'settings.values.QuoteNextNumber ? settings.values.QuoteNextNumber : 0'
            type: Integer
            target: nextQuoteNumber
          - expr: nextQuoteNumber
            type: Integer
            target: record.values.QuoteNumber
          - expr: nextQuoteNumber + 1
            type: Integer
            target: settings.values.QuoteNextNumber
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2960
              - 2240
              - 200
              - 80
            value: Save Settings
            parent: "1"
          description: ""
        stepID: "7"
        results: []
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2560
              - 2080
              - 200
              - 80
            value: Check if has number
            parent: "1"
          description: ""
        stepID: "11"
        results: []
        arguments: []
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2560
              - 2240
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        stepID: "14"
        results: []
        arguments: []
    paths:
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "5"
      - expr: 'record.values.QuoteNumber ? false : true'
        meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - No Number'
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "11"
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "11"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "15"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Has number'
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "11"
    triggers:
      - resourceType: compose:record
        eventType: beforeCreate
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2080
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Quote Before Create Quote
            parent: "1"
          description: ""
  CRM-Opportunity-ApplyPriceBook:
    enabled: true
    meta:
      name: CRM - Opportunity - Apply Price Book
      visual: null
      description: עדכון מחרים מספר מחירים ונתוני הנחה
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2040
              - 200
              - 80
            value: Set pricebookId
            parent: "1"
            defaultName: false
          description: ""
        stepID: "3"
        results: []
        arguments:
          - expr: 'record.values.PricebookId ? record.values.PricebookId : 0'
            type: ID
            target: pricebookId
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 3040
              - 2040
              - 200
              - 80
            value: Fetch Pricebooks
            parent: "1"
            defaultName: false
          description: ""
        stepID: "5"
        results:
          - expr: records
            target: pricebooks
          - expr: total
            target: numOfPricebooks
        arguments:
          - type: Handle
            value: Pricebook
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"IsActive AND IsStandard"'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 3320
              - 2040
              - 200
              - 80
            value: Check Pricebooks
            parent: "1"
            defaultName: false
          description: ""
        stepID: "7"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 3040
              - 2200
              - 200
              - 80
            value: Set pricebookIds
            parent: "1"
            defaultName: false
          description: ""
        stepID: "10"
        results: []
        arguments:
          - expr: 'pricebooks[0] ? pricebooks[0] : undefined'
            type: ComposeRecord
            target: pricebook
          - expr: 'pricebook ? pricebook.recordID : undefined'
            type: ID
            target: pricebookId
          - expr: pricebookId
            type: ID
            target: record.values.PricebookId
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 3760
              - 2040
              - 200
              - 80
            value: 'Warning: No Pricebooks'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "12"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - expr: '"לא הוגדרו ספרי מחיר להזדמנות זו. נא לבחור ספר מחירים"'
            type: String
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2600
              - 2400
              - 200
              - 80
            value: Check pricebookId
            parent: "1"
            defaultName: false
          description: ""
        stepID: "14"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 3320
              - 2400
              - 200
              - 80
            value: 'Warning: No Pricebook'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "17"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please select a Price book for this opportunity first.
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 3320
              - 2200
              - 200
              - 80
            value: Save Opportunity
            parent: "1"
            defaultName: false
          description: ""
        stepID: "20"
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 2320
              - 2920
              - 200
              - 80
            value: Fetch IncludedItems
            parent: "1"
            defaultName: false
          description: ""
        stepID: "23"
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
          - expr: index
            type: UnsignedInteger
            target: index
          - expr: total
            type: UnsignedInteger
            target: numOfLineItems
        arguments:
          - type: Handle
            value: OpportunityIncludedItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"OpportunityId = " + record.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2880
              - 2920
              - 200
              - 80
            value: Fetch Product
            parent: "1"
            defaultName: false
          description: ""
        stepID: "26"
        results:
          - expr: record
            target: product
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: lineItem.values.ProductId
            type: ID
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 2040
              - 2920
              - 200
              - 80
            value: Set Quote Total
            parent: "1"
            defaultName: false
          description: ""
        stepID: "28"
        results: []
        arguments:
          - expr: "0"
            type: Float
            target: quoteTotal
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "30"
            xywh:
              - 2040
              - 3080
              - 200
              - 80
            value: Set Amount
            parent: "1"
            defaultName: false
          description: ""
        stepID: "30"
        results: []
        arguments:
          - expr: quoteTotal
            type: Float
            target: record.values.Amount
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "32"
            xywh:
              - 2320
              - 3080
              - 200
              - 80
            value: Save Opportunity
            parent: "1"
            defaultName: false
          description: ""
        stepID: "32"
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "34"
            xywh:
              - 2040
              - 3240
              - 200
              - 80
            value: 'הצלחה: ספר המחירים ייושם'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "34"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: ספר המחירים ייושם
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "36"
            xywh:
              - 2320
              - 3240
              - 200
              - 80
            value: Reload page
            parent: "1"
            defaultName: false
          description: ""
        stepID: "36"
        results: []
        arguments:
          - type: Handle
            value: Opportunity
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 3600
              - 2920
              - 200
              - 80
            value: Fetch Pricebook entry
            parent: "1"
            defaultName: false
          description: ""
        stepID: "38"
        results:
          - expr: records
            target: pricebookEntries
          - expr: total
            target: numOfPricebookEntries
        arguments:
          - type: Handle
            value: PricebookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"PricebookId = " + pricebookId + " AND ProductId = " + lineItem.values.ProductId'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "41"
            xywh:
              - 2600
              - 3080
              - 200
              - 80
            value: Set pricebookEntry
            parent: "1"
            defaultName: false
          description: ""
        stepID: "41"
        results: []
        arguments:
          - expr: 'numOfPricebookEntries > 0 ? pricebookEntries[0] : undefined'
            type: ComposeRecord
            target: pricebookEntry
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "45"
            xywh:
              - 3560
              - 3080
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "45"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 2880
              - 3080
              - 200
              - 80
            value: Set line item values
            parent: "1"
            defaultName: false
          description: ""
        stepID: "49"
        results: []
        arguments:
          - expr: 'lineItem.values.Quantity ? lineItem.values.Quantity : 1'
            type: Float
            target: quantity
          - expr: 'lineItem.values.Discount ? lineItem.values.Discount : 0'
            type: Float
            target: discount
          - expr: 'pricebookEntry.values.UnitPrice ? pricebookEntry.values.UnitPrice : 0'
            type: Float
            target: listprice
          - expr: '(lineItem.values.UnitPrice ? false : true) ? listprice : (lineItem.values.UnitPrice ? lineItem.values.UnitPrice : 0)'
            type: Any
            target: unitprice
          - expr: unitprice * quantity
            type: Float
            target: subtotal
          - expr: subtotal - discount
            type: Float
            target: totalprice
          - expr: product.values.Name
            type: String
            target: lineItem.values.Name
          - expr: product.values.ProductCode
            type: String
            target: lineItem.values.ProductCode
          - expr: listprice
            type: Float
            target: lineItem.values.ListPrice
          - expr: unitprice
            type: Float
            target: lineItem.values.UnitPrice
          - expr: subtotal
            type: Float
            target: lineItem.values.Subtotal
          - expr: totalprice
            type: Float
            target: lineItem.values.TotalPrice
          - expr: quoteTotal + totalprice
            type: Float
            target: quoteTotal
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "51"
            xywh:
              - 3160
              - 3080
              - 200
              - 80
            value: Save lineItem
            parent: "1"
            defaultName: false
          description: ""
        stepID: "51"
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
        arguments:
          - expr: lineItem
            type: ComposeRecord
            target: record
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "53"
            xywh:
              - 2600
              - 2040
              - 200
              - 80
            value: Check pricebookId
            parent: "1"
            defaultName: false
          description: ""
        stepID: "53"
        results: []
        arguments: []
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3840
              - 2920
              - 200
              - 80
            value: Check numOfPricebookEntries > 0
            parent: "1"
            defaultName: false
          description: ""
        stepID: "66"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "91"
            xywh:
              - 3240
              - 2920
              - 200
              - 80
            value: Set line item product details
            parent: "1"
            defaultName: false
          description: ""
        stepID: "91"
        results: []
        arguments:
          - expr: product.values.Description
            type: String
            target: lineItem.values.Description
          - expr: product.values.Photo
            type: String
            target: lineItem.values.Photo
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "93"
            xywh:
              - 3840
              - 2760
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "93"
        results: []
        arguments: []
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "94"
            xywh:
              - 3160
              - 2600
              - 200
              - 80
            value: Fetch Product
            parent: "1"
            defaultName: false
          description: ""
        stepID: "94"
        results:
          - expr: record
            type: ComposeRecord
            target: product
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: lineItem.values.ProductId
            type: ID
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "95"
            xywh:
              - 3520
              - 2600
              - 200
              - 80
            value: Set line item product details
            parent: "1"
            defaultName: false
          description: ""
        stepID: "95"
        results: []
        arguments:
          - expr: product.values.Description
            type: String
            target: lineItem.values.Description
          - expr: product.values.Photo
            type: String
            target: lineItem.values.Photo
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "96"
            xywh:
              - 3880
              - 2600
              - 200
              - 80
            value: Fetch Pricebook entry
            parent: "1"
            defaultName: false
          description: ""
        stepID: "96"
        results:
          - expr: records
            type: ComposeRecord
            target: pricebookEntries
          - expr: total
            type: UnsignedInteger
            target: numOfPricebookEntries
        arguments:
          - type: Handle
            value: PricebookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"PricebookId = " + pricebookId + " AND ProductId = " + lineItem.values.ProductId'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "97"
            xywh:
              - 4120
              - 2600
              - 200
              - 80
            value: Check numOfPricebookEntries > 0
            parent: "1"
            defaultName: false
          description: ""
        stepID: "97"
        results: []
        arguments: []
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "98"
            xywh:
              - 3440
              - 2760
              - 200
              - 80
            value: Save lineItem
            parent: "1"
            defaultName: false
          description: ""
        stepID: "98"
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
        arguments:
          - expr: lineItem
            type: ComposeRecord
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "99"
            xywh:
              - 3160
              - 2760
              - 200
              - 80
            value: Set line item values
            parent: "1"
            defaultName: false
          description: ""
        stepID: "99"
        results: []
        arguments:
          - expr: 'lineItem.values.Quantity ? lineItem.values.Quantity : 1'
            type: Float
            target: quantity
          - expr: 'lineItem.values.Discount ? lineItem.values.Discount : 0'
            type: Float
            target: discount
          - expr: 'pricebookEntry.values.UnitPrice ? pricebookEntry.values.UnitPrice : 0'
            type: Float
            target: listprice
          - expr: '(lineItem.values.UnitPrice ? false : true) ? listprice : (lineItem.values.UnitPrice ? lineItem.values.UnitPrice : 0)'
            type: Any
            target: unitprice
          - expr: unitprice * quantity
            type: Float
            target: subtotal
          - expr: subtotal - discount
            type: Float
            target: totalprice
          - expr: product.values.Name
            type: String
            target: lineItem.values.Name
          - expr: product.values.ProductCode
            type: String
            target: lineItem.values.ProductCode
          - expr: listprice
            type: Float
            target: lineItem.values.ListPrice
          - expr: unitprice
            type: Float
            target: lineItem.values.UnitPrice
          - expr: subtotal
            type: Float
            target: lineItem.values.Subtotal
          - expr: totalprice
            type: Float
            target: lineItem.values.TotalPrice
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "100"
            xywh:
              - 2600
              - 2600
              - 200
              - 80
            value: Fetch Line Items
            parent: "1"
            defaultName: false
          description: ""
        stepID: "100"
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
          - expr: index
            type: UnsignedInteger
            target: index
          - expr: total
            type: UnsignedInteger
            target: numOfLineItems
        arguments:
          - type: Handle
            value: OpportunityLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"OpportunityId = " + record.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "102"
            xywh:
              - 2880
              - 2760
              - 200
              - 80
            value: Set pricebookEntry
            parent: "1"
            defaultName: false
          description: ""
        stepID: "102"
        results: []
        arguments:
          - expr: 'numOfPricebookEntries > 0 ? pricebookEntries[0] : undefined'
            type: ComposeRecord
            target: pricebookEntry
    paths:
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "5"
      - expr: numOfPricebooks > 0
        meta:
          name: ""
          visual:
            id: "11"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Pricebook'
            parent: "1"
            points: []
          description: ""
        childID: "10"
        parentID: "7"
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No Pricebooks'
            parent: "1"
            points: []
          description: ""
        childID: "12"
        parentID: "7"
      - meta:
          name: ""
          visual:
            id: "21"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "20"
        parentID: "10"
      - expr: pricebookId != 0
        meta:
          name: ""
          visual:
            id: "24"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Pricebook'
            parent: "1"
            points: []
          description: ""
        childID: "100"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No pricebook'
            parent: "1"
            points: []
          description: ""
        childID: "17"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Iterate over included items
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "23"
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "23"
        parentID: "28"
      - meta:
          name: ""
          visual:
            id: "31"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "30"
        parentID: "23"
      - meta:
          name: ""
          visual:
            id: "33"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "32"
        parentID: "30"
      - meta:
          name: ""
          visual:
            id: "35"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "34"
        parentID: "32"
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "36"
        parentID: "34"
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "91"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "52"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "51"
        parentID: "49"
      - expr: pricebookId != 0
        meta:
          name: ""
          visual:
            id: "56"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Has pricebookId'
            parent: "1"
            points: []
          description: ""
        childID: "100"
        parentID: "53"
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "20"
      - meta:
          name: ""
          visual:
            id: "58"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No pricebookId'
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "53"
      - expr: numOfPricebookEntries > 0
        meta:
          name: ""
          visual:
            id: "67"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has pricebook entries'
            parent: "1"
            points: []
          description: ""
        childID: "41"
        parentID: "66"
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No entry'
            parent: "1"
            points: []
          description: ""
        childID: "45"
        parentID: "66"
      - meta:
          name: ""
          visual:
            id: "70"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "49"
        parentID: "41"
      - meta:
          name: ""
          visual:
            id: "82"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "66"
        parentID: "38"
      - meta:
          name: ""
          visual:
            id: "90"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "53"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "92"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "38"
        parentID: "91"
      - meta:
          name: ""
          visual:
            id: "103"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Iterate over line items
            parent: "1"
            points: []
          description: ""
        childID: "94"
        parentID: "100"
      - meta:
          name: ""
          visual:
            id: "104"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "95"
        parentID: "94"
      - meta:
          name: ""
          visual:
            id: "105"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "98"
        parentID: "99"
      - expr: numOfPricebookEntries > 0
        meta:
          name: ""
          visual:
            id: "106"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has pricebook entries'
            parent: "1"
            points: []
          description: ""
        childID: "102"
        parentID: "97"
      - meta:
          name: ""
          visual:
            id: "107"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No entry'
            parent: "1"
            points: []
          description: ""
        childID: "93"
        parentID: "97"
      - meta:
          name: ""
          visual:
            id: "108"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "99"
        parentID: "102"
      - meta:
          name: ""
          visual:
            id: "109"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "97"
        parentID: "96"
      - meta:
          name: ""
          visual:
            id: "110"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "96"
        parentID: "95"
      - meta:
          name: ""
          visual:
            id: "111"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: null
          description: ""
        childID: "28"
        parentID: "100"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Opportunity
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Opportunity
            parent: "1"
            defaultName: false
          description: ""
  CRM-Case-InsertNumber:
    enabled: true
    meta:
      name: CRM - Case - Insert Number
      visual: null
      description: This workflow assigns the case number based on the global settings record.
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2440
              - 2200
              - 200
              - 80
            value: Fetch settings
            parent: "1"
          description: ""
        stepID: "3"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace.ID
            type: ID
            target: namespace
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 3120
              - 2360
              - 200
              - 80
            value: Update settings
            parent: "1"
          description: ""
        stepID: "16"
        results:
          - expr: record
            target: settings
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2720
              - 2200
              - 200
              - 80
            value: Check if has number
            parent: "1"
          description: ""
        stepID: "21"
        results: []
        arguments: []
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 2720
              - 2360
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        stepID: "24"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 3120
              - 2200
              - 200
              - 80
            value: Set number
            parent: "1"
          description: ""
        stepID: "26"
        results: []
        arguments:
          - expr: 'settings.values.CaseNextNumber ? settings.values.CaseNextNumber: 0'
            type: Integer
            target: record.values.CaseNumber
          - expr: record.values.CaseNumber + 1
            type: Integer
            target: settings.values.CaseNextNumber
    paths:
      - meta:
          name: ""
          visual:
            id: "22"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "3"
      - expr: 'record.values.CaseNumber ? false : true'
        meta:
          name: ""
          visual:
            id: "23"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - No number'
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Has number'
            parent: "1"
            points: []
          description: ""
        childID: "24"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "26"
    triggers:
      - resourceType: compose:record
        eventType: beforeCreate
        constraints:
          - op: =
            name: module
            values:
              - Case
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2120
              - 2200
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Before Create Case
            parent: "1"
          description: ""
  CRM-Account-CreateNewCase:
    enabled: true
    meta:
      name: CRM - Account - Create New Case
      visual: null
      description: Creates new Case record from an existing Account
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "56"
            xywh:
              - 2280
              - 2160
              - 200
              - 80
            value: Init primaryContact
            parent: "1"
          description: ""
        stepID: "56"
        results: []
        arguments:
          - expr: "false"
            type: Boolean
            target: primaryContact
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2560
              - 2160
              - 200
              - 80
            value: Find primary contact
            parent: "1"
          description: ""
        stepID: "14"
        results:
          - expr: record
            target: contact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"AccountId=" + record.recordID'
            type: String
            target: query
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2960
              - 2160
              - 200
              - 80
            value: Is primary contact?
            parent: "1"
          description: ""
        stepID: "17"
        results: []
        arguments: []
      - ref: ""
        kind: break
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 3584
              - 2160
              - 200
              - 80
            value: Found it!
            parent: "1"
          description: ""
        stepID: "18"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 3320
              - 2160
              - 200
              - 80
            value: Set primary contact
            parent: "1"
          description: ""
        stepID: "19"
        results: []
        arguments:
          - expr: contact
            type: ComposeRecord
            target: primaryContact
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2960
              - 2400
              - 200
              - 80
            value: Keep looking
            parent: "1"
          description: ""
        stepID: "20"
        results: []
        arguments: []
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 2560
              - 2600
              - 200
              - 80
            value: Found primary contact?
            parent: "1"
          description: ""
        stepID: "28"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "29"
            xywh:
              - 2560
              - 2760
              - 200
              - 80
            value: No primary contact
            parent: "1"
          description: ""
        stepID: "29"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: The primary contact is not defined
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "34"
            xywh:
              - 3240
              - 2600
              - 200
              - 80
            value: Prepare record
            parent: "1"
          description: ""
        stepID: "34"
        results:
          - expr: record
            target: case
        arguments:
          - type: Handle
            value: Case
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "36"
            xywh:
              - 3240
              - 2760
              - 200
              - 80
            value: Set record values
            parent: "1"
          description: ""
        stepID: "36"
        results: []
        arguments:
          - expr: '"(no subject)"'
            type: String
            target: case.values.Subject
          - expr: primaryContact.recordID
            type: ID
            target: case.values.ContactId
          - expr: record.recordID
            type: ID
            target: case.values.AccountId
          - expr: '"New"'
            type: String
            target: case.values.Status
          - expr: '"Low"'
            type: String
            target: case.values.Priority
          - expr: trim(format("%s %s", primaryContact.values.FirstName, primaryContact.values.LastName))
            type: String
            target: case.values.SuppliedName
          - expr: primaryContact.values.Email
            type: String
            target: case.values.SuppliedEmail
          - expr: primaryContact.values.Phone
            type: String
            target: case.values.SuppliedPhone
          - expr: record.values.OwnerId
            type: ID
            target: case.values.OwnerId
          - expr: nextCaseNumber
            type: Integer
            target: case.values.CaseNumber
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 3520
              - 2600
              - 200
              - 80
            value: Create case
            parent: "1"
          description: ""
        stepID: "38"
        results:
          - expr: record
            target: case
        arguments:
          - expr: case
            type: ComposeRecord
            target: record
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "40"
            xywh:
              - 3800
              - 2600
              - 200
              - 80
            value: Notify Case created
            parent: "1"
          description: ""
        stepID: "40"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: The new case has been created
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "42"
            xywh:
              - 3800
              - 2760
              - 200
              - 80
            value: Go to record editor
            parent: "1"
          description: ""
        stepID: "42"
        results: []
        arguments:
          - type: Handle
            value: Case
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: case
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "44"
            xywh:
              - 2960
              - 2600
              - 200
              - 80
            value: Fetch settings
            parent: "1"
          description: ""
        stepID: "44"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "45"
            xywh:
              - 2960
              - 2760
              - 200
              - 80
            value: Set nextCaseNumber
            parent: "1"
          description: ""
        stepID: "45"
        results: []
        arguments:
          - expr: 'settings.values.CaseNextNumber ? settings.values.CaseNextNumber : 0'
            type: Integer
            target: nextCaseNumber
          - expr: settings.values.CaseNextNumber + 1
            type: Integer
            target: settings.values.CaseNextNumber
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "50"
            xywh:
              - 3520
              - 2760
              - 200
              - 80
            value: Save settings
            parent: "1"
          description: ""
        stepID: "50"
        results:
          - expr: record
            target: settings
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
    paths:
      - expr: contact.values.IsPrimary
        meta:
          name: ""
          visual:
            id: "24"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "19"
        parentID: "17"
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "20"
        parentID: "17"
      - meta:
          name: ""
          visual:
            id: "26"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "18"
        parentID: "19"
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Loop body'
            parent: "1"
            points: []
          description: ""
        childID: "17"
        parentID: "14"
      - expr: 'primaryContact ? false : true'
        meta:
          name: ""
          visual:
            id: "30"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "29"
        parentID: "28"
      - meta:
          name: ""
          visual:
            id: "33"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Loop end'
            parent: "1"
            points: []
          description: ""
        childID: "28"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "35"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "44"
        parentID: "28"
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "36"
        parentID: "34"
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "38"
        parentID: "36"
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "42"
        parentID: "40"
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "45"
        parentID: "44"
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "34"
        parentID: "45"
      - meta:
          name: ""
          visual:
            id: "51"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "50"
        parentID: "38"
      - meta:
          name: ""
          visual:
            id: "52"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "40"
        parentID: "50"
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "56"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Account
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 56
        meta:
          visual:
            id: "2"
            xywh:
              - 2000
              - 2160
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "2"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "56"
                parentID: "2"
            value: From Account
            parent: "1"
          description: ""
  CRM-Lead-ToAccount:
    enabled: true
    meta:
      name: CRM - Lead - To Account
      visual: null
      description: Converts Lead to Account record
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2520
              - 2200
              - 200
              - 80
            value: Already converted?
            parent: "1"
          description: ""
        stepID: "3"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2888
              - 2200
              - 200
              - 80
            value: Lead already converted
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments:
          - type: String
            value: Info
            target: title
          - type: String
            value: This lead is already converted
            target: message
          - type: String
            value: info
            target: variant
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2528
              - 2400
              - 200
              - 80
            value: Prepare account record
            parent: "1"
          description: ""
        stepID: "6"
        results:
          - expr: record
            target: account
        arguments:
          - type: Handle
            value: Account
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2816
              - 2400
              - 200
              - 80
            value: Populate account data
            parent: "1"
          description: ""
        stepID: "7"
        results: []
        arguments:
          - expr: record.values.Street
            type: String
            target: account.values.BillingStreet
          - expr: record.values.City
            type: String
            target: account.values.BillingCity
          - expr: record.values.State
            type: String
            target: account.values.BillingState
          - expr: record.values.PostalCode
            type: String
            target: account.values.BillingPostalCode
          - expr: record.values.Country
            type: String
            target: account.values.BillingCountry
          - expr: record.values.Street
            type: String
            target: account.values.ShippingStreet
          - expr: record.values.City
            type: String
            target: account.values.ShippingCity
          - expr: record.values.State
            type: String
            target: account.values.ShippingState
          - expr: record.values.PostalCode
            type: String
            target: account.values.ShippingPostalCode
          - expr: record.values.Country
            type: String
            target: account.values.ShippingCountry
          - expr: record.values.AnnualRevenue
            type: String
            target: account.values.AnnualRevenue
          - expr: record.values.Description
            type: String
            target: account.values.Description
          - expr: record.values.Company
            type: String
            target: account.values.AccountName
          - expr: record.values.Fax
            type: String
            target: account.values.Fax
          - expr: record.values.Industry
            type: String
            target: account.values.Industry
          - expr: record.values.LeadSource
            type: String
            target: account.values.AccountSource
          - expr: record.values.Phone
            type: String
            target: account.values.Phone
          - expr: record.values.NumberOfEmployees
            type: Integer
            target: account.values.NumberOfEmployees
          - expr: record.values.Rating
            type: String
            target: account.values.Rating
          - expr: record.values.Website
            type: String
            target: account.values.Website
          - expr: record.values.Twitter
            type: String
            target: account.values.Twitter
          - expr: record.values.Facebook
            type: String
            target: account.values.Facebook
          - expr: record.values.LinkedIn
            type: String
            target: account.values.LinkedIn
          - expr: record.values.OwnerId
            type: ID
            target: account.values.OwnerId
          - expr: record.values.CampaignId
            type: Array
            target: account.values.CampaignId
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 3080
              - 2400
              - 200
              - 80
            value: Create account
            parent: "1"
          description: ""
        stepID: "8"
        results:
          - expr: record
            target: account
        arguments:
          - type: ComposeRecord
            source: account
            target: record
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2544
              - 2584
              - 200
              - 80
            value: Prepare contact record
            parent: "1"
          description: ""
        stepID: "9"
        results:
          - expr: record
            target: contact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 2800
              - 2584
              - 200
              - 80
            value: Populate contact data
            parent: "1"
          description: ""
        stepID: "10"
        results: []
        arguments:
          - expr: record.values.Street
            type: String
            target: contact.values.MailingStreet
          - expr: record.values.City
            type: String
            target: contact.values.MailingCity
          - expr: record.values.State
            type: String
            target: contact.values.MailingState
          - expr: record.values.PostalCode
            type: String
            target: contact.values.MailingPostalCode
          - expr: record.values.Country
            type: String
            target: contact.values.MailingCountry
          - expr: record.values.Description
            type: String
            target: contact.values.Description
          - expr: record.values.DoNotCall
            type: Boolean
            target: contact.values.DoNotCall
          - expr: record.values.Email
            type: String
            target: contact.values.Email
          - expr: record.values.HasOptedOutOfEmail
            type: Boolean
            target: contact.values.HasOptedOutOfEmail
          - expr: record.values.Fax
            type: String
            target: contact.values.Fax
          - expr: record.values.HasOptedOutOfFax
            type: Boolean
            target: contact.values.HasOptedOutOfFax
          - expr: record.values.LeadSource
            type: String
            target: contact.values.LeadSource
          - expr: record.values.Twitter
            type: String
            target: contact.values.Twitter
          - expr: record.values.Facebook
            type: String
            target: contact.values.Facebook
          - expr: record.values.LinkedIn
            type: String
            target: contact.values.LinkedIn
          - expr: record.values.Salutation
            type: String
            target: contact.values.Salutation
          - expr: record.values.FirstName
            type: String
            target: contact.values.FirstName
          - expr: record.values.LastName
            type: String
            target: contact.values.LastName
          - expr: record.values.MobilePhone
            type: String
            target: contact.values.MobilePhone
          - expr: record.values.Phone
            type: String
            target: contact.values.Phone
          - expr: record.values.Title
            type: String
            target: contact.values.Title
          - expr: "true"
            type: Boolean
            target: contact.values.IsPrimary
          - expr: account.recordID
            type: ID
            target: contact.values.AccountId
          - expr: record.values.OwnerId
            type: ID
            target: contact.values.OwnerId
          - expr: record.values.CampaignId
            type: Array
            target: contact.values.CampaignId
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 3064
              - 2584
              - 200
              - 80
            value: Create contact
            parent: "1"
          description: ""
        stepID: "11"
        results:
          - expr: record
            target: contact
        arguments:
          - type: ComposeRecord
            source: contact
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 2560
              - 2760
              - 200
              - 80
            value: Update lead data
            parent: "1"
          description: ""
        stepID: "12"
        results: []
        arguments:
          - expr: '"Converted"'
            type: String
            target: record.values.Status
          - expr: '"Yes"'
            type: String
            target: record.values.IsConverted
          - expr: account.recordID
            type: ID
            target: record.values.ConvertedAccountId
          - expr: contact.recordID
            type: ID
            target: record.values.ConvertedContactId
          - expr: account.createdAt
            type: DateTime
            target: record.values.ConvertedDate
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 2832
              - 2760
              - 200
              - 80
            value: Save lead
            parent: "1"
          description: ""
        stepID: "13"
        results:
          - expr: record
            target: record
        arguments:
          - type: ComposeRecord
            source: record
            target: record
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2560
              - 3080
              - 200
              - 80
            value: Lead converted
            parent: "1"
          description: ""
        stepID: "17"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הליד הומר
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "79"
            xywh:
              - 2840
              - 3080
              - 200
              - 80
            value: Redirect to account page
            parent: "1"
          description: ""
        stepID: "79"
        results: []
        arguments:
          - type: Handle
            value: Account
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: account
            type: ComposeRecord
            target: record
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "81"
            xywh:
              - 2840
              - 2920
              - 200
              - 80
            value: Prepare email content
            parent: "1"
          description: ""
        stepID: "81"
        results:
          - expr: document
            target: content
        arguments:
          - type: Handle
            value: lead_converted_content
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: contentRenderVariables
            type: Vars
            target: variables
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "83"
            xywh:
              - 3120
              - 2920
              - 200
              - 80
            value: Prepare email subject
            parent: "1"
          description: ""
        stepID: "83"
        results:
          - expr: document
            target: subject
        arguments:
          - type: Handle
            value: lead_converted_subject
            target: lookup
          - type: String
            value: subject
            target: documentName
          - type: String
            value: text/plain
            target: documentType
          - expr: subjectRenderVariables
            type: Vars
            target: variables
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "85"
            xywh:
              - 3680
              - 2920
              - 200
              - 80
            value: Send email
            parent: "1"
          description: ""
        stepID: "85"
        results: []
        arguments:
          - expr: subject.document
            type: Reader
            target: subject
          - expr: owner
            type: User
            target: to
          - expr: content.document
            type: Reader
            target: html
      - ref: usersLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "88"
            xywh:
              - 3400
              - 2920
              - 200
              - 80
            value: Get owner
            parent: "1"
          description: ""
        stepID: "88"
        results:
          - expr: user
            target: owner
        arguments:
          - expr: record.values.OwnerId
            type: ID
            target: lookup
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "136"
            xywh:
              - 3120
              - 2760
              - 200
              - 80
            value: Has owner?
            parent: "1"
          description: ""
        stepID: "136"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "139"
            xywh:
              - 2560
              - 2920
              - 200
              - 80
            value: Prepare render Vars
            parent: "1"
          description: ""
        stepID: "139"
        results: []
        arguments:
          - type: Vars
            target: subjectRenderVariables
          - expr: record
            type: ComposeRecord
            target: subjectRenderVariables.lead
          - type: Vars
            target: contentRenderVariables
          - expr: record
            type: ComposeRecord
            target: contentRenderVariables.lead
          - expr: account
            type: ComposeRecord
            target: contentRenderVariables.account
    paths:
      - expr: record.values.Status == "Converted"
        meta:
          name: ""
          visual:
            id: "19"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "20"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "6"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "23"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "6"
      - meta:
          name: ""
          visual:
            id: "26"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "10"
        parentID: "9"
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "11"
        parentID: "10"
      - meta:
          name: ""
          visual:
            id: "80"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "79"
        parentID: "17"
      - meta:
          name: ""
          visual:
            id: "82"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "136"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "84"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "83"
        parentID: "81"
      - meta:
          name: ""
          visual:
            id: "86"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "88"
        parentID: "83"
      - meta:
          name: ""
          visual:
            id: "87"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "17"
        parentID: "85"
      - meta:
          name: ""
          visual:
            id: "89"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "85"
        parentID: "88"
      - meta:
          name: ""
          visual:
            id: "107"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "8"
        parentID: "7"
      - meta:
          name: ""
          visual:
            id: "108"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "9"
        parentID: "8"
      - meta:
          name: ""
          visual:
            id: "109"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "12"
        parentID: "11"
      - meta:
          name: ""
          visual:
            id: "110"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "13"
        parentID: "12"
      - expr: record.values.OwnerId != 0
        meta:
          name: ""
          visual:
            id: "137"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "139"
        parentID: "136"
      - meta:
          name: ""
          visual:
            id: "138"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points:
              - x: 3960
                "y": 2800
              - x: 3960
                "y": 3040
              - x: 2520
                "y": 3040
              - x: 2520
                "y": 3120
          description: ""
        childID: "17"
        parentID: "136"
      - meta:
          name: ""
          visual:
            id: "140"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "81"
        parentID: "139"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Lead
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2200
              - 2200
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "111"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: To Account
            parent: "1"
          description: ""
  CRM-Account-CreateNewContract:
    enabled: true
    meta:
      name: CRM - Account - Create New Contract
      visual: null
      description: Creates new Contract record from an existing Account
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2424
              - 2200
              - 200
              - 80
            value: Fetch settings
            parent: "1"
          description: ""
        stepID: "3"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2680
              - 2200
              - 200
              - 80
            value: Prepare setting values
            parent: "1"
          description: ""
        stepID: "4"
        results: []
        arguments:
          - expr: 'settings.values.ContractNextNumber ? settings.values.ContractNextNumber : 0'
            type: Integer
            target: nextContractNumber
          - expr: 'settings.values.ContractDefaultTime ? settings.values.ContractDefaultTime : 0'
            type: Integer
            target: contractDefaultTime
          - expr: settings.values.ContractNextNumber + 1
            type: Integer
            target: settings.values.ContractNextNumber
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2392
              - 2360
              - 200
              - 80
            value: Prepare contract record
            parent: "1"
          description: ""
        stepID: "5"
        results:
          - expr: record
            target: contract
        arguments:
          - type: Handle
            value: Contract
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2648
              - 2360
              - 200
              - 80
            value: Update contract data
            parent: "1"
          description: ""
        stepID: "6"
        results: []
        arguments:
          - expr: record.recordID
            type: ID
            target: contract.values.AccountId
          - expr: '"Draft"'
            type: String
            target: contract.values.Status
          - expr: record.values.BillingStreet
            type: String
            target: contract.values.BillingStreet
          - expr: record.values.BillingCity
            type: String
            target: contract.values.BillingCity
          - expr: record.values.BillingState
            type: String
            target: contract.values.BillingState
          - expr: record.values.BillingPostalCode
            type: String
            target: contract.values.BillingPostalCode
          - expr: record.values.BillingCountry
            type: String
            target: contract.values.BillingCountry
          - expr: record.values.BillingStreet
            type: String
            target: contract.values.ShippingStreet
          - expr: record.values.BillingCity
            type: String
            target: contract.values.ShippingCity
          - expr: record.values.BillingState
            type: String
            target: contract.values.ShippingState
          - expr: record.values.BillingPostalCode
            type: String
            target: contract.values.ShippingPostalCode
          - expr: record.values.BillingCountry
            type: String
            target: contract.values.ShippingCountry
          - expr: contractDefaultTime
            type: Integer
            target: contract.values.ContractTerm
          - expr: nextContractNumber
            type: Integer
            target: contract.values.ContractNumber
          - expr: record.values.OwnerId
            type: ID
            target: contract.values.OwnerId
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2920
              - 2360
              - 200
              - 80
            value: Save contract
            parent: "1"
          description: ""
        stepID: "7"
        results:
          - expr: record
            target: contract
        arguments:
          - type: ComposeRecord
            source: contract
            target: record
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2400
              - 2560
              - 200
              - 80
            value: Update settings
            parent: "1"
          description: ""
        stepID: "8"
        results:
          - expr: record
            target: settings
        arguments:
          - type: ComposeRecord
            source: settings
            target: record
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2400
              - 2720
              - 200
              - 80
            value: Notify user
            parent: "1"
          description: ""
        stepID: "9"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: The new contract record has been created
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "22"
            xywh:
              - 2680
              - 2720
              - 200
              - 80
            value: Redirect user
            parent: "1"
          description: ""
        stepID: "22"
        results: []
        arguments:
          - type: Handle
            value: Contract
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: contract
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
    paths:
      - meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "4"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "4"
      - meta:
          name: ""
          visual:
            id: "14"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "6"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "17"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "6"
      - meta:
          name: ""
          visual:
            id: "18"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "8"
        parentID: "7"
      - meta:
          name: ""
          visual:
            id: "19"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "9"
        parentID: "8"
      - meta:
          name: ""
          visual:
            id: "23"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "22"
        parentID: "9"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Account
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2120
              - 2200
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "11"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Create new Contract
            parent: "1"
          description: ""
  CRM-Case-SetStatusToWorking:
    enabled: true
    meta:
      name: CRM - Case - Set Status To Working
      visual: null
      description: Creates new Contract record from an existing Account
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2680
              - 2000
              - 200
              - 80
            value: Set status
            parent: "1"
          description: ""
        stepID: "3"
        results: []
        arguments:
          - expr: '"Working"'
            type: String
            target: record.values.Status
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2680
              - 2200
              - 200
              - 80
            value: Update case
            parent: "1"
          description: ""
        stepID: "4"
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2960
              - 2000
              - 200
              - 80
            value: Prepare case update
            parent: "1"
          description: ""
        stepID: "5"
        results:
          - expr: record
            target: caseUpdate
        arguments:
          - type: Handle
            value: CaseUpdate
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2960
              - 2200
              - 200
              - 80
            value: Set case update data
            parent: "1"
          description: ""
        stepID: "6"
        results: []
        arguments:
          - expr: record.recordID
            type: ID
            target: caseUpdate.values.CaseId
          - expr: '"State set to \"Working\""'
            type: String
            target: caseUpdate.values.Description
          - expr: '"State change"'
            type: String
            target: caseUpdate.values.Type
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 3240
              - 2000
              - 200
              - 80
            value: Create case update
            parent: "1"
          description: ""
        stepID: "7"
        results:
          - expr: record
            target: caseUpdate
        arguments:
          - expr: caseUpdate
            type: ComposeRecord
            target: record
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2320
              - 2000
              - 200
              - 80
            value: Check if Status is "Working"
            parent: "1"
          description: ""
        stepID: "14"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2320
              - 2200
              - 200
              - 80
            value: 'Warning: Status already set to "Working"'
            parent: "1"
          description: ""
        stepID: "19"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Case Status already set to "Working"
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 3240
              - 2200
              - 200
              - 80
            value: Refresh page
            parent: "1"
          description: ""
        stepID: "20"
        results: []
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
          - expr: "false"
            type: Boolean
            target: edit
    paths:
      - meta:
          name: ""
          visual:
            id: "10"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "4"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "11"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "4"
      - meta:
          name: ""
          visual:
            id: "12"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "6"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "6"
      - expr: record.values.Status != "Working"
        meta:
          name: ""
          visual:
            id: "16"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "3"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "18"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "19"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "21"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "20"
        parentID: "7"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Case
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 14
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2000
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "15"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "14"
                parentID: "2"
            value: Set case working
            parent: "1"
          description: ""
  CRM-Opportunity-NewQuote:
    enabled: true
    meta:
      name: CRM - Opportunity - New Quote
      visual: null
      description: Creates a new Quote record from an  existing Opportunity
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2240
              - 2200
              - 200
              - 80
            value: Initial record validation
            parent: "1"
            defaultName: false
          description: ""
        stepID: "3"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2600
              - 2200
              - 200
              - 80
            value: Notify missing account
            parent: "1"
            defaultName: false
          description: ""
        stepID: "4"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please link the opportunity to an account before generating a quote
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2840
              - 2200
              - 200
              - 80
            value: Invalid record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "5"
        results: []
        arguments: []
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2240
              - 2360
              - 200
              - 80
            value: Fetch settings
            parent: "1"
            defaultName: false
          description: ""
        stepID: "6"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2480
              - 2360
              - 200
              - 80
            value: Prepare setting values
            parent: "1"
            defaultName: false
          description: ""
        stepID: "7"
        results: []
        arguments:
          - expr: settings.values.QuoteNextNumber
            type: Integer
            target: nextQuoteNumber
          - expr: settings.values.QuoteNextNumber + 1
            type: Integer
            target: settings.values.QuoteNextNumber
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2240
              - 2520
              - 200
              - 80
            value: Fetch related account
            parent: "1"
            defaultName: false
          description: ""
        stepID: "8"
        results:
          - expr: record
            target: account
        arguments:
          - type: Handle
            value: Account
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: record.values.AccountId
            type: ID
            target: record
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2520
              - 2720
              - 200
              - 80
            value: Fetch related contact
            parent: "1"
            defaultName: false
          description: ""
        stepID: "9"
        results:
          - expr: records
            target: contacts
          - expr: total
            target: contactCount
        arguments:
          - type: Handle
            value: Contact
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"AccountId=" + account.recordID'
            type: String
            target: query
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 2760
              - 2720
              - 200
              - 80
            value: Only one contact?
            parent: "1"
            defaultName: false
          description: ""
        stepID: "10"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2776
              - 2880
              - 200
              - 80
            value: Use the only contact
            parent: "1"
            defaultName: false
          description: ""
        stepID: "11"
        results: []
        arguments:
          - expr: contacts[0]
            type: ComposeRecord
            target: contact
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 3176
              - 2720
              - 200
              - 80
            value: Find the primary contact
            parent: "1"
            defaultName: false
          description: ""
        stepID: "12"
        results:
          - expr: item
            target: c
        arguments:
          - expr: contacts
            type: Array
            target: items
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 3168
              - 2880
              - 200
              - 80
            value: Is primary contact?
            parent: "1"
            defaultName: false
          description: ""
        stepID: "13"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 3168
              - 3000
              - 200
              - 80
            value: Set contact
            parent: "1"
            defaultName: false
          description: ""
        stepID: "14"
        results: []
        arguments:
          - expr: c
            type: ComposeRecord
            target: contact
      - ref: ""
        kind: break
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 3160
              - 3120
              - 200
              - 80
            value: Primary contact found
            parent: "1"
            defaultName: false
          description: ""
        stepID: "15"
        results: []
        arguments: []
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 3536
              - 2880
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "16"
        results: []
        arguments: []
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2240
              - 3240
              - 200
              - 80
            value: Prepare quote record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "17"
        results:
          - expr: record
            target: quote
        arguments:
          - type: Handle
            value: Quote
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 2496
              - 3240
              - 200
              - 80
            value: Set quote parameters
            parent: "1"
            defaultName: false
          description: ""
        stepID: "18"
        results: []
        arguments:
          - expr: '"Draft"'
            type: String
            target: quote.values.Status
          - expr: record.recordID
            type: ID
            target: quote.values.OpportunityId
          - expr: record.values.Amount
            type: Float
            target: quote.values.GrandTotal
          - expr: record.values.PricebookId
            type: ID
            target: quote.values.PricebookId
          - expr: record.values.Name
            type: String
            target: quote.values.Name
          - expr: record.values.Amount
            type: Float
            target: quote.values.Subtotal
          - expr: record.values.Amount
            type: Float
            target: quote.values.TotalPrice
          - expr: contact.recordID
            type: ID
            target: quote.values.ContactId
          - expr: contact.values.Email
            type: String
            target: quote.values.Email
          - expr: contact.values.Phone
            type: String
            target: quote.values.Phone
          - expr: contact.values.Fax
            type: String
            target: quote.values.Fax
          - expr: account.recordID
            type: ID
            target: quote.values.AccountId
          - expr: account.values.BillingStreet
            type: String
            target: quote.values.BillingStreet
          - expr: account.values.BillingCity
            type: String
            target: quote.values.BillingCity
          - expr: account.values.BillingState
            type: String
            target: quote.values.BillingState
          - expr: account.values.BillingPostalCode
            type: String
            target: quote.values.BillingPostalCode
          - expr: account.values.BillingCountry
            type: String
            target: quote.values.BillingCountry
          - expr: account.values.AccountName
            type: String
            target: quote.values.BillingName
          - expr: account.values.BillingStreet
            type: String
            target: quote.values.QuoteToStreet
          - expr: account.values.BillingCity
            type: String
            target: quote.values.QuoteToCity
          - expr: account.values.BillingState
            type: String
            target: quote.values.QuoteToState
          - expr: account.values.BillingPostalCode
            type: String
            target: quote.values.QuoteToPostalCode
          - expr: account.values.BillingCountry
            type: String
            target: quote.values.QuoteToCountry
          - expr: account.values.AccountName
            type: String
            target: quote.values.QuoteToName
          - expr: account.values.BillingStreet
            type: String
            target: quote.values.ShippingStreet
          - expr: account.values.BillingCity
            type: String
            target: quote.values.ShippingCity
          - expr: account.values.BillingState
            type: String
            target: quote.values.ShippingState
          - expr: account.values.BillingPostalCode
            type: String
            target: quote.values.ShippingPostalCode
          - expr: account.values.BillingCountry
            type: String
            target: quote.values.ShippingCountry
          - expr: account.values.AccountName
            type: String
            target: quote.values.ShippingName
          - expr: modDate(now(), settings.values.QuoteExpirationDays)
            type: DateTime
            target: quote.values.ExpirationDate
          - expr: nextQuoteNumber
            type: Integer
            target: quote.values.QuoteNumber
          - expr: record.values.CoverTemplate
            type: ID
            target: quote.values.CoverTemplate
          - expr: record.values.TermbookIds
            type: Any
            target: quote.values.TermbookIds
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2784
              - 3240
              - 200
              - 80
            value: Save quote
            parent: "1"
            defaultName: false
          description: ""
        stepID: "19"
        results:
          - expr: record
            target: quote
        arguments:
          - type: ComposeRecord
            source: quote
            target: record
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2240
              - 3440
              - 200
              - 80
            value: Convert opportunity line items to quote line items
            parent: "1"
            defaultName: false
          description: ""
        stepID: "20"
        results:
          - expr: record
            target: opportunityLineItem
        arguments:
          - type: Handle
            value: OpportunityLineItem
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"OpportunityId="+record.recordID'
            type: String
            target: query
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2600
              - 3440
              - 200
              - 80
            value: Prepare a quote line item
            parent: "1"
            defaultName: false
          description: ""
        stepID: "21"
        results:
          - expr: record
            type: ComposeRecord
            target: quoteLineItem
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "22"
            xywh:
              - 2880
              - 3440
              - 200
              - 80
            value: Set quote line item parameters
            parent: "1"
            defaultName: false
          description: ""
        stepID: "22"
        results: []
        arguments:
          - expr: opportunityLineItem.values.Discount
            type: Float
            target: quoteLineItem.values.Discount
          - expr: opportunityLineItem.values.Description
            type: String
            target: quoteLineItem.values.Description
          - expr: opportunityLineItem.values.ListPrice
            type: Float
            target: quoteLineItem.values.ListPrice
          - expr: opportunityLineItem.values.PricebookEntryId
            type: Any
            target: quoteLineItem.values.PricebookEntryId
          - expr: opportunityLineItem.values.ProductId
            type: ID
            target: quoteLineItem.values.ProductId
          - expr: opportunityLineItem.values.ProductCode
            type: String
            target: quoteLineItem.values.ProductCode
          - expr: opportunityLineItem.values.Quantity
            type: Integer
            target: quoteLineItem.values.Quantity
          - expr: opportunityLineItem.values.UnitPrice
            type: Float
            target: quoteLineItem.values.UnitPrice
          - expr: opportunityLineItem.values.Subtotal
            type: Float
            target: quoteLineItem.values.Subtotal
          - expr: opportunityLineItem.values.TotalPrice
            type: Float
            target: quoteLineItem.values.TotalPrice
          - expr: quote.recordID
            type: ID
            target: quoteLineItem.values.QuoteId
          - expr: opportunityLineItem.values.Name
            type: String
            target: quoteLineItem.values.Name
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 3160
              - 3440
              - 200
              - 80
            value: Save quote line item
            parent: "1"
            defaultName: false
          description: ""
        stepID: "23"
        results:
          - expr: record
            target: quoteLineItem
        arguments:
          - expr: quoteLineItem
            type: ComposeRecord
            target: record
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 3440
              - 3440
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "24"
        results: []
        arguments: []
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "25"
            xywh:
              - 2240
              - 3840
              - 200
              - 80
            value: Update settings
            parent: "1"
            defaultName: false
          description: ""
        stepID: "25"
        results:
          - expr: record
            target: settings
        arguments:
          - type: ComposeRecord
            source: settings
            target: record
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2248
              - 3984
              - 200
              - 80
            value: Notify success
            parent: "1"
            defaultName: false
          description: ""
        stepID: "26"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נוצרה בהצלחה.
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 2240
              - 2720
              - 200
              - 80
            value: Prepare default contact
            parent: "1"
            defaultName: false
          description: ""
        stepID: "38"
        results:
          - expr: record
            target: contact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "71"
            xywh:
              - 2528
              - 3984
              - 200
              - 80
            value: Redirect to quote edit
            parent: "1"
            defaultName: false
          description: ""
        stepID: "71"
        results: []
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: quote
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 3440
              - 3640
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "73"
        results: []
        arguments: []
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "74"
            xywh:
              - 2600
              - 3640
              - 200
              - 80
            value: Prepare a quote included item
            parent: "1"
            defaultName: false
          description: ""
        stepID: "74"
        results:
          - expr: record
            type: ComposeRecord
            target: quoteIncludedItem
        arguments:
          - type: Handle
            value: QuoteIncludedItem
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 3160
              - 3640
              - 200
              - 80
            value: Save quote included item
            parent: "1"
            defaultName: false
          description: ""
        stepID: "75"
        results:
          - expr: record
            type: ComposeRecord
            target: quoteIncludedItem
        arguments:
          - expr: quoteIncludedItem
            type: ComposeRecord
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "76"
            xywh:
              - 2880
              - 3640
              - 200
              - 80
            value: Set quote included item parameters
            parent: "1"
            defaultName: false
          description: ""
        stepID: "76"
        results: []
        arguments:
          - expr: opportunityIncludedItem.values.Description
            type: String
            target: quoteIncludedItem.values.Description
          - expr: opportunityIncludedItem.values.ProductId
            type: ID
            target: quoteIncludedItem.values.ProductId
          - expr: opportunityIncludedItem.values.ProductCode
            type: String
            target: quoteIncludedItem.values.ProductCode
          - expr: opportunityIncludedItem.values.Quantity
            type: Integer
            target: quoteIncludedItem.values.Quantity
          - expr: quote.recordID
            type: ID
            target: quoteIncludedItem.values.QuoteId
          - expr: opportunityIncludedItem.values.Discount
            type: Float
            target: quoteIncludedItem.values.Discount
          - expr: opportunityIncludedItem.values.ListPrice
            type: Float
            target: quoteIncludedItem.values.ListPrice
          - expr: opportunityIncludedItem.values.PricebookEntryId
            type: Any
            target: quoteIncludedItem.values.PricebookEntryId
          - expr: opportunityIncludedItem.values.UnitPrice
            type: Float
            target: quoteIncludedItem.values.UnitPrice
          - expr: opportunityIncludedItem.values.Subtotal
            type: Float
            target: quoteIncludedItem.values.Subtotal
          - expr: opportunityIncludedItem.values.TotalPrice
            type: Float
            target: quoteIncludedItem.values.TotalPrice
          - expr: opportunityIncludedItem.values.Name
            type: String
            target: quoteIncludedItem.values.Name
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "78"
            xywh:
              - 2240
              - 3640
              - 200
              - 80
            value: Convert opportunity included items to quote line items
            parent: "1"
            defaultName: false
          description: ""
        stepID: "78"
        results:
          - expr: record
            type: ComposeRecord
            target: opportunityIncludedItem
        arguments:
          - type: Handle
            value: OpportunityIncludedItem
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"OpportunityId="+record.recordID'
            type: String
            target: query
    paths:
      - expr: 'record.values.AccountId ? false : true'
        meta:
          name: ""
          visual:
            id: "30"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "4"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "31"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "6"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "32"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "4"
      - meta:
          name: ""
          visual:
            id: "33"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "6"
      - meta:
          name: ""
          visual:
            id: "34"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "8"
        parentID: "7"
      - meta:
          name: ""
          visual:
            id: "36"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "10"
        parentID: "9"
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "38"
        parentID: "8"
      - meta:
          name: ""
          visual:
            id: "40"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "9"
        parentID: "38"
      - expr: contactCount == 1
        meta:
          name: ""
          visual:
            id: "41"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "11"
        parentID: "10"
      - meta:
          name: ""
          visual:
            id: "42"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "12"
        parentID: "10"
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Loop body'
            parent: "1"
            points: []
          description: ""
        childID: "13"
        parentID: "12"
      - expr: c.values.IsPrimary
        meta:
          name: ""
          visual:
            id: "44"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "45"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "15"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "17"
        parentID: "11"
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;
            value: '#2 - Loop end'
            parent: "1"
            points:
              - x: 3824
                "y": 2760
              - x: 3824
                "y": 3216
              - x: 2200
                "y": 3216
              - x: 2200
                "y": 3300
          description: ""
        childID: "17"
        parentID: "12"
      - meta:
          name: ""
          visual:
            id: "52"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Loop body'
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "20"
      - meta:
          name: ""
          visual:
            id: "53"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "22"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "54"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "23"
        parentID: "22"
      - meta:
          name: ""
          visual:
            id: "55"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "24"
        parentID: "23"
      - meta:
          name: ""
          visual:
            id: "56"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Loop end'
            parent: "1"
            points: []
          description: ""
        childID: "78"
        parentID: "20"
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "25"
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "18"
        parentID: "17"
      - meta:
          name: ""
          visual:
            id: "69"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "19"
        parentID: "18"
      - meta:
          name: ""
          visual:
            id: "70"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "20"
        parentID: "19"
      - meta:
          name: ""
          visual:
            id: "72"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "71"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "79"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Loop body'
            parent: "1"
            points: []
          description: ""
        childID: "74"
        parentID: "78"
      - meta:
          name: ""
          visual:
            id: "80"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "76"
        parentID: "74"
      - meta:
          name: ""
          visual:
            id: "81"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "75"
        parentID: "76"
      - meta:
          name: ""
          visual:
            id: "82"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "73"
        parentID: "75"
      - meta:
          name: ""
          visual:
            id: "84"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "25"
        parentID: "78"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Opportunity
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2000
              - 2200
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "29"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Create a new quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Lead-UpdateCampaigns:
    enabled: true
    meta:
      name: CRM - Lead - Update Campaigns
      visual: null
      description: Update related Campaigns after a Lead is created, updated or deleted
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2440
              - 2120
              - 200
              - 80
            value: Set CampaignIds
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments:
          - expr: '[]'
            type: Array
            target: campaignIDs
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2680
              - 2120
              - 200
              - 80
            value: Iterate record CampaignIDs
            parent: "1"
          description: ""
        stepID: "14"
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'record.recordID != "0" ? record.values.CampaignId : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2680
              - 2440
              - 200
              - 80
            value: Push campaignID
            parent: "1"
          description: ""
        stepID: "16"
        results: []
        arguments:
          - expr: push(campaignIDs, "recordID = " + campaignID)
            type: Array
            target: campaignIDs
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2440
              - 200
              - 80
            value: Check next ID
            parent: "1"
          description: ""
        stepID: "21"
        results: []
        arguments: []
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2680
              - 2280
              - 200
              - 80
            value: If already pushed
            parent: "1"
          description: ""
        stepID: "26"
        results: []
        arguments: []
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 3040
              - 2120
              - 200
              - 80
            value: Iterate oldRecord CampaignIDs
            parent: "1"
          description: ""
        stepID: "49"
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'oldRecord.recordID != "0" ? oldRecord.values.CampaignId : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3400
              - 2120
              - 200
              - 80
            value: Set campaign filter
            parent: "1"
          description: ""
        stepID: "58"
        results: []
        arguments:
          - expr: join(campaignIDs, " OR ")
            type: String
            target: campaignFilter
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 3400
              - 2280
              - 200
              - 80
            value: Get Campaigns
            parent: "1"
          description: ""
        stepID: "61"
        results:
          - expr: records
            target: campaigns
          - expr: total
            target: numOfCampaigns
        arguments:
          - type: Handle
            value: Campaigns
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: campaignFilter
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 3400
              - 2440
              - 200
              - 80
            value: Iterate over Campaigns
            parent: "1"
          description: ""
        stepID: "63"
        results:
          - expr: item
            target: campaign
        arguments:
          - expr: campaigns
            type: Array
            target: items
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 3040
              - 2440
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        stepID: "65"
        results: []
        arguments: []
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3720
              - 2120
              - 200
              - 80
            value: Get NumberOfLeads
            parent: "1"
          description: ""
        stepID: "66"
        results:
          - expr: total
            target: NumberOfLeads
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: '"CampaignId = " + campaign.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "71"
            xywh:
              - 3720
              - 2280
              - 200
              - 80
            value: Get NumberOfConvertedLeads
            parent: "1"
          description: ""
        stepID: "71"
        results:
          - expr: total
            target: NumberOfConvertedLeads
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: '"(CampaignId = " + campaign.recordID + ") AND IsConverted"'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 3720
              - 2440
              - 200
              - 80
            value: Set Campaign Values
            parent: "1"
          description: ""
        stepID: "73"
        results: []
        arguments:
          - expr: NumberOfLeads
            type: Integer
            target: campaign.values.NumberOfLeads
          - expr: NumberOfConvertedLeads
            type: Integer
            target: campaign.values.NumberOfConvertedLeads
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 4040
              - 2280
              - 200
              - 80
            value: Save Campaign
            parent: "1"
          description: ""
        stepID: "75"
        results: []
        arguments:
          - expr: campaign
            type: ComposeRecord
            target: record
    paths:
      - expr: has(campaignIDs, campaignID)
        meta:
          name: ""
          visual:
            id: "28"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "49"
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "58"
        parentID: "49"
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "61"
        parentID: "58"
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "63"
        parentID: "61"
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "66"
        parentID: "63"
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "65"
        parentID: "63"
      - meta:
          name: ""
          visual:
            id: "72"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "71"
        parentID: "66"
      - meta:
          name: ""
          visual:
            id: "74"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "73"
        parentID: "71"
      - meta:
          name: ""
          visual:
            id: "76"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "75"
        parentID: "73"
      - meta:
          name: ""
          visual:
            id: "91"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "93"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "94"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "49"
        parentID: "14"
    triggers:
      - resourceType: compose:record
        eventType: afterDelete
        constraints:
          - op: =
            name: module.handle
            values:
              - Lead
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 5
        meta:
          visual:
            id: "4"
            xywh:
              - 2160
              - 2240
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "10"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points:
                      - x: 2400
                        "y": 2280
                      - x: 2400
                        "y": 2200
                  description: ""
                childID: "5"
                parentID: "4"
            value: After Delete Lead
            parent: "1"
          description: ""
  CRM-Account-UpdateCampaigns:
    enabled: true
    meta:
      name: CRM - Account - Update Campaigns
      visual: null
      description: Update related Campaigns after a Account is created, updated or deleted
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2440
              - 2120
              - 200
              - 80
            value: Set CampaignIds
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments:
          - expr: '[]'
            type: Array
            target: campaignIDs
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2680
              - 2120
              - 200
              - 80
            value: Iterate record CampaignIDs
            parent: "1"
          description: ""
        stepID: "14"
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'record.recordID != "0" ? record.values.CampaignId : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2680
              - 2440
              - 200
              - 80
            value: Push campaignID
            parent: "1"
          description: ""
        stepID: "16"
        results: []
        arguments:
          - expr: push(campaignIDs, "recordID = " + campaignID)
            type: Array
            target: campaignIDs
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2440
              - 200
              - 80
            value: Check next ID
            parent: "1"
          description: ""
        stepID: "21"
        results: []
        arguments: []
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2680
              - 2280
              - 200
              - 80
            value: If already pushed
            parent: "1"
          description: ""
        stepID: "26"
        results: []
        arguments: []
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 3000
              - 2120
              - 200
              - 80
            value: Iterate oldrecord CampaignIDs
            parent: "1"
          description: ""
        stepID: "49"
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'oldRecord.recordID != "0" ? oldRecord.values.CampaignId : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3320
              - 2120
              - 200
              - 80
            value: Set campaign filter
            parent: "1"
          description: ""
        stepID: "58"
        results: []
        arguments:
          - expr: join(campaignIDs, " OR ")
            type: String
            target: campaignFilter
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 3320
              - 2280
              - 200
              - 80
            value: Get Campaigns
            parent: "1"
          description: ""
        stepID: "61"
        results:
          - expr: records
            target: campaigns
          - expr: total
            target: numOfCampaigns
        arguments:
          - type: Handle
            value: Campaigns
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: campaignFilter
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 3320
              - 2440
              - 200
              - 80
            value: Iterate over Campaigns
            parent: "1"
          description: ""
        stepID: "63"
        results:
          - expr: item
            target: campaign
        arguments:
          - expr: campaigns
            type: Array
            target: items
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 3000
              - 2440
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        stepID: "65"
        results: []
        arguments: []
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3640
              - 2120
              - 200
              - 80
            value: Get NumberOfAccounts
            parent: "1"
          description: ""
        stepID: "66"
        results:
          - expr: total
            target: NumberOfAccounts
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: '"CampaignId = " + campaign.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 3640
              - 2280
              - 200
              - 80
            value: Set Campaign Values
            parent: "1"
          description: ""
        stepID: "73"
        results: []
        arguments:
          - expr: NumberOfAccounts
            type: Integer
            target: campaign.values.NumberOfAccounts
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 3640
              - 2440
              - 200
              - 80
            value: Save Campaign
            parent: "1"
          description: ""
        stepID: "75"
        results: []
        arguments:
          - expr: campaign
            type: ComposeRecord
            target: record
    paths:
      - expr: has(campaignIDs, campaignID)
        meta:
          name: ""
          visual:
            id: "28"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "49"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "49"
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "58"
        parentID: "49"
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "61"
        parentID: "58"
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "63"
        parentID: "61"
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "66"
        parentID: "63"
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "65"
        parentID: "63"
      - meta:
          name: ""
          visual:
            id: "76"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "75"
        parentID: "73"
      - meta:
          name: ""
          visual:
            id: "77"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "73"
        parentID: "66"
    triggers:
      - resourceType: compose:record
        eventType: afterDelete
        constraints:
          - op: =
            name: module.handle
            values:
              - Account
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 5
        meta:
          visual:
            id: "4"
            xywh:
              - 2160
              - 2240
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "10"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points:
                      - x: 2400
                        "y": 2280
                      - x: 2400
                        "y": 2200
                  description: ""
                childID: "5"
                parentID: "4"
            value: After Delete Account
            parent: "1"
          description: ""
  CRM-Contact-UpdateCampaigns:
    enabled: true
    meta:
      name: CRM - Contact - Update Campaigns
      visual: null
      description: Update related Campaigns after a Contact is created, updated or deleted
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2440
              - 2120
              - 200
              - 80
            value: Set CampaignIds
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments:
          - expr: '[]'
            type: Array
            target: campaignIDs
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2680
              - 2120
              - 200
              - 80
            value: Iterate record CampaignIDs
            parent: "1"
          description: ""
        stepID: "14"
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'record.recordID != "0" ? record.values.CampaignId : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2680
              - 2440
              - 200
              - 80
            value: Push campaignID
            parent: "1"
          description: ""
        stepID: "16"
        results: []
        arguments:
          - expr: push(campaignIDs, "recordID = " + campaignID)
            type: Array
            target: campaignIDs
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2440
              - 200
              - 80
            value: Check next ID
            parent: "1"
          description: ""
        stepID: "21"
        results: []
        arguments: []
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2680
              - 2280
              - 200
              - 80
            value: If already pushed
            parent: "1"
          description: ""
        stepID: "26"
        results: []
        arguments: []
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 3000
              - 2120
              - 200
              - 80
            value: Iterate oldrecord CampaignIDs
            parent: "1"
          description: ""
        stepID: "49"
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'oldRecord.recordID != "0" ? oldRecord.values.CampaignId : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3320
              - 2120
              - 200
              - 80
            value: Set campaign filter
            parent: "1"
          description: ""
        stepID: "58"
        results: []
        arguments:
          - expr: join(campaignIDs, " OR ")
            type: String
            target: campaignFilter
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 3320
              - 2280
              - 200
              - 80
            value: Get Campaigns
            parent: "1"
          description: ""
        stepID: "61"
        results:
          - expr: records
            target: campaigns
          - expr: total
            target: numOfCampaigns
        arguments:
          - type: Handle
            value: Campaigns
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: campaignFilter
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 3320
              - 2440
              - 200
              - 80
            value: Iterate over Campaigns
            parent: "1"
          description: ""
        stepID: "63"
        results:
          - expr: item
            target: campaign
        arguments:
          - expr: campaigns
            type: Array
            target: items
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 3000
              - 2440
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        stepID: "65"
        results: []
        arguments: []
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3640
              - 2120
              - 200
              - 80
            value: Get NumberOfContacts
            parent: "1"
          description: ""
        stepID: "66"
        results:
          - expr: total
            target: NumberOfContacts
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: '"CampaignId = " + campaign.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 3640
              - 2280
              - 200
              - 80
            value: Set Campaign Values
            parent: "1"
          description: ""
        stepID: "73"
        results: []
        arguments:
          - expr: NumberOfContacts
            type: Integer
            target: campaign.values.NumberOfContacts
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 3640
              - 2440
              - 200
              - 80
            value: Save Campaign
            parent: "1"
          description: ""
        stepID: "75"
        results: []
        arguments:
          - expr: campaign
            type: ComposeRecord
            target: record
    paths:
      - expr: has(campaignIDs, campaignID)
        meta:
          name: ""
          visual:
            id: "28"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "49"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "49"
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "58"
        parentID: "49"
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "61"
        parentID: "58"
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "63"
        parentID: "61"
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "66"
        parentID: "63"
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "65"
        parentID: "63"
      - meta:
          name: ""
          visual:
            id: "76"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "75"
        parentID: "73"
      - meta:
          name: ""
          visual:
            id: "77"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "73"
        parentID: "66"
    triggers:
      - resourceType: compose:record
        eventType: afterDelete
        constraints:
          - op: =
            name: module.handle
            values:
              - Contact
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 5
        meta:
          visual:
            id: "4"
            xywh:
              - 2160
              - 2240
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "10"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points:
                      - x: 2400
                        "y": 2280
                      - x: 2400
                        "y": 2200
                  description: ""
                childID: "5"
                parentID: "4"
            value: After Delete Contact
            parent: "1"
          description: ""
  CRM-Lead-ToAccountAndOpportunity:
    enabled: true
    meta:
      name: CRM - Lead - To Account and Opportunity
      visual: null
      description: Converts Lead to Account and Opportunity
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "35"
            xywh:
              - 2488
              - 2520
              - 200
              - 80
            value: Already converted?
            parent: "1"
            defaultName: false
          description: ""
        stepID: "35"
        results: []
        arguments: []
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "37"
            xywh:
              - 2496
              - 2720
              - 200
              - 80
            value: Prepare account record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "37"
        results:
          - expr: record
            target: account
        arguments:
          - type: Handle
            value: Account
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 2728
              - 2720
              - 200
              - 80
            value: Populate account data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "38"
        results: []
        arguments:
          - expr: record.values.Street
            type: String
            target: account.values.BillingStreet
          - expr: record.values.City
            type: String
            target: account.values.BillingCity
          - expr: record.values.State
            type: String
            target: account.values.BillingState
          - expr: record.values.PostalCode
            type: String
            target: account.values.BillingPostalCode
          - expr: record.values.Country
            type: String
            target: account.values.BillingCountry
          - expr: record.values.Street
            type: String
            target: account.values.ShippingStreet
          - expr: record.values.City
            type: String
            target: account.values.ShippingCity
          - expr: record.values.State
            type: String
            target: account.values.ShippingState
          - expr: record.values.PostalCode
            type: String
            target: account.values.ShippingPostalCode
          - expr: record.values.Country
            type: String
            target: account.values.ShippingCountry
          - expr: record.values.AnnualRevenue
            type: String
            target: account.values.AnnualRevenue
          - expr: record.values.Description
            type: String
            target: account.values.Description
          - expr: record.values.Company
            type: String
            target: account.values.AccountName
          - expr: record.values.Fax
            type: String
            target: account.values.Fax
          - expr: record.values.Industry
            type: String
            target: account.values.Industry
          - expr: record.values.OwnerId
            type: ID
            target: account.values.OwnerId
          - expr: record.values.LeadSource
            type: String
            target: account.values.AccountSource
          - expr: record.values.Phone
            type: String
            target: account.values.Phone
          - expr: record.values.NumberOfEmployees
            type: Integer
            target: account.values.NumberOfEmployees
          - expr: record.values.Rating
            type: String
            target: account.values.Rating
          - expr: record.values.Website
            type: String
            target: account.values.Website
          - expr: record.values.Twitter
            type: String
            target: account.values.Twitter
          - expr: record.values.Facebook
            type: String
            target: account.values.Facebook
          - expr: record.values.LinkedIn
            type: String
            target: account.values.LinkedIn
          - expr: record.values.OwnerId
            type: ID
            target: account.values.OwnerId
          - expr: record.values.CampaignId
            type: Array
            target: account.values.CampaignId
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "39"
            xywh:
              - 2968
              - 2720
              - 200
              - 80
            value: Create account
            parent: "1"
            defaultName: false
          description: ""
        stepID: "39"
        results:
          - expr: record
            target: account
        arguments:
          - type: ComposeRecord
            source: account
            target: record
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "40"
            xywh:
              - 2512
              - 2904
              - 200
              - 80
            value: Prepare contact record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "40"
        results:
          - expr: record
            target: contact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "41"
            xywh:
              - 2768
              - 2904
              - 200
              - 80
            value: Populate contact data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "41"
        results: []
        arguments:
          - expr: record.values.Street
            type: String
            target: contact.values.MailingStreet
          - expr: record.values.City
            type: String
            target: contact.values.MailingCity
          - expr: record.values.State
            type: String
            target: contact.values.MailingState
          - expr: record.values.PostalCode
            type: String
            target: contact.values.MailingPostalCode
          - expr: record.values.Country
            type: String
            target: contact.values.MailingCountry
          - expr: record.values.Description
            type: String
            target: contact.values.Description
          - expr: record.values.DoNotCall
            type: Boolean
            target: contact.values.DoNotCall
          - expr: record.values.Email
            type: String
            target: contact.values.Email
          - expr: record.values.HasOptedOutOfEmail
            type: Boolean
            target: contact.values.HasOptedOutOfEmail
          - expr: record.values.Fax
            type: String
            target: contact.values.Fax
          - expr: record.values.HasOptedOutOfFax
            type: Boolean
            target: contact.values.HasOptedOutOfFax
          - expr: record.values.OwnerId
            type: ID
            target: contact.values.OwnerId
          - expr: record.values.LeadSource
            type: String
            target: contact.values.LeadSource
          - expr: record.values.Twitter
            type: String
            target: contact.values.Twitter
          - expr: record.values.Facebook
            type: String
            target: contact.values.Facebook
          - expr: record.values.LinkedIn
            type: String
            target: contact.values.LinkedIn
          - expr: record.values.Salutation
            type: String
            target: contact.values.Salutation
          - expr: record.values.FirstName
            type: String
            target: contact.values.FirstName
          - expr: record.values.LastName
            type: String
            target: contact.values.LastName
          - expr: record.values.MobilePhone
            type: String
            target: contact.values.MobilePhone
          - expr: record.values.Phone
            type: String
            target: contact.values.Phone
          - expr: record.values.Title
            type: String
            target: contact.values.Title
          - expr: "true"
            type: Boolean
            target: contact.values.IsPrimary
          - expr: account.recordID
            type: ID
            target: contact.values.AccountId
          - expr: record.values.OwnerId
            type: ID
            target: contact.values.OwnerId
          - expr: record.values.CampaignId
            type: Array
            target: contact.values.CampaignId
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "42"
            xywh:
              - 3032
              - 2904
              - 200
              - 80
            value: Create contact
            parent: "1"
            defaultName: false
          description: ""
        stepID: "42"
        results:
          - expr: record
            target: contact
        arguments:
          - type: ComposeRecord
            source: contact
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "43"
            xywh:
              - 2480
              - 3400
              - 200
              - 80
            value: Update lead data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "43"
        results: []
        arguments:
          - expr: '"Converted"'
            type: String
            target: record.values.Status
          - expr: '"Yes"'
            type: String
            target: record.values.IsConverted
          - expr: account.recordID
            type: ID
            target: record.values.ConvertedAccountId
          - expr: contact.recordID
            type: ID
            target: record.values.ConvertedContactId
          - expr: account.createdAt
            type: DateTime
            target: record.values.ConvertedDate
          - expr: opportunity.recordID
            type: ID
            target: record.values.ConvertedOpportunityId
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "44"
            xywh:
              - 2760
              - 3400
              - 200
              - 80
            value: Save lead
            parent: "1"
            defaultName: false
          description: ""
        stepID: "44"
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "64"
            xywh:
              - 2512
              - 3064
              - 200
              - 80
            value: Prepare opportunity record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "64"
        results:
          - expr: record
            type: ComposeRecord
            target: opportunity
        arguments:
          - type: Handle
            value: Opportunity
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 2768
              - 3064
              - 200
              - 80
            value: Populate opportunity data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "65"
        results: []
        arguments:
          - expr: record.values.Description
            type: String
            target: opportunity.values.Description
          - expr: record.values.OwnerId
            type: ID
            target: opportunity.values.OwnerId
          - expr: record.values.LeadSource
            type: String
            target: opportunity.values.LeadSource
          - expr: '"(unnamed)"'
            type: String
            target: opportunity.values.Name
          - expr: account.recordID
            type: ID
            target: opportunity.values.AccountId
          - expr: '"No"'
            type: String
            target: opportunity.values.IsClosed
          - expr: '"No"'
            type: String
            target: opportunity.values.IsWon
          - expr: modDate(now(), settings.values.OpportunityCloseDateDays)
            type: DateTime
            target: opportunity.values.CloseDate
          - expr: settings.values.OpportunityProbability
            type: Float
            target: opportunity.values.Probability
          - expr: settings.values.OpportunityForecaseCategory
            type: String
            target: opportunity.values.ForecastCategory
          - expr: settings.values.OpportunityStagename
            type: String
            target: opportunity.values.StageName
          - expr: record.values.CampaignId
            type: Array
            target: opportunity.values.CampaignId
          - expr: record.values.Description
            type: String
            target: opportunity.values.Name
          - expr: record.recordID
            type: ID
            target: opportunity.values.LeadRef
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3032
              - 3064
              - 200
              - 80
            value: Create opportunity
            parent: "1"
            defaultName: false
          description: ""
        stepID: "66"
        results:
          - expr: record
            target: opportunity
        arguments:
          - type: ComposeRecord
            source: opportunity
            target: record
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "69"
            xywh:
              - 2488
              - 3216
              - 200
              - 80
            value: Prepare opportunity contact role record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "69"
        results:
          - expr: record
            target: contactRole
        arguments:
          - type: Handle
            value: OpportunityContactRole
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "70"
            xywh:
              - 2784
              - 3224
              - 200
              - 80
            value: Populate opportunity contact role data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "70"
        results: []
        arguments:
          - expr: contact.recordID
            type: ID
            target: contactRole.values.ContactId
          - expr: opportunity.recordID
            type: ID
            target: contactRole.values.OpportunityId
          - expr: "true"
            type: Boolean
            target: contactRole.values.IsPrimary
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "71"
            xywh:
              - 3064
              - 3224
              - 200
              - 80
            value: Create opportunity contact role
            parent: "1"
            defaultName: false
          description: ""
        stepID: "71"
        results:
          - expr: record
            target: contactRole
        arguments:
          - type: ComposeRecord
            source: contactRole
            target: record
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "77"
            xywh:
              - 2208
              - 2520
              - 200
              - 80
            value: Fetch settings
            parent: "1"
            defaultName: false
          description: ""
        stepID: "77"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "113"
            xywh:
              - 2480
              - 3720
              - 200
              - 80
            value: Lead converted
            parent: "1"
            defaultName: false
          description: ""
        stepID: "113"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הליד הומר
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "115"
            xywh:
              - 2768
              - 3720
              - 200
              - 80
            value: Redirect to opportunity page
            parent: "1"
            defaultName: false
          description: ""
        stepID: "115"
        results: []
        arguments:
          - type: Handle
            value: Account
            target: module
          - type: Handle
            value: crm
            target: namespace
          - type: ComposeRecord
            source: opportunity
            target: record
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "118"
            xywh:
              - 3608
              - 3560
              - 200
              - 80
            value: Send email
            parent: "1"
            defaultName: false
          description: ""
        stepID: "118"
        results: []
        arguments:
          - expr: subject.document
            type: Reader
            target: subject
          - expr: owner
            type: User
            target: to
          - expr: content.document
            type: Reader
            target: html
      - ref: usersLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "119"
            xywh:
              - 3328
              - 3560
              - 200
              - 80
            value: Get owner
            parent: "1"
            defaultName: false
          description: ""
        stepID: "119"
        results:
          - expr: user
            target: owner
        arguments:
          - expr: record.values.OwnerId
            type: ID
            target: lookup
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "132"
            xywh:
              - 3040
              - 3400
              - 200
              - 80
            value: Has owner?
            parent: "1"
            defaultName: false
          description: ""
        stepID: "132"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "139"
            xywh:
              - 2840
              - 2520
              - 200
              - 80
            value: Lead already converted
            parent: "1"
            defaultName: false
          description: ""
        stepID: "139"
        results: []
        arguments:
          - type: String
            value: Info
            target: title
          - type: String
            value: This lead is already converted
            target: message
          - type: String
            value: info
            target: variant
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "140"
            xywh:
              - 2760
              - 3560
              - 200
              - 80
            value: Prepare email subject
            parent: "1"
            defaultName: false
          description: ""
        stepID: "140"
        results:
          - expr: document
            target: subject
        arguments:
          - type: Handle
            value: lead_converted_subject
            target: lookup
          - type: String
            value: subject
            target: documentName
          - type: String
            value: text/plain
            target: documentType
          - expr: subjectRenderVariables
            type: Vars
            target: variables
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "142"
            xywh:
              - 3040
              - 3560
              - 200
              - 80
            value: Prepare email content
            parent: "1"
            defaultName: false
          description: ""
        stepID: "142"
        results:
          - expr: document
            target: content
        arguments:
          - type: Handle
            value: lead_converted_content
            target: lookup
          - type: String
            value: content
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: contentRenderVariables
            type: Vars
            target: variables
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "145"
            xywh:
              - 2480
              - 3560
              - 200
              - 80
            value: Prepare render Vars
            parent: "1"
            defaultName: false
          description: ""
        stepID: "145"
        results: []
        arguments:
          - type: Vars
            target: subjectRenderVariables
          - expr: record
            type: ComposeRecord
            target: subjectRenderVariables.lead
          - type: Vars
            target: contentRenderVariables
          - expr: record
            type: ComposeRecord
            target: contentRenderVariables.lead
          - expr: account
            type: ComposeRecord
            target: contentRenderVariables.account
    paths:
      - expr: record.values.Status == "Converted"
        meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "139"
        parentID: "35"
      - meta:
          name: ""
          visual:
            id: "51"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "37"
        parentID: "35"
      - meta:
          name: ""
          visual:
            id: "53"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "38"
        parentID: "37"
      - meta:
          name: ""
          visual:
            id: "54"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "39"
        parentID: "38"
      - meta:
          name: ""
          visual:
            id: "55"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "40"
        parentID: "39"
      - meta:
          name: ""
          visual:
            id: "56"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "41"
        parentID: "40"
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "42"
        parentID: "41"
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "44"
        parentID: "43"
      - meta:
          name: ""
          visual:
            id: "63"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: ""
            parent: "1"
            points: []
          description: ""
        childID: "35"
        parentID: "77"
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "65"
        parentID: "64"
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "66"
        parentID: "65"
      - meta:
          name: ""
          visual:
            id: "74"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "64"
        parentID: "42"
      - meta:
          name: ""
          visual:
            id: "75"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "69"
        parentID: "66"
      - meta:
          name: ""
          visual:
            id: "120"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "115"
        parentID: "113"
      - meta:
          name: ""
          visual:
            id: "123"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "113"
        parentID: "118"
      - meta:
          name: ""
          visual:
            id: "124"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "118"
        parentID: "119"
      - meta:
          name: ""
          visual:
            id: "129"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "71"
        parentID: "70"
      - meta:
          name: ""
          visual:
            id: "130"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "43"
        parentID: "71"
      - meta:
          name: ""
          visual:
            id: "131"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "70"
        parentID: "69"
      - meta:
          name: ""
          visual:
            id: "133"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "132"
        parentID: "44"
      - expr: record.values.OwnerId != 0
        meta:
          name: ""
          visual:
            id: "134"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "145"
        parentID: "132"
      - meta:
          name: ""
          visual:
            id: "135"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points:
              - x: 3880
                "y": 3440
              - x: 3880
                "y": 3680
              - x: 2440
                "y": 3680
              - x: 2440
                "y": 3760
          description: ""
        childID: "113"
        parentID: "132"
      - meta:
          name: ""
          visual:
            id: "143"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "142"
        parentID: "140"
      - meta:
          name: ""
          visual:
            id: "144"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "119"
        parentID: "142"
      - meta:
          name: ""
          visual:
            id: "146"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "140"
        parentID: "145"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Lead
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 77
        meta:
          visual:
            id: "49"
            xywh:
              - 1920
              - 2520
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "78"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "77"
                parentID: "49"
            value: To Account and Opportunity
            parent: "1"
            defaultName: false
          description: ""
  CRM-Contact-CreateNewCase:
    enabled: true
    meta:
      name: CRM - Contact - Create New Case
      visual: null
      description: Creates a new Case record from and existing Contact
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2280
              - 2000
              - 200
              - 80
            value: Fetch settings
            parent: "1"
          description: ""
        stepID: "3"
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2560
              - 2000
              - 200
              - 80
            value: Set nextCaseNumber
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments:
          - expr: 'settings.values.CaseNextNumber ? settings.values.CaseNextNumber : 0'
            type: Integer
            target: nextCaseNumber
          - expr: settings.values.CaseNextNumber + 1
            type: Integer
            target: settings.values.CaseNextNumber
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2000
              - 2160
              - 200
              - 80
            value: Make Case
            parent: "1"
          description: ""
        stepID: "7"
        results:
          - expr: record
            target: case
        arguments:
          - type: Handle
            value: Case
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2280
              - 2160
              - 200
              - 80
            value: Set Case Values
            parent: "1"
          description: ""
        stepID: "9"
        results: []
        arguments:
          - expr: record.values.OwnerId
            type: ID
            target: case.values.OwnerId
          - expr: '"(no subject)"'
            type: String
            target: case.values.Subject
          - expr: record.recordID
            type: ID
            target: case.values.ContactId
          - expr: 'record.values.AccountId ? record.values.AccountId : 0'
            type: ID
            target: case.values.AccountId
          - expr: '"New"'
            type: String
            target: case.values.Status
          - expr: '"Low"'
            type: String
            target: case.values.Priority
          - expr: trim(format("%s %s", record.values.FirstName, record.values.LastName))
            type: String
            target: case.values.SuppliedName
          - expr: record.values.Email
            type: String
            target: case.values.SuppliedEmail
          - expr: record.values.Phone
            type: String
            target: case.values.SuppliedPhone
          - expr: nextCaseNumber
            type: Integer
            target: case.values.CaseNumber
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2560
              - 2160
              - 200
              - 80
            value: Create Case
            parent: "1"
          description: ""
        stepID: "11"
        results:
          - expr: record
            target: case
        arguments:
          - expr: case
            type: ComposeRecord
            target: record
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 2000
              - 2320
              - 200
              - 80
            value: Save settings
            parent: "1"
          description: ""
        stepID: "13"
        results:
          - expr: record
            target: settings
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 2280
              - 2320
              - 200
              - 80
            value: Notify Case created
            parent: "1"
          description: ""
        stepID: "15"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: The new case has been created
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 2560
              - 2320
              - 200
              - 80
            value: Go to record editor
            parent: "1"
          description: ""
        stepID: "18"
        results: []
        arguments:
          - type: Handle
            value: Case
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: case
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
    paths:
      - meta:
          name: ""
          visual:
            id: "6"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "10"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "9"
        parentID: "7"
      - meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "11"
        parentID: "9"
      - meta:
          name: ""
          visual:
            id: "16"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "15"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "17"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "13"
        parentID: "11"
      - meta:
          name: ""
          visual:
            id: "19"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "18"
        parentID: "15"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: namespace.handle
            values:
              - Contact
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2000
              - 2000
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: OnManual Contact
            parent: "1"
          description: ""
  CRM-Opportunity-UpdateCampaigns:
    enabled: true
    meta:
      name: CRM - Opportunity - Update Campaigns
      visual: null
      description: Update related Campaigns after an Opportunity is created, updated or deleted
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2440
              - 2120
              - 200
              - 80
            value: Set CampaignIds
            parent: "1"
          description: ""
        stepID: "5"
        results: []
        arguments:
          - expr: '[]'
            type: Array
            target: campaignIDs
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2680
              - 2120
              - 200
              - 80
            value: Iterate record CampaignIDs
            parent: "1"
          description: ""
        stepID: "14"
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'record.recordID != "0" ? record.values.CampaignId : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2680
              - 2440
              - 200
              - 80
            value: Push campaignID
            parent: "1"
          description: ""
        stepID: "16"
        results: []
        arguments:
          - expr: push(campaignIDs, "recordID = " + campaignID)
            type: Array
            target: campaignIDs
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2440
              - 200
              - 80
            value: Check next ID
            parent: "1"
          description: ""
        stepID: "21"
        results: []
        arguments: []
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2680
              - 2280
              - 200
              - 80
            value: If already pushed
            parent: "1"
          description: ""
        stepID: "26"
        results: []
        arguments: []
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 3040
              - 2120
              - 200
              - 80
            value: Iterate oldRecord CampaignIDs
            parent: "1"
          description: ""
        stepID: "49"
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'oldRecord.recordID != "0" ? oldRecord.values.CampaignId : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3400
              - 2120
              - 200
              - 80
            value: Set campaign filter
            parent: "1"
          description: ""
        stepID: "58"
        results: []
        arguments:
          - expr: join(campaignIDs, " OR ")
            type: String
            target: campaignFilter
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 3400
              - 2280
              - 200
              - 80
            value: Get Campaigns
            parent: "1"
          description: ""
        stepID: "61"
        results:
          - expr: records
            target: campaigns
          - expr: total
            target: numOfCampaigns
        arguments:
          - type: Handle
            value: Campaigns
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: campaignFilter
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 3400
              - 2440
              - 200
              - 80
            value: Iterate over Campaigns
            parent: "1"
          description: ""
        stepID: "63"
        results:
          - expr: item
            target: campaign
        arguments:
          - expr: campaigns
            type: Array
            target: items
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 3040
              - 2440
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        stepID: "65"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 4240
              - 2120
              - 200
              - 80
            value: Set Campaign Values
            parent: "1"
          description: ""
        stepID: "73"
        results: []
        arguments:
          - expr: NumberOfOpportunities
            type: Integer
            target: campaign.values.NumberOfOpportunities
          - expr: AmountAllOpportunities
            type: Float
            target: campaign.values.AmountAllOpportunities
          - expr: NumberOfWonOpportunities
            type: Integer
            target: campaign.values.NumberOfWonOpportunities
          - expr: AmountWonOpportunities
            type: Float
            target: campaign.values.AmountWonOpportunities
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 4240
              - 2280
              - 200
              - 80
            value: Save Campaign
            parent: "1"
          description: ""
        stepID: "75"
        results: []
        arguments:
          - expr: campaign
            type: ComposeRecord
            target: record
      - ref: composeRecordsReport
        kind: function
        meta:
          name: ""
          visual:
            id: "104"
            xywh:
              - 3680
              - 2280
              - 200
              - 80
            value: Generate Report All
            parent: "1"
          description: ""
        stepID: "104"
        results:
          - expr: report
            target: report
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - type: String
            value: sum(Amount) AS amount
            target: metrics
          - expr: '"DATE_FORMAT(created_at, ''%Y-01-01'')"'
            type: String
            target: dimensons
          - expr: '"CampaignId = " + campaign.recordID'
            type: String
            target: filter
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "110"
            xywh:
              - 3680
              - 2120
              - 200
              - 80
            value: Set Number and Amount
            parent: "1"
          description: ""
        stepID: "110"
        results: []
        arguments:
          - expr: "0"
            type: Integer
            target: NumberOfOpportunities
          - expr: "0"
            type: Float
            target: AmountAllOpportunities
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "112"
            xywh:
              - 3680
              - 2440
              - 200
              - 80
            value: Iterate report items
            parent: "1"
          description: ""
        stepID: "112"
        results:
          - expr: item
            target: dimension
        arguments:
          - expr: 'report ? report : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "123"
            xywh:
              - 3680
              - 2600
              - 200
              - 80
            value: Update Number and Amount
            parent: "1"
          description: ""
        stepID: "123"
        results: []
        arguments:
          - expr: NumberOfOpportunities + dimension.count
            type: Integer
            target: NumberOfOpportunities
          - expr: 'AmountAllOpportunities + (dimension.amount ? dimension.amount : 0)'
            type: Float
            target: AmountAllOpportunities
      - ref: composeRecordsReport
        kind: function
        meta:
          name: ""
          visual:
            id: "126"
            xywh:
              - 3960
              - 2280
              - 200
              - 80
            value: Generate Report Won
            parent: "1"
          description: ""
        stepID: "126"
        results:
          - expr: report
            target: report
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - type: String
            value: sum(Amount) AS amount
            target: metrics
          - expr: '"DATE_FORMAT(created_at, ''%Y-01-01'')"'
            type: String
            target: dimensons
          - expr: '"(CampaignId = " + campaign.recordID + ") AND (StageName = ''Closed Won'')"'
            type: String
            target: filter
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "127"
            xywh:
              - 3960
              - 2120
              - 200
              - 80
            value: Set Number and Amount
            parent: "1"
          description: ""
        stepID: "127"
        results: []
        arguments:
          - expr: "0"
            type: Integer
            target: NumberOfWonOpportunities
          - expr: "0"
            type: Float
            target: AmountWonOpportunities
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "128"
            xywh:
              - 3960
              - 2440
              - 200
              - 80
            value: Iterate report items
            parent: "1"
          description: ""
        stepID: "128"
        results:
          - expr: item
            target: dimension
        arguments:
          - expr: 'report ? report : []'
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "131"
            xywh:
              - 3960
              - 2600
              - 200
              - 80
            value: Update Number and Amount
            parent: "1"
          description: ""
        stepID: "131"
        results: []
        arguments:
          - expr: NumberOfWonOpportunities + dimension.count
            type: Integer
            target: NumberOfWonOpportunities
          - expr: 'AmountWonOpportunities + (dimension.amount ? dimension.amount : 0)'
            type: Float
            target: AmountWonOpportunities
    paths:
      - expr: has(campaignIDs, campaignID)
        meta:
          name: ""
          visual:
            id: "28"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "26"
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "49"
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "58"
        parentID: "49"
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "61"
        parentID: "58"
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "63"
        parentID: "61"
      - meta:
          name: ""
          visual:
            id: "76"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "75"
        parentID: "73"
      - meta:
          name: ""
          visual:
            id: "91"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "105"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "110"
        parentID: "63"
      - meta:
          name: ""
          visual:
            id: "106"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "65"
        parentID: "63"
      - meta:
          name: ""
          visual:
            id: "111"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "104"
        parentID: "110"
      - meta:
          name: ""
          visual:
            id: "113"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "112"
        parentID: "104"
      - meta:
          name: ""
          visual:
            id: "124"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "123"
        parentID: "112"
      - meta:
          name: ""
          visual:
            id: "125"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "127"
        parentID: "112"
      - meta:
          name: ""
          visual:
            id: "129"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "126"
        parentID: "127"
      - meta:
          name: ""
          visual:
            id: "130"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "128"
        parentID: "126"
      - meta:
          name: ""
          visual:
            id: "132"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "131"
        parentID: "128"
      - meta:
          name: ""
          visual:
            id: "133"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "73"
        parentID: "128"
      - meta:
          name: ""
          visual:
            id: "134"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "135"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "49"
        parentID: "14"
    triggers:
      - resourceType: compose:record
        eventType: afterDelete
        constraints:
          - op: =
            name: module.handle
            values:
              - Opportunity
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 5
        meta:
          visual:
            id: "4"
            xywh:
              - 2160
              - 2240
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "10"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points:
                      - x: 2400
                        "y": 2280
                      - x: 2400
                        "y": 2200
                  description: ""
                childID: "5"
                parentID: "4"
            value: After Delete Opportunity
            parent: "1"
          description: ""
  CRM-Quote-SendReminderWithPDFToPriContact:
    enabled: true
    meta:
      name: CRM - Quote - Send reminder with PDF To Pri Contact
      visual: null
      description: ""
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 808
              - 1040
              - 200
              - 80
            value: Check recipient
            parent: "1"
            defaultName: false
          description: ""
        stepID: "6"
        results: []
        arguments: []
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 1448
              - 1040
              - 200
              - 80
            value: Get LineItems
            parent: "1"
            defaultName: false
          description: ""
        stepID: "7"
        results:
          - expr: records
            target: lineItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 808
              - 1200
              - 200
              - 80
            value: 'אזהרה: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי.'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "8"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 528
              - 1840
              - 200
              - 80
            value: Set Render Variables
            parent: "1"
            defaultName: false
          description: ""
        stepID: "9"
        results: []
        arguments:
          - type: Vars
            target: renderVariables
          - expr: record
            type: ComposeRecord
            target: renderVariables.quote
          - expr: lineItems
            type: Array
            target: renderVariables.lineItems
          - expr: |-
              {
                  "documentSize": "A4",
                  "contentScale": "1",
                  "orientation": "portrait",
                  "margin": "0.3"
                }
            type: Vars
            target: renderOptions
          - expr: join(["http://local.cortezaproject.org:18080/api/compose",coverImgUrl],'')
            type: String
            target: renderVariables.coverImgUrl
          - expr: strftime(now(),"%d/%m/%Y")
            type: String
            target: renderVariables.now
          - expr: priContact
            type: ComposeRecord
            target: renderVariables.priContact
          - expr: productImages
            type: Vars
            target: renderVariables.productImages
          - expr: productNames
            type: Vars
            target: renderVariables.productNames
          - expr: |
              join(["http://local.cortezaproject.org:18080/api/compose",aboutImgUrl],"")
            type: String
            target: renderVariables.aboutImgUrl
          - expr: ExpirationDate
            type: String
            target: renderVariables.expirationDate
          - expr: termItems
            type: Array
            target: renderVariables.termItems
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 528
              - 2000
              - 200
              - 80
            value: Mail Message Template
            parent: "1"
            defaultName: false
          description: ""
        stepID: "10"
        results:
          - expr: document
            type: RenderedDocument
            target: mailHtml
        arguments:
          - type: Handle
            value: quote_pdf_reminder_email
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 808
              - 1360
              - 200
              - 80
            value: Prepare settings
            parent: "1"
            defaultName: false
          description: ""
        stepID: "11"
        results: []
        arguments:
          - expr: settings.values.DefaultQuoteImage
            type: String
            target: DefaultQuoteImage
          - expr: settings.values.DefaultAboutImage
            type: String
            target: DefaultAboutImage
      - ref: oauth2Authenticate
        kind: function
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 1080
              - 1360
              - 200
              - 80
            value: get api token
            parent: "1"
            defaultName: false
          description: ""
        stepID: "12"
        results:
          - expr: accessToken
            type: String
            target: accessToken
        arguments:
          - expr: settings.values.Api_Auth_Client_User_Id
            type: String
            target: client
          - expr: settings.values.Api_Auth_Client_Secret
            type: String
            target: secret
          - type: String
            value: profile api
            target: scope
          - expr: join([settings.values.Domain,"/auth/oauth2/token"],'')
            type: String
            target: tokenUrl
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 528
              - 1680
              - 200
              - 80
            value: get cover image
            parent: "1"
            defaultName: false
          description: ""
        stepID: "13"
        results:
          - expr: status
            type: String
            target: attachemtResStatus
          - expr: body
            type: Reader
            target: attachmentReader
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", DefaultQuoteImage],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 808
              - 1680
              - 200
              - 80
            value: Prepare cover image results
            parent: "1"
            defaultName: false
          description: ""
        stepID: "14"
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 1088
              - 1680
              - 200
              - 80
            value: jsenv get cover image preview url
            parent: "1"
            defaultName: false
          description: ""
        stepID: "15"
        results:
          - expr: resultString
            target: coverImgUrl
        arguments:
          - expr: attachmentString
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 1088
              - 1840
              - 200
              - 80
            value: Quote to HTML Header
            parent: "1"
            defaultName: false
          description: ""
        stepID: "16"
        results:
          - expr: document
            type: RenderedDocument
            target: headerHtml
        arguments:
          - type: Handle
            value: quote_pdf_header
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2008
              - 1040
              - 200
              - 80
            value: Get pri contact record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "17"
        results:
          - expr: record
            type: ComposeRecord
            target: priContact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.values.ContactId
            type: ID
            target: record
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 1368
              - 1840
              - 200
              - 80
            value: Quote to HTML Footer
            parent: "1"
            defaultName: false
          description: ""
        stepID: "18"
        results:
          - expr: document
            target: footerHtml
        arguments:
          - type: Handle
            value: quote_pdf_footer
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 808
              - 1520
              - 200
              - 80
            value: get product data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "19"
        results:
          - expr: item
            type: Any
            target: lineItem
        arguments:
          - expr: lineItems
            type: Array
            target: items
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 1088
              - 1520
              - 200
              - 80
            value: set product data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "20"
        results: []
        arguments:
          - expr: lineItem.values.ProductId
            type: String
            target: ProductId
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 1648
              - 1520
              - 200
              - 80
            value: http get product image attachment
            parent: "1"
            defaultName: false
          description: ""
        stepID: "21"
        results:
          - expr: body
            type: Reader
            target: productImage
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "22"
            xywh:
              - 1928
              - 1520
              - 200
              - 80
            value: cast product image to string
            parent: "1"
            defaultName: false
          description: ""
        stepID: "22"
        results: []
        arguments:
          - expr: productImage
            type: String
            target: productImage
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 2208
              - 1520
              - 200
              - 80
            value: jsenv image preview
            parent: "1"
            defaultName: false
          description: ""
        stepID: "23"
        results:
          - expr: resultString
            type: String
            target: imagePreviewUrl
        arguments:
          - expr: productImage
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 528
              - 1520
              - 200
              - 80
            value: Prepare product Data Arrays
            parent: "1"
            defaultName: false
          description: ""
        stepID: "24"
        results: []
        arguments:
          - type: Vars
            target: productImages
          - type: Vars
            target: productNames
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "25"
            xywh:
              - 2488
              - 1520
              - 200
              - 80
            value: add product data
            parent: "1"
            defaultName: false
          description: ""
        stepID: "25"
        results: []
        arguments:
          - expr: |-
              {
                ProductId: join(["http://local.cortezaproject.org:18080/api/compose",imagePreviewUrl],'')}
            type: Vars
            target: imageItem
          - expr: merge(productImages,imageItem)
            type: Vars
            target: productImages
          - expr: '{ProductId: LineItemProduct.values.Name}'
            type: Vars
            target: nameItem
          - expr: merge(productNames,nameItem)
            type: Vars
            target: productNames
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2768
              - 1520
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "26"
        results: []
        arguments: []
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "27"
            xywh:
              - 1368
              - 1680
              - 200
              - 80
            value: get about image
            parent: "1"
            defaultName: false
          description: ""
        stepID: "27"
        results:
          - expr: body
            type: Reader
            target: attachmentReader
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", DefaultAboutImage],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 1648
              - 1680
              - 200
              - 80
            value: Prepare about image results
            parent: "1"
            defaultName: false
          description: ""
        stepID: "28"
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "29"
            xywh:
              - 1928
              - 1680
              - 200
              - 80
            value: jsenv get about image preview url
            parent: "1"
            defaultName: false
          description: ""
        stepID: "29"
        results:
          - expr: resultString
            type: String
            target: aboutImgUrl
        arguments:
          - expr: attachmentString
            type: Any
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return `https://crm.tilnet.co.il/api/compose${js.response.url}`;
            target: source
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "30"
            xywh:
              - 1088
              - 1040
              - 200
              - 80
            value: Check quote name
            parent: "1"
            defaultName: false
          description: ""
        stepID: "30"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "31"
            xywh:
              - 1088
              - 1200
              - 200
              - 80
            value: Prepare quote name
            parent: "1"
            defaultName: false
          description: ""
        stepID: "31"
        results: []
        arguments:
          - expr: '"הצעת מחיר לפיתוח"'
            type: String
            target: record.values.Name
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "32"
            xywh:
              - 2288
              - 1040
              - 200
              - 80
            value: jsenv set expiration date
            parent: "1"
            defaultName: false
          description: ""
        stepID: "32"
        results:
          - expr: resultString
            type: String
            target: ExpirationDate
        arguments:
          - expr: record.values.ExpirationDate
            type: String
            target: scope
          - type: String
            value: return arguments[0].replace(/([\d]{4})-([\d]{2})-([\d]{2}).*/,"$3/$2/$1")
            target: source
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "33"
            xywh:
              - 1728
              - 1040
              - 200
              - 80
            value: Get TermItems
            parent: "1"
            defaultName: false
          description: ""
        stepID: "33"
        results:
          - expr: records
            target: termItems
        arguments:
          - type: Handle
            value: QuoteTermItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "35"
            xywh:
              - 1368
              - 1520
              - 200
              - 80
            value: get LineItem Product record
            parent: "1"
            defaultName: false
          description: ""
        stepID: "35"
        results:
          - expr: record
            type: ComposeRecord
            target: LineItemProduct
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: ProductId
            type: ID
            target: record
      - ref: corredorExec
        kind: function
        meta:
          name: ""
          visual:
            id: "36"
            xywh:
              - 1088
              - 2000
              - 200
              - 80
            value: Send PDF using Auto Script
            parent: "1"
            defaultName: false
          description: ""
        stepID: "36"
        results:
          - expr: results
            type: Vars
            target: res
        arguments:
          - type: String
            value: /server-scripts/tilnet-scripts/crm/send-pdf.js:default
            target: script
          - expr: |-
              {
                "record":record,
                "templateHtml": templateHtml,
                "headerHtml": headerHtml,
                "footerHtml": footerHtml,
                "mailTo": record.values.Email,
                "mailSubject":  quoteName,
                "quoteFileName":  join([quoteName],".pdf"),
                "messageHtml": messageHtml
              }
            type: Vars
            target: args
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "37"
            xywh:
              - 1088
              - 2160
              - 200
              - 80
            value: 'הצלחה: תזכורת נשלחה במייל'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "37"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נשלחה במייל
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 800
              - 1840
              - 200
              - 80
            value: Quote to HTML
            parent: "1"
            defaultName: false
          description: ""
        stepID: "38"
        results:
          - expr: document
            type: RenderedDocument
            target: html
        arguments:
          - type: Handle
            value: quote_pdf
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "39"
            xywh:
              - 528
              - 1360
              - 200
              - 80
            value: get settings
            parent: "1"
            defaultName: false
          description: ""
        stepID: "39"
        results:
          - expr: record
            type: ComposeRecord
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "40"
            xywh:
              - 808
              - 2000
              - 200
              - 80
            value: Prepare Automation Script Vars
            parent: "1"
            defaultName: false
          description: ""
        stepID: "40"
        results: []
        arguments:
          - expr: html.document
            type: String
            target: templateHtml
          - expr: mailHtml.document
            type: String
            target: messageHtml
          - expr: headerHtml.document
            type: String
            target: headerHtml
          - expr: footerHtml.document
            type: String
            target: footerHtml
          - expr: join([record.values.Name,record.values.QuoteNumber]," - ")
            type: String
            target: quoteName
    paths:
      - expr: 'record.values.Email ? true : false'
        meta:
          name: ""
          visual:
            id: "41"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Yes'
            parent: "1"
            points: []
          description: ""
        childID: "30"
        parentID: "6"
      - meta:
          name: ""
          visual:
            id: "42"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - No'
            parent: "1"
            points: []
          description: ""
        childID: "8"
        parentID: "6"
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "38"
        parentID: "9"
      - meta:
          name: ""
          visual:
            id: "44"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "10"
        parentID: "18"
      - meta:
          name: ""
          visual:
            id: "45"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "40"
        parentID: "10"
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "11"
        parentID: "39"
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "49"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "9"
        parentID: "29"
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "15"
        parentID: "14"
      - meta:
          name: ""
          visual:
            id: "51"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "36"
        parentID: "40"
      - meta:
          name: ""
          visual:
            id: "52"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "38"
      - meta:
          name: ""
          visual:
            id: "53"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "37"
        parentID: "36"
      - meta:
          name: ""
          visual:
            id: "54"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "18"
        parentID: "16"
      - meta:
          name: ""
          visual:
            id: "55"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childID: "20"
        parentID: "19"
      - meta:
          name: ""
          visual:
            id: "56"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "35"
        parentID: "20"
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "35"
      - meta:
          name: ""
          visual:
            id: "58"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "22"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "25"
        parentID: "23"
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "33"
        parentID: "7"
      - meta:
          name: ""
          visual:
            id: "61"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "39"
        parentID: "32"
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "24"
        parentID: "12"
      - meta:
          name: ""
          visual:
            id: "63"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "19"
        parentID: "24"
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "23"
        parentID: "22"
      - meta:
          name: ""
          visual:
            id: "65"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "26"
        parentID: "25"
      - meta:
          name: ""
          visual:
            id: "66"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "13"
        parentID: "19"
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "28"
        parentID: "27"
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "29"
        parentID: "28"
      - meta:
          name: ""
          visual:
            id: "69"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "27"
        parentID: "15"
      - expr: 'record.values.Name=="(unnamed)" ? true : false'
        meta:
          name: ""
          visual:
            id: "70"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childID: "31"
        parentID: "30"
      - meta:
          name: ""
          visual:
            id: "71"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "30"
      - meta:
          name: ""
          visual:
            id: "72"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "32"
        parentID: "17"
      - meta:
          name: ""
          visual:
            id: "73"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "17"
        parentID: "33"
      - meta:
          name: ""
          visual:
            id: "74"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "31"
      - meta:
          name: ""
          visual:
            id: "80"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "12"
        parentID: "11"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 6
        meta:
          visual:
            id: "34"
            xywh:
              - 528
              - 1040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "75"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: 6
                parentID: 34
            value: On Manual Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-UpdateCoverLetter:
    enabled: true
    meta:
      name: CRM - Quote - Update CoverLetter
      visual: null
      description: Update cover text after a change in CoverTemplate
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2200
              - 1840
              - 200
              - 80
            value: Exclusive
            parent: "1"
            defaultName: true
          description: ""
        stepID: "16"
        results: []
        arguments: []
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 2200
              - 2000
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        stepID: "18"
        results: []
        arguments: []
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 2680
              - 1840
              - 200
              - 80
            value: Compose record lookup
            parent: "1"
            defaultName: true
          description: ""
        stepID: "23"
        results:
          - expr: record
            type: ComposeRecord
            target: coverLetterRec
        arguments:
          - type: Handle
            value: CoverTemplate
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: coverTemplateId
            type: ID
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 2680
              - 2000
              - 200
              - 80
            value: Define and mutate scope variables
            parent: "1"
            defaultName: true
          description: ""
        stepID: "24"
        results: []
        arguments:
          - expr: coverLetterRec.values.Content
            type: String
            target: coverLetter
          - expr: coverLetterRec.values.Content
            type: String
            target: record.values.CoverText
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "27"
            xywh:
              - 2680
              - 1680
              - 200
              - 80
            value: Define and mutate scope variables
            parent: "1"
            defaultName: true
          description: ""
        stepID: "27"
        results: []
        arguments:
          - expr: record.values.CoverTemplate
            type: ID
            target: coverTemplateId
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "29"
            xywh:
              - 2680
              - 2160
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        stepID: "29"
        results: []
        arguments: []
    paths:
      - expr: (!oldRecord.values.CoverTemplate && record.values.CoverTemplate) || oldRecord.values.CoverTemplate != record.values.CoverTemplate
        meta:
          name: ""
          visual:
            id: "20"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Cover template chaged
            parent: "1"
            points: []
          description: ""
        childID: "27"
        parentID: "16"
      - meta:
          name: ""
          visual:
            id: "21"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Cover Template didn't change
            parent: "1"
            points: []
          description: ""
        childID: "18"
        parentID: "16"
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "24"
        parentID: "23"
      - meta:
          name: ""
          visual:
            id: "28"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "23"
        parentID: "27"
      - meta:
          name: ""
          visual:
            id: "30"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "29"
        parentID: "24"
    triggers:
      - resourceType: compose:record
        eventType: beforeUpdate
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 16
        meta:
          visual:
            id: "6"
            xywh:
              - 1880
              - 2000
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "33"
                    style: exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "16"
                parentID: "6"
            value: Quote Before Update Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-Add-Note:
    enabled: true
    meta:
      name: CRM - Quote - Add Note
      visual: null
      description: Add not after sending quote or reminder
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2440
              - 2000
              - 200
              - 80
            value: Check Status
            parent: "1"
            defaultName: false
          description: ""
        stepID: "16"
        results: []
        arguments: []
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2800
              - 2000
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        stepID: "17"
        results: []
        arguments: []
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 2120
              - 2160
              - 200
              - 80
            value: Prepate note to quote
            parent: "1"
            defaultName: false
          description: ""
        stepID: "18"
        results:
          - expr: record
            type: ComposeRecord
            target: note
        arguments:
          - type: Handle
            value: Note
            target: module
          - type: Handle
            value: crm
            target: namespace
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2800
              - 2320
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        stepID: "19"
        results: []
        arguments: []
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2800
              - 2160
              - 200
              - 80
            value: Save note
            parent: "1"
            defaultName: false
          description: ""
        stepID: "20"
        results:
          - expr: record
            type: ComposeRecord
            target: note
        arguments:
          - expr: note
            type: ComposeRecord
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2160
              - 200
              - 80
            value: Set note parameters
            parent: "1"
            defaultName: false
          description: ""
        stepID: "21"
        results: []
        arguments:
          - expr: 'record.values.Status == "Presented" ? "<p>נשלחה הצעת מחיר</p>": "<p>נשלחה תזכורת</p>"'
            type: String
            target: note.values.Body
          - expr: 'record.values.Status == "Presented" ? "נשלחה הצעת מחיר": "נשלחה תזכורת"'
            type: String
            target: note.values.Title
          - expr: record.recordID
            type: ID
            target: note.values.QuoteId
    paths:
      - expr: oldRecord.values.Status != record.values.Status && (record.values.Status == "Presented" || record.values.Status == "Reminder")
        meta:
          name: ""
          visual:
            id: "23"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: status changed
            parent: "1"
            points: []
          description: ""
        childID: "18"
        parentID: "16"
      - meta:
          name: ""
          visual:
            id: "24"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childID: "17"
        parentID: "16"
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "18"
      - meta:
          name: ""
          visual:
            id: "26"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "20"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "19"
        parentID: "20"
    triggers:
      - resourceType: compose:record
        eventType: beforeUpdate
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 16
        meta:
          visual:
            id: "9"
            xywh:
              - 2120
              - 2000
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "28"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: null
                  description: ""
                childID: "16"
                parentID: "9"
            value: Quote Before Update Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-ApplyPriceBook:
    enabled: true
    meta:
      name: CRM - Quote - Apply Price Book
      visual: null
      description: עדכון מחירים מספר מחירים ונתוני הנחה
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2336
              - 2056
              - 200
              - 80
            value: Set pricebookId
            parent: "1"
            defaultName: false
          description: ""
        stepID: "3"
        results: []
        arguments:
          - expr: 'record.values.PricebookId ? record.values.PricebookId : 0'
            type: ID
            target: pricebookId
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 3056
              - 2056
              - 200
              - 80
            value: Fetch Pricebooks
            parent: "1"
            defaultName: false
          description: ""
        stepID: "4"
        results:
          - expr: records
            type: ComposeRecord
            target: pricebooks
          - expr: total
            type: UnsignedInteger
            target: numOfPricebooks
        arguments:
          - type: Handle
            value: Pricebook
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"IsActive AND IsStandard"'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 3336
              - 2056
              - 200
              - 80
            value: Check Pricebooks
            parent: "1"
            defaultName: false
          description: ""
        stepID: "5"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 3056
              - 2216
              - 200
              - 80
            value: Set pricebookIds
            parent: "1"
            defaultName: false
          description: ""
        stepID: "6"
        results: []
        arguments:
          - expr: 'pricebooks[0] ? pricebooks[0] : undefined'
            type: ComposeRecord
            target: pricebook
          - expr: 'pricebook ? pricebook.recordID : undefined'
            type: ID
            target: pricebookId
          - expr: pricebookId
            type: ID
            target: record.values.PricebookId
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 3776
              - 2056
              - 200
              - 80
            value: 'Warning: No Pricebooks'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "7"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - expr: '"לא הוגדרו ספרי מחיר להזדמנות זו. נא לבחור ספר מחירים"'
            type: String
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2616
              - 2416
              - 200
              - 80
            value: Check pricebookId
            parent: "1"
            defaultName: false
          description: ""
        stepID: "8"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 3336
              - 2416
              - 200
              - 80
            value: 'Warning: No Pricebook'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "9"
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please select a Price book for this opportunity first.
            target: message
          - type: String
            value: אזהרה
            target: variant
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 3336
              - 2216
              - 200
              - 80
            value: Save Quote
            parent: "1"
            defaultName: false
          description: ""
        stepID: "10"
        results:
          - expr: record
            type: ComposeRecord
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2320
              - 3088
              - 200
              - 80
            value: Fetch Included Items
            parent: "1"
            defaultName: false
          description: ""
        stepID: "11"
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
          - expr: index
            type: UnsignedInteger
            target: index
          - expr: total
            type: UnsignedInteger
            target: numOfLineItems
        arguments:
          - type: Handle
            value: QuoteIncludedItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 2880
              - 3088
              - 200
              - 80
            value: Fetch Product
            parent: "1"
            defaultName: false
          description: ""
        stepID: "12"
        results:
          - expr: record
            type: ComposeRecord
            target: product
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: lineItem.values.ProductId
            type: ID
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 2040
              - 3088
              - 200
              - 80
            value: Set Quote Total
            parent: "1"
            defaultName: false
          description: ""
        stepID: "13"
        results: []
        arguments:
          - expr: "0"
            type: Float
            target: quoteTotal
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2320
              - 3408
              - 200
              - 80
            value: Reload page
            parent: "1"
            defaultName: false
          description: ""
        stepID: "14"
        results: []
        arguments:
          - type: Handle
            value: Quote
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 3600
              - 3088
              - 200
              - 80
            value: Fetch Pricebook entry
            parent: "1"
            defaultName: false
          description: ""
        stepID: "15"
        results:
          - expr: records
            target: pricebookEntries
          - expr: total
            target: numOfPricebookEntries
        arguments:
          - type: Handle
            value: PricebookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"PricebookId = " + pricebookId + " AND ProductId = " + lineItem.values.ProductId'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2600
              - 3248
              - 200
              - 80
            value: Set pricebookEntry
            parent: "1"
            defaultName: false
          description: ""
        stepID: "16"
        results: []
        arguments:
          - expr: 'numOfPricebookEntries > 0 ? pricebookEntries[0] : undefined'
            type: ComposeRecord
            target: pricebookEntry
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 3560
              - 3248
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "17"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 2880
              - 3248
              - 200
              - 80
            value: Set line item values
            parent: "1"
            defaultName: false
          description: ""
        stepID: "18"
        results: []
        arguments:
          - expr: 'lineItem.values.Quantity ? lineItem.values.Quantity : 1'
            type: Float
            target: quantity
          - expr: 'lineItem.values.Discount ? lineItem.values.Discount : 0'
            type: Float
            target: discount
          - expr: 'pricebookEntry.values.UnitPrice ? pricebookEntry.values.UnitPrice : 0'
            type: Float
            target: listprice
          - expr: '(lineItem.values.UnitPrice ? false : true) ? listprice : (lineItem.values.UnitPrice ? lineItem.values.UnitPrice : 0)'
            type: Any
            target: unitprice
          - expr: unitprice * quantity
            type: Float
            target: subtotal
          - expr: subtotal - discount
            type: Float
            target: totalprice
          - expr: product.values.ProductCode
            type: String
            target: lineItem.values.ProductCode
          - expr: listprice
            type: Float
            target: lineItem.values.ListPrice
          - expr: unitprice
            type: Float
            target: lineItem.values.UnitPrice
          - expr: subtotal
            type: Float
            target: lineItem.values.Subtotal
          - expr: totalprice
            type: Float
            target: lineItem.values.TotalPrice
          - expr: quoteTotal + totalprice
            type: Float
            target: quoteTotal
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 3160
              - 3248
              - 200
              - 80
            value: Save lineItem
            parent: "1"
            defaultName: false
          description: ""
        stepID: "19"
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
        arguments:
          - expr: lineItem
            type: ComposeRecord
            target: record
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2616
              - 2056
              - 200
              - 80
            value: Check pricebookId
            parent: "1"
            defaultName: false
          description: ""
        stepID: "20"
        results: []
        arguments: []
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 3840
              - 3088
              - 200
              - 80
            value: Check numOfPricebookEntries > 0
            parent: "1"
            defaultName: false
          description: ""
        stepID: "21"
        results: []
        arguments: []
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "22"
            xywh:
              - 2040
              - 3408
              - 200
              - 80
            value: 'הצלחה: ספר המחירים ייושם'
            parent: "1"
            defaultName: false
          description: ""
        stepID: "22"
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: ספר המחירים ייושם
            target: message
          - type: String
            value: הצלחה
            target: variant
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 2320
              - 3248
              - 200
              - 80
            value: Save Quote
            parent: "1"
            defaultName: false
          description: ""
        stepID: "23"
        results:
          - expr: record
            type: ComposeRecord
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 3232
              - 3088
              - 200
              - 80
            value: SSet line item product details
            parent: "1"
            defaultName: false
          description: ""
        stepID: "24"
        results: []
        arguments:
          - expr: product.values.Description
            type: String
            target: lineItem.values.Description
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "25"
            xywh:
              - 2040
              - 3248
              - 200
              - 80
            value: Set Amount
            parent: "1"
            defaultName: false
          description: ""
        stepID: "25"
        results: []
        arguments:
          - expr: quoteTotal
            type: Float
            target: record.values.TotalPrice
          - expr: quoteTotal
            type: Float
            target: record.values.Subtotal
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "54"
            xywh:
              - 3600
              - 2760
              - 200
              - 80
            value: Fetch Pricebook entry
            parent: "1"
            defaultName: false
          description: ""
        stepID: "54"
        results:
          - expr: records
            target: pricebookEntries
          - expr: total
            target: numOfPricebookEntries
        arguments:
          - type: Handle
            value: PricebookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"PricebookId = " + pricebookId + " AND ProductId = " + lineItem.values.ProductId'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "55"
            xywh:
              - 3560
              - 2920
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        stepID: "55"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "56"
            xywh:
              - 2880
              - 2920
              - 200
              - 80
            value: Set line item values
            parent: "1"
            defaultName: false
          description: ""
        stepID: "56"
        results: []
        arguments:
          - expr: 'lineItem.values.Quantity ? lineItem.values.Quantity : 1'
            type: Float
            target: quantity
          - expr: 'lineItem.values.Discount ? lineItem.values.Discount : 0'
            type: Float
            target: discount
          - expr: 'pricebookEntry.values.UnitPrice ? pricebookEntry.values.UnitPrice : 0'
            type: Float
            target: listprice
          - expr: '(lineItem.values.UnitPrice ? false : true) ? listprice : (lineItem.values.UnitPrice ? lineItem.values.UnitPrice : 0)'
            type: Any
            target: unitprice
          - expr: unitprice * quantity
            type: Float
            target: subtotal
          - expr: subtotal - discount
            type: Float
            target: totalprice
          - expr: product.values.ProductCode
            type: String
            target: lineItem.values.ProductCode
          - expr: listprice
            type: Float
            target: lineItem.values.ListPrice
          - expr: unitprice
            type: Float
            target: lineItem.values.UnitPrice
          - expr: subtotal
            type: Float
            target: lineItem.values.Subtotal
          - expr: totalprice
            type: Float
            target: lineItem.values.TotalPrice
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "57"
            xywh:
              - 3840
              - 2760
              - 200
              - 80
            value: Check numOfPricebookEntries > 0
            parent: "1"
            defaultName: false
          description: ""
        stepID: "57"
        results: []
        arguments: []
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3232
              - 2760
              - 200
              - 80
            value: Set included item product details
            parent: "1"
            defaultName: false
          description: ""
        stepID: "58"
        results: []
        arguments:
          - expr: product.values.Description
            type: String
            target: lineItem.values.Description
          - expr: product.values.Name
            type: String
            target: lineItem.values.Name
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "59"
            xywh:
              - 2880
              - 2760
              - 200
              - 80
            value: Fetch Product
            parent: "1"
            defaultName: false
          description: ""
        stepID: "59"
        results:
          - expr: record
            type: ComposeRecord
            target: product
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: lineItem.values.ProductId
            type: ID
            target: record
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "60"
            xywh:
              - 3160
              - 2920
              - 200
              - 80
            value: Save lineItem
            parent: "1"
            defaultName: false
          description: ""
        stepID: "60"
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
        arguments:
          - expr: lineItem
            type: ComposeRecord
            target: record
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 2600
              - 2920
              - 200
              - 80
            value: Set pricebookEntry
            parent: "1"
            defaultName: false
          description: ""
        stepID: "61"
        results: []
        arguments:
          - expr: 'numOfPricebookEntries > 0 ? pricebookEntries[0] : undefined'
            type: ComposeRecord
            target: pricebookEntry
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "62"
            xywh:
              - 2320
              - 2760
              - 200
              - 80
            value: Fetch Line tems
            parent: "1"
            defaultName: false
          description: ""
        stepID: "62"
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
          - expr: index
            type: UnsignedInteger
            target: index
          - expr: total
            type: UnsignedInteger
            target: numOfLineItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
    paths:
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "5"
        parentID: "4"
      - expr: numOfPricebooks > 0
        meta:
          name: ""
          visual:
            id: "30"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Pricebook'
            parent: "1"
            points: []
          description: ""
        childID: "6"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "31"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No Pricebooks'
            parent: "1"
            points: []
          description: ""
        childID: "7"
        parentID: "5"
      - meta:
          name: ""
          visual:
            id: "32"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "10"
        parentID: "6"
      - expr: pricebookId != 0
        meta:
          name: ""
          visual:
            id: "33"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Pricebook'
            parent: "1"
            points: []
          description: ""
        childID: "62"
        parentID: "8"
      - meta:
          name: ""
          visual:
            id: "34"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No pricebook'
            parent: "1"
            points: []
          description: ""
        childID: "9"
        parentID: "8"
      - meta:
          name: ""
          visual:
            id: "35"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Iterate over included items
            parent: "1"
            points: []
          description: ""
        childID: "12"
        parentID: "11"
      - meta:
          name: ""
          visual:
            id: "36"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "11"
        parentID: "13"
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childID: "25"
        parentID: "11"
      - meta:
          name: ""
          visual:
            id: "38"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "22"
        parentID: "23"
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "14"
        parentID: "22"
      - meta:
          name: ""
          visual:
            id: "40"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "19"
        parentID: "18"
      - expr: pricebookId != 0
        meta:
          name: ""
          visual:
            id: "41"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;
            value: '#1 - Has pricebookId'
            parent: "1"
            points: []
          description: ""
        childID: "62"
        parentID: "20"
      - meta:
          name: ""
          visual:
            id: "42"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "8"
        parentID: "10"
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No pricebookId'
            parent: "1"
            points: []
          description: ""
        childID: "4"
        parentID: "20"
      - expr: numOfPricebookEntries > 0
        meta:
          name: ""
          visual:
            id: "44"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has pricebook entries'
            parent: "1"
            points: []
          description: ""
        childID: "16"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "45"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No entry'
            parent: "1"
            points: []
          description: ""
        childID: "17"
        parentID: "21"
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "18"
        parentID: "16"
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "21"
        parentID: "15"
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "20"
        parentID: "3"
      - meta:
          name: ""
          visual:
            id: "49"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "24"
        parentID: "12"
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "15"
        parentID: "24"
      - meta:
          name: ""
          visual:
            id: "51"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "23"
        parentID: "25"
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Iterate over Lineitems
            parent: "1"
            points: []
          description: ""
        childID: "59"
        parentID: "62"
      - meta:
          name: ""
          visual:
            id: "65"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "60"
        parentID: "56"
      - expr: numOfPricebookEntries > 0
        meta:
          name: ""
          visual:
            id: "66"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has pricebook entries'
            parent: "1"
            points: []
          description: ""
        childID: "61"
        parentID: "57"
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No entry'
            parent: "1"
            points: []
          description: ""
        childID: "55"
        parentID: "57"
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "56"
        parentID: "61"
      - meta:
          name: ""
          visual:
            id: "69"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "57"
        parentID: "54"
      - meta:
          name: ""
          visual:
            id: "70"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "58"
        parentID: "59"
      - meta:
          name: ""
          visual:
            id: "71"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childID: "54"
        parentID: "58"
      - meta:
          name: ""
          visual:
            id: "72"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: null
          description: ""
        childID: "13"
        parentID: "62"
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "27"
            xywh:
              - 2056
              - 2056
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "53"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "27"
            value: On Manual Quote
            parent: "1"
            defaultName: false
          description: ""
