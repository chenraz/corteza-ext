workflows:
  CRM-Contact-SetLabel:
    enabled: true
    meta:
      name: CRM - Contact - Set Label
      visual: null
      description: Set label for contact record
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 2360
              - 2280
              - 200
              - 80
            value: Check if First/Last name exists
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 23
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "41"
            xywh:
              - 2840
              - 2120
              - 200
              - 80
            value: Assign record.values.RecordLabel
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: record.values.FirstName + ' ' + record.values.LastName
            type: String
            target: record.values.RecordLabel
        id: 41
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "43"
            xywh:
              - 2840
              - 2280
              - 200
              - 80
            value: Assign record.values.RecordLabel
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: record.values.FirstName
            type: String
            target: record.values.RecordLabel
        id: 43
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "45"
            xywh:
              - 2840
              - 2440
              - 200
              - 80
            value: Assign record.values.RecordLabel
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: record.values.LastName
            type: String
            target: record.values.RecordLabel
        id: 45
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "74"
            xywh:
              - 3160
              - 2280
              - 200
              - 80
            value: Check if related Account exists
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 74
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "76"
            xywh:
              - 3560
              - 2280
              - 200
              - 80
            value: null
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 76
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "78"
            xywh:
              - 3160
              - 2440
              - 200
              - 80
            value: Get related Account
            parent: "1"
          description: ""
        results:
          - expr: record
            target: accountRecord
        arguments:
          - type: Handle
            value: Account
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.values.AccountId
            type: ID
            target: record
        id: 78
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "85"
            xywh:
              - 3160
              - 2600
              - 200
              - 80
            value: If related Account has AccountName
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 85
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "86"
            xywh:
              - 3160
              - 2760
              - 200
              - 80
            value: Add AccountName to RecordLabel
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: record.values.RecordLabel + " (" + accountRecord.values.AccountName +")"
            type: String
            target: record.values.RecordLabel
        id: 86
    paths:
      - expr: '(record.values.FirstName ? true : false) && (record.values.LastName ? true : false)'
        meta:
          name: ""
          visual:
            id: "42"
            style: exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - FirstName & LastName'
            parent: "1"
            points: []
          description: ""
        childid: 41
        parentid: 23
      - expr: 'record.values.FirstName ? true : false'
        meta:
          name: ""
          visual:
            id: "44"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Only FirstName '
            parent: "1"
            points:
              - x: 2712
                "y": 2320
              - x: 2712
                "y": 2320
          description: ""
        childid: 43
        parentid: 23
      - expr: 'record.values.LastName ? true : false'
        meta:
          name: ""
          visual:
            id: "46"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#3 - Only LastName'
            parent: "1"
            points: []
          description: ""
        childid: 45
        parentid: 23
      - expr: '(record.values.AccountId  ? true : false)'
        meta:
          name: ""
          visual:
            id: "79"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 78
        parentid: 74
      - meta:
          name: ""
          visual:
            id: "80"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 76
        parentid: 74
      - expr: '(accountRecord.values.AccountName ? true : false)'
        meta:
          name: ""
          visual:
            id: "87"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 86
        parentid: 85
      - meta:
          name: ""
          visual:
            id: "89"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points:
              - x: 3660
                "y": 2640
          description: ""
        childid: 76
        parentid: 85
      - meta:
          name: ""
          visual:
            id: "90"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 74
        parentid: 41
      - meta:
          name: ""
          visual:
            id: "91"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 74
        parentid: 43
      - meta:
          name: ""
          visual:
            id: "92"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 74
        parentid: 45
      - meta:
          name: ""
          visual:
            id: "93"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 85
        parentid: 78
    triggers:
      - resourceType: compose:record
        eventType: beforeCreate
        constraints:
          - op: =
            name: module
            values:
              - Contact
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 23
        meta:
          visual:
            id: "2"
            xywh:
              - 2080
              - 2280
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "39"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "23"
                parentID: "2"
            value: Create Contact
            parent: "1"
          description: ""
  CRM-Case-InformContact:
    enabled: true
    meta:
      name: CRM - Case - Inform Contact
      visual: null
      description: Inform the contact via email of the Case solution
    steps:
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 3360
              - 2760
              - 200
              - 80
            value: Send Email
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"Corteza - Case: " + record.values.CaseNumber + " - " + record.values.Subject'
            type: String
            target: subject
          - expr: record.values.SuppliedEmail
            type: String
            target: to
          - expr: emailRow1 + emailRow2 + emailRow3
            type: String
            target: html
        id: 13
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 3120
              - 2760
              - 200
              - 80
            value: Prepare Email body
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"<h1>Solution of case: " + record.values.CaseNumber + " - " + record.values.Subject + "<br>"'
            type: String
            target: emailRow1
          - expr: '"<strong>Solution Title:</strong> " + (record.values.SolutionName ? record.values.SolutionName : "/") + "<br>"'
            type: String
            target: emailRow2
          - expr: '"<strong>Solution Details:</strong> " + (record.values.SolutionNote? record.values.SolutionNote: "/") + "<br>"'
            type: Any
            target: emailRow3
        id: 17
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2720
              - 2600
              - 200
              - 80
            value: 'Warning: Not Closed'
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: You can only inform the client of a solution when the case status is "Closed".
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 20
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2720
              - 2760
              - 200
              - 80
            value: Check if Closed and has Email
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 21
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 2720
              - 2920
              - 200
              - 80
            value: 'Warning: No Email'
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: There is no supplied email. Please fill in an email address in the "Contact Email" field
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 24
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "27"
            xywh:
              - 3600
              - 2760
              - 200
              - 80
            value: הצלחה
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: The case solution has been sent via email
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 27
    paths:
      - meta:
          name: ""
          visual:
            id: "19"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 13
        parentid: 17
      - expr: record.values.Status != "Closed"
        meta:
          name: ""
          visual:
            id: "23"
            style: exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: '#1 - If Status not "Closed"'
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 21
      - expr: 'record.values.SuppliedEmail ? false : true'
        meta:
          name: ""
          visual:
            id: "25"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - If no SuppliedEmail'
            parent: "1"
            points: []
          description: ""
        childid: 24
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "26"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#3 - Else'
            parent: "1"
            points: []
          description: ""
        childid: 17
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "28"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 27
        parentid: 13
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.name
            values:
              - Case
          - op: =
            name: namespace.name
            values:
              - crm
        enabled: true
        stepID: 21
        meta:
          visual:
            id: "2"
            xywh:
              - 2480
              - 2760
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "22"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "21"
                parentID: "2"
            value: Manual
            parent: "1"
          description: ""
  CRM-Solution-InsertNumber:
    enabled: true
    meta:
      name: CRM - Solution - Insert Number
      visual: null
      description: Sets the solution number based on the settings
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2080
              - 200
              - 80
            value: Get Settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 3
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2960
              - 2080
              - 200
              - 80
            value: Set SolutionNumber
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: 'settings.values.SolutionNextNumber ? settings.values.SolutionNextNumber : 0'
            type: Integer
            target: nextSolutionNumber
          - expr: nextSolutionNumber
            type: Integer
            target: record.values.SolutionNumber
          - expr: nextSolutionNumber + 1
            type: Integer
            target: settings.values.SolutionNextNumber
        id: 5
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2960
              - 2240
              - 200
              - 80
            value: Save Settings
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
        id: 7
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2560
              - 2080
              - 200
              - 80
            value: Check if has number
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 11
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2560
              - 2240
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 14
    paths:
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 5
      - expr: 'record.values.SolutionNumber ? false : true'
        meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - No Number'
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "15"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Has number'
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 11
    triggers:
      - resourceType: compose:record
        eventType: beforeCreate
        constraints:
          - op: =
            name: module.handle
            values:
              - Solution
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2080
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Solution Before Create Solution
            parent: "1"
          description: ""
  CRM-Account-CreateNewOpportunity:
    enabled: true
    meta:
      name: CRM - Account - Create New Opportunity
      visual: null
      description: Creates new Opportunity record from an existing Account
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2400
              - 2080
              - 200
              - 80
            value: Get Settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 3
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "55"
            xywh:
              - 2400
              - 2200
              - 200
              - 80
            value: Get Contacts
            parent: "1"
          description: ""
        results:
          - expr: records
            target: contacts
          - expr: total
            target: numOfContacts
        arguments:
          - type: Handle
            value: Contact
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"AccountId = " + record.recordID + " AND IsPrimary"'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 55
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 2400
              - 2320
              - 200
              - 80
            value: Check for contact
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 61
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 2400
              - 2480
              - 200
              - 80
            value: Set contact
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: contacts[0]
            type: ComposeRecord
            target: contact
        id: 66
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "81"
            xywh:
              - 2680
              - 2080
              - 200
              - 80
            value: Make Opportunity
            parent: "1"
          description: ""
        results:
          - expr: record
            target: opportunity
        arguments:
          - type: Handle
            value: Opportunity
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 81
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "83"
            xywh:
              - 2680
              - 2200
              - 200
              - 80
            value: Set Opportunity values
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"(unnamed)"'
            type: String
            target: opportunity.values.Name
          - expr: record.recordID
            type: ID
            target: opportunity.values.AccountId
          - expr: "false"
            type: Boolean
            target: opportunity.values.IsClosed
          - expr: "false"
            type: Boolean
            target: opportunity.values.IsWon
          - expr: modMonth(now(), 1)
            type: DateTime
            target: opportunity.values.CloseDate
          - expr: settings.values.OpportunityProbability
            type: Integer
            target: opportunity.values.Probability
          - expr: settings.values.OpportunityForecaseCategory
            type: String
            target: opportunity.values.ForecastCategory
          - expr: settings.values.OpportunityStagename
            type: String
            target: opportunity.values.StageName
          - expr: opportunity.values.OwnerId
            type: ID
            target: opportunity.values.OwnerId
          - expr: 'record.values.CampaignId ? record.values.CampaignId : []'
            type: Array
            target: opportunity.values.CampaignId
          - expr: record.values.AccountSource
            type: String
            target: opportunity.values.LeadSource
        id: 83
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "86"
            xywh:
              - 2680
              - 2320
              - 200
              - 80
            value: Save Opportunity
            parent: "1"
          description: ""
        results:
          - expr: record
            target: opportunity
        arguments:
          - expr: opportunity
            type: ComposeRecord
            target: record
        id: 86
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "88"
            xywh:
              - 2960
              - 2080
              - 200
              - 80
            value: Make OpportunityContactRole
            parent: "1"
          description: ""
        results:
          - expr: record
            target: opportunityContactRole
        arguments:
          - type: Handle
            value: OpportunityContactRole
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 88
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "89"
            xywh:
              - 2960
              - 2192
              - 200
              - 80
            value: Set OpportunityContactRolevalues
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: contact.recordID
            type: ID
            target: opportunityContactRole.values.ContactId
          - expr: opportunity.recordID
            type: ID
            target: opportunityContactRole.values.OpportunityId
          - expr: "true"
            type: Boolean
            target: opportunityContactRole.values.IsPrimary
        id: 89
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "91"
            xywh:
              - 2960
              - 2320
              - 200
              - 80
            value: Save OpportunityContactRole
            parent: "1"
          description: ""
        results:
          - expr: record
            target: opportunity
        arguments:
          - expr: opportunity
            type: ComposeRecord
            target: record
        id: 91
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "103"
            xywh:
              - 3240
              - 2080
              - 200
              - 80
            value: Show success
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"Success"'
            type: String
            target: title
          - expr: '"The new opportunity has been created."'
            type: String
            target: message
          - type: String
            value: הצלחה
            target: variant
          - expr: "true"
            type: Boolean
            target: sticky
        id: 103
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "105"
            xywh:
              - 3240
              - 2200
              - 200
              - 80
            value: Go to editor
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Opportunity
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: opportunity
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
        id: 105
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "107"
            xywh:
              - 2120
              - 2480
              - 200
              - 80
            value: Show warning
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"Warning"'
            type: String
            target: title
          - expr: '"The primary contact is not defined"'
            type: String
            target: message
          - type: String
            value: אזהרה
            target: variant
          - expr: "true"
            type: Boolean
            target: sticky
        id: 107
    paths:
      - expr: numOfContacts > 0
        meta:
          name: ""
          visual:
            id: "67"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has contact'
            parent: "1"
            points: []
          description: ""
        childid: 66
        parentid: 61
      - meta:
          name: ""
          visual:
            id: "85"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 81
        parentid: 66
      - meta:
          name: ""
          visual:
            id: "90"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 89
        parentid: 88
      - meta:
          name: ""
          visual:
            id: "92"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 91
        parentid: 89
      - meta:
          name: ""
          visual:
            id: "93"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 88
        parentid: 86
      - meta:
          name: ""
          visual:
            id: "104"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 103
        parentid: 91
      - meta:
          name: ""
          visual:
            id: "108"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - No Contact'
            parent: "1"
            points: []
          description: ""
        childid: 107
        parentid: 61
      - meta:
          name: ""
          visual:
            id: "109"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 105
        parentid: 103
      - meta:
          name: ""
          visual:
            id: "112"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 86
        parentid: 83
      - meta:
          name: ""
          visual:
            id: "116"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 83
        parentid: 81
      - meta:
          name: ""
          visual:
            id: "117"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 55
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "120"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 61
        parentid: 55
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Account
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2120
              - 2080
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "34"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Account
            parent: "1"
          description: ""
  CRM-Case-SetStatusToClosed:
    enabled: true
    meta:
      name: CRM - Case - Set Status To Closed
      visual: null
      description: Sets status of Case record to "Closed"
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 360
              - 40
              - 200
              - 80
            value: Check if Case Closed
            parent: "19"
          description: ""
        results: []
        arguments: []
        id: 3
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 760
              - 40
              - 200
              - 80
            value: Check for Solution
            parent: "19"
          description: ""
        results: []
        arguments: []
        id: 7
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 1160
              - 40
              - 200
              - 80
            value: Update status
            parent: "19"
          description: ""
        results: []
        arguments:
          - expr: now()
            type: DateTime
            target: record.values.ClosedDate
          - expr: '"Closed"'
            type: String
            target: record.values.Status
          - expr: "true"
            type: Boolean
            target: record.values.IsClosed
        id: 11
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 1160
              - 200
              - 200
              - 80
            value: Make Update
            parent: "19"
          description: ""
        results:
          - expr: record
            target: caseUpdate
        arguments:
          - type: Handle
            value: CaseUpdate
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 13
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 1440
              - 40
              - 200
              - 80
            value: Set Update values
            parent: "19"
          description: ""
        results: []
        arguments:
          - expr: '"State set to \"Closed\""'
            type: String
            target: caseUpdate.values.Description
          - expr: '"State change"'
            type: String
            target: caseUpdate.values.Type
          - expr: record.recordID
            type: ID
            target: caseUpdate.values.CaseId
        id: 15
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 1440
              - 200
              - 200
              - 80
            value: Save Update
            parent: "19"
          description: ""
        results:
          - expr: record
            target: caseUpdate
        arguments:
          - expr: caseUpdate
            type: ComposeRecord
            target: record
        id: 17
      - ref: swimlane
        kind: visual
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 1960
              - 1920
              - 1680
              - 320
            value: Prepare and create Case Update
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 19
      - ref: swimlane
        kind: visual
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 1960
              - 2320
              - 1440
              - 320
            value: Handle Existing Solution
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 20
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 80
              - 40
              - 200
              - 80
            value: Check for Solution
            parent: "20"
          description: ""
        results: []
        arguments: []
        id: 21
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 80
              - 200
              - 200
              - 80
            value: Get Solution
            parent: "20"
          description: ""
        results:
          - expr: record
            target: solution
        arguments:
          - type: Handle
            value: Solution
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.values.SolutionId
            type: ID
            target: record
        id: 23
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2600
              - 2360
              - 200
              - 80
            value: Check SubmitAsSolution
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 26
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 360
              - 200
              - 200
              - 80
            value: Update record
            parent: "20"
          description: ""
        results: []
        arguments:
          - expr: solution.values.SolutionName
            type: String
            target: record.values.SolutionName
          - expr: solution.values.SolutionNote
            type: String
            target: record.values.SolutionNote
          - expr: solution.values.File
            type: Array
            target: record.values.SolutionFile
        id: 28
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "30"
            xywh:
              - 2600
              - 2520
              - 200
              - 80
            value: Save record
            parent: "1"
          description: ""
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 30
      - ref: swimlane
        kind: visual
        meta:
          name: ""
          visual:
            id: "34"
            xywh:
              - 1960
              - 2720
              - 1440
              - 160
            value: Create Solution
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 34
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "35"
            xywh:
              - 3160
              - 2360
              - 200
              - 80
            value: Get Settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 35
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 1200
              - 200
              - 200
              - 80
            value: Set nextSolutionNumber
            parent: "20"
          description: ""
        results: []
        arguments:
          - expr: 'settings.values.SolutionNextNumber ? settings.values.SolutionNextNumber : 0'
            type: Integer
            target: nextSolutionNumber
        id: 38
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "40"
            xywh:
              - 80
              - 40
              - 200
              - 80
            value: Make Solution
            parent: "34"
          description: ""
        results:
          - expr: record
            target: solution
        arguments:
          - type: Handle
            value: Solution
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 40
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "42"
            xywh:
              - 360
              - 40
              - 200
              - 80
            value: Set Solution Values
            parent: "34"
          description: ""
        results: []
        arguments:
          - expr: record.values.SolutionName
            type: String
            target: solution.values.SolutionName
          - expr: record.values.SolutionNote
            type: String
            target: solution.values.SolutionNote
          - expr: record.values.SolutionFile
            type: ID
            target: solution.values.File
          - expr: '"New"'
            type: String
            target: solution.values.Status
          - expr: "true"
            type: Boolean
            target: solution.values.IsPublished
          - expr: record.recordID
            type: ID
            target: solution.values.CaseId
          - expr: nextSolutionNumber
            type: Integer
            target: solution.values.SolutionNumber
          - expr: record.values.ProductId
            type: ID
            target: solution.values.ProductId
        id: 42
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "44"
            xywh:
              - 640
              - 40
              - 200
              - 80
            value: Save Solution
            parent: "34"
          description: ""
        results:
          - expr: record
            target: solution
        arguments:
          - expr: solution
            type: ComposeRecord
            target: record
        id: 44
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "46"
            xywh:
              - 920
              - 40
              - 200
              - 80
            value: Set SolutionNextNumber
            parent: "34"
          description: ""
        results: []
        arguments:
          - expr: settings.values.SolutionNextNumber + 1
            type: Integer
            target: settings.values.SolutionNextNumber
        id: 46
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "48"
            xywh:
              - 1200
              - 40
              - 200
              - 80
            value: Save Settings
            parent: "34"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
        id: 48
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "51"
            xywh:
              - 360
              - 200
              - 200
              - 80
            value: 'Warning: This case is already closed'
            parent: "19"
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: This case is already closed
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 51
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "62"
            xywh:
              - 760
              - 200
              - 200
              - 80
            value: 'Warning: Unable to close the case. Please add a solution name or select an existing solution before closing the case.'
            parent: "19"
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Unable to close the case. Please add a solution name or select an existing solution before closing the case
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 62
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 920
              - 200
              - 200
              - 80
            value: Refresh page
            parent: "20"
          description: ""
        results: []
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
        id: 63
    paths:
      - expr: record.values.Status == "Closed"
        meta:
          name: ""
          visual:
            id: "6"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Yes'
            parent: "19"
            points: []
          description: ""
        childid: 51
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No'
            parent: "19"
            points: []
          description: ""
        childid: 7
        parentid: 3
      - expr: '(record.values.SolutionName ? false : true) &&  (record.values.SolutionId ? false : true) && (record.values.SubmitAsSolution ? false : true)'
        meta:
          name: ""
          visual:
            id: "10"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - No'
            parent: "19"
            points: []
          description: ""
        childid: 62
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Yes'
            parent: "19"
            points: []
          description: ""
        childid: 11
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "14"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "19"
            points: []
          description: ""
        childid: 13
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "16"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "19"
            points: []
          description: ""
        childid: 15
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "18"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "19"
            points: []
          description: ""
        childid: 17
        parentid: 15
      - meta:
          name: ""
          visual:
            id: "22"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 17
      - expr: record.values.SolutionId
        meta:
          name: ""
          visual:
            id: "24"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Solution'
            parent: "20"
            points: []
          description: ""
        childid: 23
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "20"
            points: []
          description: ""
        childid: 28
        parentid: 23
      - meta:
          name: ""
          visual:
            id: "31"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 30
        parentid: 28
      - expr: 'record.values.SubmitAsSolution ? true : false'
        meta:
          name: ""
          visual:
            id: "36"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 35
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 30
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 38
        parentid: 35
      - meta:
          name: ""
          visual:
            id: "41"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 40
        parentid: 38
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "34"
            points: []
          description: ""
        childid: 42
        parentid: 40
      - meta:
          name: ""
          visual:
            id: "45"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "34"
            points: []
          description: ""
        childid: 44
        parentid: 42
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "34"
            points: []
          description: ""
        childid: 46
        parentid: 44
      - meta:
          name: ""
          visual:
            id: "49"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "34"
            points: []
          description: ""
        childid: 48
        parentid: 46
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points:
              - x: 3260
                "y": 2704
              - x: 2700
                "y": 2704
          description: ""
        childid: 30
        parentid: 48
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 63
        parentid: 30
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Case
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 80
              - 40
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "58"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "19"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Case
            parent: "19"
          description: ""
  CRM-Quote-SendToPriContact:
    enabled: true
    meta:
      name: CRM - Quote - Send To Pri Contact
      visual: null
      description: Send this Quote via email to the primary contact
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2040
              - 200
              - 80
            value: Check recipient
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 3
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2680
              - 2040
              - 200
              - 80
            value: Get LineItems
            parent: "1"
          description: ""
        results:
          - expr: records
            target: lineItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
        id: 6
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2960
              - 2360
              - 200
              - 80
            value: Send Mail
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"Corteza - Quote: " + record.values.QuoteNumber + " - " + record.values.Name'
            type: String
            target: subject
          - expr: record.values.Email
            type: String
            target: to
          - expr: html.document
            type: Reader
            target: html
        id: 11
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 2320
              - 2200
              - 200
              - 80
            value: 'אזהרה: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי.'
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 15
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2960
              - 2520
              - 200
              - 80
            value: 'הצלחה: הצעת המחיר נשלחה במייל'
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נשלחה במייל
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 16
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2960
              - 2200
              - 200
              - 80
            value: Quote to HTML
            parent: "1"
          description: ""
        results:
          - expr: document
            target: html
        arguments:
          - type: Handle
            value: quote
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
        id: 19
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "31"
            xywh:
              - 2960
              - 2040
              - 200
              - 80
            value: Set Render Variables
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: Vars
            target: renderVariables
          - expr: record
            type: ComposeRecord
            target: renderVariables.quote
          - expr: lineItems
            type: Array
            target: renderVariables.lineItems
        id: 31
    paths:
      - expr: 'record.values.Email ? true : false'
        meta:
          name: ""
          visual:
            id: "7"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Yes'
            parent: "1"
            points: []
          description: ""
        childid: 6
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - No'
            parent: "1"
            points: []
          description: ""
        childid: 15
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "14"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "21"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 19
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 31
        parentid: 6
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: null
          description: ""
        childid: 19
        parentid: 31
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Quote
            parent: "1"
          description: ""
  CRM-Quote-SendToCustomEmail:
    enabled: true
    meta:
      name: CRM - Quote - Send To Custom Email
      visual: null
      description: Sends quote email to custom address
    steps:
      - ref: input
        kind: prompt
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2040
              - 200
              - 80
            value: Prompt for Email
            parent: "1"
          description: ""
        results:
          - expr: value
            target: email
        arguments:
          - type: String
            value: הזנת מייל מותאם
            target: title
          - type: String
            value: 'נא להזין מייל אליו תישלח ההצעה:'
            target: message
          - expr: '"אימייל"'
            type: String
            target: label
          - type: String
            value: email
            target: type
        id: 3
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2600
              - 2040
              - 200
              - 80
            value: Check if email entered
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 5
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2960
              - 2040
              - 200
              - 80
            value: Get LineItems
            parent: "1"
          description: ""
        results:
          - expr: records
            target: lineItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
        id: 8
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 3240
              - 2360
              - 200
              - 80
            value: Send Email
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"Corteza - Quote: " + record.values.QuoteNumber + " - " + record.values.Name'
            type: String
            target: subject
          - expr: email
            type: String
            target: to
          - expr: html.document
            type: Reader
            target: html
        id: 13
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2600
              - 2200
              - 200
              - 80
            value: 'Warning: Please enter an email to send this quote to'
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please enter an email to send this quote to
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 19
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 3240
              - 2520
              - 200
              - 80
            value: 'הצלחה: הצעת המחיר נשלחה במייל'
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נשלחה במייל
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 20
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "29"
            xywh:
              - 3240
              - 2200
              - 200
              - 80
            value: Render Template
            parent: "1"
          description: ""
        results:
          - expr: document
            target: html
        arguments:
          - type: Handle
            value: quote
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
        id: 29
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "33"
            xywh:
              - 3240
              - 2040
              - 200
              - 80
            value: Set Render Variables
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: Vars
            target: renderVariables
          - expr: record
            type: ComposeRecord
            target: renderVariables.quote
          - expr: lineItems
            type: Array
            target: renderVariables.lineItems
        id: 33
    paths:
      - meta:
          name: ""
          visual:
            id: "6"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 3
      - expr: 'email ? true : false'
        meta:
          name: ""
          visual:
            id: "9"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 8
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "10"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 19
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "21"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "32"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 13
        parentid: 29
      - meta:
          name: ""
          visual:
            id: "36"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 29
        parentid: 33
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: null
          description: ""
        childid: 33
        parentid: 8
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Quote
            parent: "1"
          description: ""
  CRM-Quote-InsertNumber:
    enabled: true
    meta:
      name: CRM - Quote - Insert Number
      visual: null
      description: Sets the Quote number based on the settings
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2080
              - 200
              - 80
            value: Get Settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 3
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2960
              - 2080
              - 200
              - 80
            value: Set QuoteNumber
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: 'settings.values.QuoteNextNumber ? settings.values.QuoteNextNumber : 0'
            type: Integer
            target: nextQuoteNumber
          - expr: nextQuoteNumber
            type: Integer
            target: record.values.QuoteNumber
          - expr: nextQuoteNumber + 1
            type: Integer
            target: settings.values.QuoteNextNumber
        id: 5
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2960
              - 2240
              - 200
              - 80
            value: Save Settings
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
        id: 7
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2560
              - 2080
              - 200
              - 80
            value: Check if has number
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 11
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2560
              - 2240
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 14
    paths:
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 5
      - expr: 'record.values.QuoteNumber ? false : true'
        meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - No Number'
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "15"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Has number'
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 11
    triggers:
      - resourceType: compose:record
        eventType: beforeCreate
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2080
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Quote Before Create Quote
            parent: "1"
          description: ""
  CRM-Opportunity-NewQuote:
    enabled: true
    meta:
      name: CRM - Opportunity - New Quote
      visual: null
      description: Creates a new Quote record from an  existing Opportunity
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2240
              - 2200
              - 200
              - 80
            value: Initial record validation
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 3
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2600
              - 2200
              - 200
              - 80
            value: Notify missing account
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please link the opportunity to an account before generating a quote
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 4
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2840
              - 2200
              - 200
              - 80
            value: Invalid record
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 5
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2240
              - 2360
              - 200
              - 80
            value: Fetch settings
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 6
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2480
              - 2360
              - 200
              - 80
            value: Prepare setting values
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: settings.values.QuoteNextNumber
            type: Integer
            target: nextQuoteNumber
          - expr: settings.values.QuoteNextNumber + 1
            type: Integer
            target: settings.values.QuoteNextNumber
        id: 7
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2240
              - 2520
              - 200
              - 80
            value: Fetch related account
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: account
        arguments:
          - type: Handle
            value: Account
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: record.values.AccountId
            type: ID
            target: record
        id: 8
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2520
              - 2720
              - 200
              - 80
            value: Fetch related contact
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            target: contacts
          - expr: total
            target: contactCount
        arguments:
          - type: Handle
            value: Contact
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"AccountId=" + account.recordID'
            type: String
            target: query
        id: 9
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 2760
              - 2720
              - 200
              - 80
            value: Only one contact?
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 10
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2776
              - 2880
              - 200
              - 80
            value: Use the only contact
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: contacts[0]
            type: ComposeRecord
            target: contact
        id: 11
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 3176
              - 2720
              - 200
              - 80
            value: Find the primary contact
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: item
            target: c
        arguments:
          - expr: contacts
            type: Array
            target: items
        id: 12
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 3168
              - 2880
              - 200
              - 80
            value: Is primary contact?
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 13
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 3168
              - 3000
              - 200
              - 80
            value: Set contact
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: c
            type: ComposeRecord
            target: contact
        id: 14
      - ref: ""
        kind: break
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 3160
              - 3120
              - 200
              - 80
            value: Primary contact found
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 15
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 3536
              - 2880
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 16
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2240
              - 3240
              - 200
              - 80
            value: Prepare quote record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: quote
        arguments:
          - type: Handle
            value: Quote
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 17
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 2496
              - 3240
              - 200
              - 80
            value: Set quote parameters
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: '"Draft"'
            type: String
            target: quote.values.Status
          - expr: record.recordID
            type: ID
            target: quote.values.OpportunityId
          - expr: record.values.Amount
            type: Float
            target: quote.values.GrandTotal
          - expr: record.values.PricebookId
            type: ID
            target: quote.values.PricebookId
          - expr: record.values.Name
            type: String
            target: quote.values.Name
          - expr: record.values.Amount
            type: Float
            target: quote.values.Subtotal
          - expr: record.values.Amount
            type: Float
            target: quote.values.TotalPrice
          - expr: contact.recordID
            type: ID
            target: quote.values.ContactId
          - expr: contact.values.Email
            type: String
            target: quote.values.Email
          - expr: contact.values.Phone
            type: String
            target: quote.values.Phone
          - expr: contact.values.Fax
            type: String
            target: quote.values.Fax
          - expr: account.recordID
            type: ID
            target: quote.values.AccountId
          - expr: account.values.BillingStreet
            type: String
            target: quote.values.BillingStreet
          - expr: account.values.BillingCity
            type: String
            target: quote.values.BillingCity
          - expr: account.values.BillingState
            type: String
            target: quote.values.BillingState
          - expr: account.values.BillingPostalCode
            type: String
            target: quote.values.BillingPostalCode
          - expr: account.values.BillingCountry
            type: String
            target: quote.values.BillingCountry
          - expr: account.values.AccountName
            type: String
            target: quote.values.BillingName
          - expr: account.values.BillingStreet
            type: String
            target: quote.values.QuoteToStreet
          - expr: account.values.BillingCity
            type: String
            target: quote.values.QuoteToCity
          - expr: account.values.BillingState
            type: String
            target: quote.values.QuoteToState
          - expr: account.values.BillingPostalCode
            type: String
            target: quote.values.QuoteToPostalCode
          - expr: account.values.BillingCountry
            type: String
            target: quote.values.QuoteToCountry
          - expr: account.values.AccountName
            type: String
            target: quote.values.QuoteToName
          - expr: account.values.BillingStreet
            type: String
            target: quote.values.ShippingStreet
          - expr: account.values.BillingCity
            type: String
            target: quote.values.ShippingCity
          - expr: account.values.BillingState
            type: String
            target: quote.values.ShippingState
          - expr: account.values.BillingPostalCode
            type: String
            target: quote.values.ShippingPostalCode
          - expr: account.values.BillingCountry
            type: String
            target: quote.values.ShippingCountry
          - expr: account.values.AccountName
            type: String
            target: quote.values.ShippingName
          - expr: modDate(now(), settings.values.QuoteExpirationDays)
            type: DateTime
            target: quote.values.ExpirationDate
          - expr: nextQuoteNumber
            type: Integer
            target: quote.values.QuoteNumber
          - expr: record.values.CoverTemplate
            type: ID
            target: quote.values.CoverTemplate
          - expr: record.values.TermbookIds
            type: Any
            target: quote.values.TermbookIds
        id: 18
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2784
              - 3240
              - 200
              - 80
            value: Save quote
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: quote
        arguments:
          - type: ComposeRecord
            source: quote
            target: record
        id: 19
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2240
              - 3440
              - 200
              - 80
            value: Convert opportunity line items to quote line items
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: opportunityLineItem
        arguments:
          - type: Handle
            value: OpportunityLineItem
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"OpportunityId="+record.recordID'
            type: String
            target: query
        id: 20
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2600
              - 3440
              - 200
              - 80
            value: Prepare a quote line item
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: quoteLineItem
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 21
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "22"
            xywh:
              - 2880
              - 3440
              - 200
              - 80
            value: Set quote line item parameters
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: opportunityLineItem.values.Discount
            type: Float
            target: quoteLineItem.values.Discount
          - expr: opportunityLineItem.values.Description
            type: String
            target: quoteLineItem.values.Description
          - expr: opportunityLineItem.values.ListPrice
            type: Float
            target: quoteLineItem.values.ListPrice
          - expr: opportunityLineItem.values.PricebookEntryId
            type: Any
            target: quoteLineItem.values.PricebookEntryId
          - expr: opportunityLineItem.values.ProductId
            type: ID
            target: quoteLineItem.values.ProductId
          - expr: opportunityLineItem.values.ProductCode
            type: String
            target: quoteLineItem.values.ProductCode
          - expr: opportunityLineItem.values.Quantity
            type: Integer
            target: quoteLineItem.values.Quantity
          - expr: opportunityLineItem.values.UnitPrice
            type: Float
            target: quoteLineItem.values.UnitPrice
          - expr: opportunityLineItem.values.Subtotal
            type: Float
            target: quoteLineItem.values.Subtotal
          - expr: opportunityLineItem.values.TotalPrice
            type: Float
            target: quoteLineItem.values.TotalPrice
          - expr: quote.recordID
            type: ID
            target: quoteLineItem.values.QuoteId
          - expr: opportunityLineItem.values.Name
            type: String
            target: quoteLineItem.values.Name
        id: 22
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 3160
              - 3440
              - 200
              - 80
            value: Save quote line item
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: quoteLineItem
        arguments:
          - expr: quoteLineItem
            type: ComposeRecord
            target: record
        id: 23
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 3440
              - 3440
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 24
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "25"
            xywh:
              - 2240
              - 3840
              - 200
              - 80
            value: Update settings
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: ComposeRecord
            source: settings
            target: record
        id: 25
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2248
              - 3984
              - 200
              - 80
            value: Notify success
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נוצרה בהצלחה.
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 26
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 2240
              - 2720
              - 200
              - 80
            value: Prepare default contact
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: contact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 38
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "71"
            xywh:
              - 2528
              - 3984
              - 200
              - 80
            value: Redirect to quote edit
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: quote
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
        id: 71
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 3440
              - 3640
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 73
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "74"
            xywh:
              - 2600
              - 3640
              - 200
              - 80
            value: Prepare a quote included item
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: quoteIncludedItem
        arguments:
          - type: Handle
            value: QuoteIncludedItem
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 74
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 3160
              - 3640
              - 200
              - 80
            value: Save quote included item
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: quoteIncludedItem
        arguments:
          - expr: quoteIncludedItem
            type: ComposeRecord
            target: record
        id: 75
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "76"
            xywh:
              - 2880
              - 3640
              - 200
              - 80
            value: Set quote included item parameters
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: opportunityIncludedItem.values.Description
            type: String
            target: quoteIncludedItem.values.Description
          - expr: opportunityIncludedItem.values.ProductId
            type: ID
            target: quoteIncludedItem.values.ProductId
          - expr: opportunityIncludedItem.values.ProductCode
            type: String
            target: quoteIncludedItem.values.ProductCode
          - expr: opportunityIncludedItem.values.Quantity
            type: Integer
            target: quoteIncludedItem.values.Quantity
          - expr: quote.recordID
            type: ID
            target: quoteIncludedItem.values.QuoteId
          - expr: opportunityIncludedItem.values.Discount
            type: Float
            target: quoteIncludedItem.values.Discount
          - expr: opportunityIncludedItem.values.ListPrice
            type: Float
            target: quoteIncludedItem.values.ListPrice
          - expr: opportunityIncludedItem.values.PricebookEntryId
            type: Any
            target: quoteIncludedItem.values.PricebookEntryId
          - expr: opportunityIncludedItem.values.UnitPrice
            type: Float
            target: quoteIncludedItem.values.UnitPrice
          - expr: opportunityIncludedItem.values.Subtotal
            type: Float
            target: quoteIncludedItem.values.Subtotal
          - expr: opportunityIncludedItem.values.TotalPrice
            type: Float
            target: quoteIncludedItem.values.TotalPrice
          - expr: opportunityIncludedItem.values.Name
            type: String
            target: quoteIncludedItem.values.Name
        id: 76
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "78"
            xywh:
              - 2240
              - 3640
              - 200
              - 80
            value: Convert opportunity included items to quote line items
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: opportunityIncludedItem
        arguments:
          - type: Handle
            value: OpportunityIncludedItem
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"OpportunityId="+record.recordID'
            type: String
            target: query
        id: 78
    paths:
      - expr: 'record.values.AccountId ? false : true'
        meta:
          name: ""
          visual:
            id: "30"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 4
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "31"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 6
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "32"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 4
      - meta:
          name: ""
          visual:
            id: "33"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 6
      - meta:
          name: ""
          visual:
            id: "34"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 8
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "36"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 10
        parentid: 9
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 38
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "40"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 9
        parentid: 38
      - expr: contactCount == 1
        meta:
          name: ""
          visual:
            id: "41"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 10
      - meta:
          name: ""
          visual:
            id: "42"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 12
        parentid: 10
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Loop body'
            parent: "1"
            points: []
          description: ""
        childid: 13
        parentid: 12
      - expr: c.values.IsPrimary
        meta:
          name: ""
          visual:
            id: "44"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "45"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 15
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 17
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;
            value: '#2 - Loop end'
            parent: "1"
            points:
              - x: 3824
                "y": 2760
              - x: 3824
                "y": 3216
              - x: 2200
                "y": 3216
              - x: 2200
                "y": 3300
          description: ""
        childid: 17
        parentid: 12
      - meta:
          name: ""
          visual:
            id: "52"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Loop body'
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 20
      - meta:
          name: ""
          visual:
            id: "53"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 22
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "54"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 23
        parentid: 22
      - meta:
          name: ""
          visual:
            id: "55"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 24
        parentid: 23
      - meta:
          name: ""
          visual:
            id: "56"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Loop end'
            parent: "1"
            points: []
          description: ""
        childid: 78
        parentid: 20
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 25
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 18
        parentid: 17
      - meta:
          name: ""
          visual:
            id: "69"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 19
        parentid: 18
      - meta:
          name: ""
          visual:
            id: "70"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 19
      - meta:
          name: ""
          visual:
            id: "72"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 71
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "79"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Loop body'
            parent: "1"
            points: []
          description: ""
        childid: 74
        parentid: 78
      - meta:
          name: ""
          visual:
            id: "80"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 76
        parentid: 74
      - meta:
          name: ""
          visual:
            id: "81"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 75
        parentid: 76
      - meta:
          name: ""
          visual:
            id: "82"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 73
        parentid: 75
      - meta:
          name: ""
          visual:
            id: "84"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 25
        parentid: 78
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Opportunity
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2000
              - 2200
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "29"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Create a new quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-Pdf-SendToPriContact:
    enabled: true
    meta:
      name: CRM - Quote - Send PDF To Pri Contact
      visual: null
      description: Send this Quote as PDF via email to the primary contact
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2360
              - 2040
              - 200
              - 80
            value: Check recipient
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 3
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 2360
              - 2200
              - 200
              - 80
            value: 'אזהרה: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי.'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 15
      - ref: ""
        kind: exec-workflow
        meta:
          name: ""
          visual:
            id: "314"
            xywh:
              - 2680
              - 2040
              - 200
              - 80
            value: Execute a workflow and map variables from its scope to the current one
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments:
          - type: ID
            value: "332053026900541442"
            target: workflow
          - expr: |-
              {
                "record": record,
                "email": record.values.Email
              }
            type: Vars
            target: scope
        id: 314
    paths:
      - expr: 'record.values.Email ? true : false'
        meta:
          name: ""
          visual:
            id: "7"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Yes'
            parent: "1"
            points: []
          description: ""
        childid: 314
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - No'
            parent: "1"
            points: []
          description: ""
        childid: 15
        parentid: 3
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "53"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Opportunity-ApplyPriceBook:
    enabled: true
    meta:
      name: CRM - Opportunity - Apply Price Book
      visual: null
      description: עדכון מחרים מספר מחירים ונתוני הנחה
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2040
              - 200
              - 80
            value: Set pricebookId
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'record.values.PricebookId ? record.values.PricebookId : 0'
            type: ID
            target: pricebookId
        id: 3
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 3040
              - 2040
              - 200
              - 80
            value: Fetch Pricebooks
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            target: pricebooks
          - expr: total
            target: numOfPricebooks
        arguments:
          - type: Handle
            value: Pricebook
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"IsActive AND IsStandard"'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 5
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 3320
              - 2040
              - 200
              - 80
            value: Check Pricebooks
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 7
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 3040
              - 2200
              - 200
              - 80
            value: Set pricebookIds
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'pricebooks[0] ? pricebooks[0] : undefined'
            type: ComposeRecord
            target: pricebook
          - expr: 'pricebook ? pricebook.recordID : undefined'
            type: ID
            target: pricebookId
          - expr: pricebookId
            type: ID
            target: record.values.PricebookId
        id: 10
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 3760
              - 2040
              - 200
              - 80
            value: 'Warning: No Pricebooks'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - expr: '"לא הוגדרו ספרי מחיר להזדמנות זו. נא לבחור ספר מחירים"'
            type: String
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 12
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2600
              - 2400
              - 200
              - 80
            value: Check pricebookId
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 14
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 3320
              - 2400
              - 200
              - 80
            value: 'Warning: No Pricebook'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please select a Price book for this opportunity first.
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 17
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 3320
              - 2200
              - 200
              - 80
            value: Save Opportunity
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 20
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 2320
              - 2920
              - 200
              - 80
            value: Fetch IncludedItems
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
          - expr: index
            type: UnsignedInteger
            target: index
          - expr: total
            type: UnsignedInteger
            target: numOfLineItems
        arguments:
          - type: Handle
            value: OpportunityIncludedItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"OpportunityId = " + record.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 23
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2880
              - 2920
              - 200
              - 80
            value: Fetch Product
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: product
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: lineItem.values.ProductId
            type: ID
            target: record
        id: 26
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 2040
              - 2920
              - 200
              - 80
            value: Set Quote Total
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: "0"
            type: Float
            target: quoteTotal
        id: 28
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "30"
            xywh:
              - 2040
              - 3080
              - 200
              - 80
            value: Set Amount
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: quoteTotal
            type: Float
            target: record.values.Amount
        id: 30
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "32"
            xywh:
              - 2320
              - 3080
              - 200
              - 80
            value: Save Opportunity
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 32
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "34"
            xywh:
              - 2040
              - 3240
              - 200
              - 80
            value: 'הצלחה: ספר המחירים ייושם'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: ספר המחירים ייושם
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 34
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "36"
            xywh:
              - 2320
              - 3240
              - 200
              - 80
            value: Reload page
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Opportunity
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
        id: 36
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 3600
              - 2920
              - 200
              - 80
            value: Fetch Pricebook entry
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            target: pricebookEntries
          - expr: total
            target: numOfPricebookEntries
        arguments:
          - type: Handle
            value: PricebookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"PricebookId = " + pricebookId + " AND ProductId = " + lineItem.values.ProductId'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 38
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "41"
            xywh:
              - 2600
              - 3080
              - 200
              - 80
            value: Set pricebookEntry
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'numOfPricebookEntries > 0 ? pricebookEntries[0] : undefined'
            type: ComposeRecord
            target: pricebookEntry
        id: 41
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "45"
            xywh:
              - 3560
              - 3080
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 45
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 2880
              - 3080
              - 200
              - 80
            value: Set line item values
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'lineItem.values.Quantity ? lineItem.values.Quantity : 1'
            type: Float
            target: quantity
          - expr: 'lineItem.values.Discount ? lineItem.values.Discount : 0'
            type: Float
            target: discount
          - expr: 'pricebookEntry.values.UnitPrice ? pricebookEntry.values.UnitPrice : 0'
            type: Float
            target: listprice
          - expr: '(lineItem.values.UnitPrice ? false : true) ? listprice : (lineItem.values.UnitPrice ? lineItem.values.UnitPrice : 0)'
            type: Any
            target: unitprice
          - expr: unitprice * quantity
            type: Float
            target: subtotal
          - expr: subtotal - discount
            type: Float
            target: totalprice
          - expr: product.values.Name
            type: String
            target: lineItem.values.Name
          - expr: product.values.ProductCode
            type: String
            target: lineItem.values.ProductCode
          - expr: listprice
            type: Float
            target: lineItem.values.ListPrice
          - expr: unitprice
            type: Float
            target: lineItem.values.UnitPrice
          - expr: subtotal
            type: Float
            target: lineItem.values.Subtotal
          - expr: totalprice
            type: Float
            target: lineItem.values.TotalPrice
          - expr: quoteTotal + totalprice
            type: Float
            target: quoteTotal
        id: 49
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "51"
            xywh:
              - 3160
              - 3080
              - 200
              - 80
            value: Save lineItem
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
        arguments:
          - expr: lineItem
            type: ComposeRecord
            target: record
        id: 51
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "53"
            xywh:
              - 2600
              - 2040
              - 200
              - 80
            value: Check pricebookId
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 53
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3840
              - 2920
              - 200
              - 80
            value: Check numOfPricebookEntries > 0
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 66
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "91"
            xywh:
              - 3240
              - 2920
              - 200
              - 80
            value: Set line item product details
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: product.values.Description
            type: String
            target: lineItem.values.Description
          - expr: product.values.Photo
            type: String
            target: lineItem.values.Photo
        id: 91
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "93"
            xywh:
              - 3840
              - 2760
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 93
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "94"
            xywh:
              - 3160
              - 2600
              - 200
              - 80
            value: Fetch Product
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: product
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: lineItem.values.ProductId
            type: ID
            target: record
        id: 94
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "95"
            xywh:
              - 3520
              - 2600
              - 200
              - 80
            value: Set line item product details
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: product.values.Description
            type: String
            target: lineItem.values.Description
          - expr: product.values.Photo
            type: String
            target: lineItem.values.Photo
        id: 95
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "96"
            xywh:
              - 3880
              - 2600
              - 200
              - 80
            value: Fetch Pricebook entry
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            type: ComposeRecord
            target: pricebookEntries
          - expr: total
            type: UnsignedInteger
            target: numOfPricebookEntries
        arguments:
          - type: Handle
            value: PricebookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"PricebookId = " + pricebookId + " AND ProductId = " + lineItem.values.ProductId'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 96
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "97"
            xywh:
              - 4120
              - 2600
              - 200
              - 80
            value: Check numOfPricebookEntries > 0
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 97
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "98"
            xywh:
              - 3440
              - 2760
              - 200
              - 80
            value: Save lineItem
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
        arguments:
          - expr: lineItem
            type: ComposeRecord
            target: record
        id: 98
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "99"
            xywh:
              - 3160
              - 2760
              - 200
              - 80
            value: Set line item values
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'lineItem.values.Quantity ? lineItem.values.Quantity : 1'
            type: Float
            target: quantity
          - expr: 'lineItem.values.Discount ? lineItem.values.Discount : 0'
            type: Float
            target: discount
          - expr: 'pricebookEntry.values.UnitPrice ? pricebookEntry.values.UnitPrice : 0'
            type: Float
            target: listprice
          - expr: '(lineItem.values.UnitPrice ? false : true) ? listprice : (lineItem.values.UnitPrice ? lineItem.values.UnitPrice : 0)'
            type: Any
            target: unitprice
          - expr: unitprice * quantity
            type: Float
            target: subtotal
          - expr: subtotal - discount
            type: Float
            target: totalprice
          - expr: product.values.Name
            type: String
            target: lineItem.values.Name
          - expr: product.values.ProductCode
            type: String
            target: lineItem.values.ProductCode
          - expr: listprice
            type: Float
            target: lineItem.values.ListPrice
          - expr: unitprice
            type: Float
            target: lineItem.values.UnitPrice
          - expr: subtotal
            type: Float
            target: lineItem.values.Subtotal
          - expr: totalprice
            type: Float
            target: lineItem.values.TotalPrice
        id: 99
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "100"
            xywh:
              - 2600
              - 2600
              - 200
              - 80
            value: Fetch Line Items
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
          - expr: index
            type: UnsignedInteger
            target: index
          - expr: total
            type: UnsignedInteger
            target: numOfLineItems
        arguments:
          - type: Handle
            value: OpportunityLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"OpportunityId = " + record.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 100
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "102"
            xywh:
              - 2880
              - 2760
              - 200
              - 80
            value: Set pricebookEntry
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'numOfPricebookEntries > 0 ? pricebookEntries[0] : undefined'
            type: ComposeRecord
            target: pricebookEntry
        id: 102
    paths:
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 5
      - expr: numOfPricebooks > 0
        meta:
          name: ""
          visual:
            id: "11"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Pricebook'
            parent: "1"
            points: []
          description: ""
        childid: 10
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No Pricebooks'
            parent: "1"
            points: []
          description: ""
        childid: 12
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "21"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 10
      - expr: pricebookId != 0
        meta:
          name: ""
          visual:
            id: "24"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Pricebook'
            parent: "1"
            points: []
          description: ""
        childid: 100
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No pricebook'
            parent: "1"
            points: []
          description: ""
        childid: 17
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Iterate over included items
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 23
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 23
        parentid: 28
      - meta:
          name: ""
          visual:
            id: "31"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 30
        parentid: 23
      - meta:
          name: ""
          visual:
            id: "33"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 32
        parentid: 30
      - meta:
          name: ""
          visual:
            id: "35"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 34
        parentid: 32
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 36
        parentid: 34
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 91
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "52"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 51
        parentid: 49
      - expr: pricebookId != 0
        meta:
          name: ""
          visual:
            id: "56"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Has pricebookId'
            parent: "1"
            points: []
          description: ""
        childid: 100
        parentid: 53
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 20
      - meta:
          name: ""
          visual:
            id: "58"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No pricebookId'
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 53
      - expr: numOfPricebookEntries > 0
        meta:
          name: ""
          visual:
            id: "67"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has pricebook entries'
            parent: "1"
            points: []
          description: ""
        childid: 41
        parentid: 66
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No entry'
            parent: "1"
            points: []
          description: ""
        childid: 45
        parentid: 66
      - meta:
          name: ""
          visual:
            id: "70"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 49
        parentid: 41
      - meta:
          name: ""
          visual:
            id: "82"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 66
        parentid: 38
      - meta:
          name: ""
          visual:
            id: "90"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 53
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "92"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 38
        parentid: 91
      - meta:
          name: ""
          visual:
            id: "103"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Iterate over line items
            parent: "1"
            points: []
          description: ""
        childid: 94
        parentid: 100
      - meta:
          name: ""
          visual:
            id: "104"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 95
        parentid: 94
      - meta:
          name: ""
          visual:
            id: "105"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 98
        parentid: 99
      - expr: numOfPricebookEntries > 0
        meta:
          name: ""
          visual:
            id: "106"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has pricebook entries'
            parent: "1"
            points: []
          description: ""
        childid: 102
        parentid: 97
      - meta:
          name: ""
          visual:
            id: "107"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No entry'
            parent: "1"
            points: []
          description: ""
        childid: 93
        parentid: 97
      - meta:
          name: ""
          visual:
            id: "108"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 99
        parentid: 102
      - meta:
          name: ""
          visual:
            id: "109"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 97
        parentid: 96
      - meta:
          name: ""
          visual:
            id: "110"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 96
        parentid: 95
      - meta:
          name: ""
          visual:
            id: "111"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: null
          description: ""
        childid: 28
        parentid: 100
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Opportunity
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Opportunity
            parent: "1"
            defaultName: false
          description: ""
  CRM-Case-InsertNumber:
    enabled: true
    meta:
      name: CRM - Case - Insert Number
      visual: null
      description: This workflow assigns the case number based on the global settings record.
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2440
              - 2200
              - 200
              - 80
            value: Fetch settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace.ID
            type: ID
            target: namespace
        id: 3
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 3120
              - 2360
              - 200
              - 80
            value: Update settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
        id: 16
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2720
              - 2200
              - 200
              - 80
            value: Check if has number
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 21
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 2720
              - 2360
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 24
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 3120
              - 2200
              - 200
              - 80
            value: Set number
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: 'settings.values.CaseNextNumber ? settings.values.CaseNextNumber: 0'
            type: Integer
            target: record.values.CaseNumber
          - expr: record.values.CaseNumber + 1
            type: Integer
            target: settings.values.CaseNextNumber
        id: 26
    paths:
      - meta:
          name: ""
          visual:
            id: "22"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 3
      - expr: 'record.values.CaseNumber ? false : true'
        meta:
          name: ""
          visual:
            id: "23"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - No number'
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Has number'
            parent: "1"
            points: []
          description: ""
        childid: 24
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 26
    triggers:
      - resourceType: compose:record
        eventType: beforeCreate
        constraints:
          - op: =
            name: module
            values:
              - Case
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2120
              - 2200
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Before Create Case
            parent: "1"
          description: ""
  CRM-Account-CreateNewCase:
    enabled: true
    meta:
      name: CRM - Account - Create New Case
      visual: null
      description: Creates new Case record from an existing Account
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "56"
            xywh:
              - 2280
              - 2160
              - 200
              - 80
            value: Init primaryContact
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: "false"
            type: Boolean
            target: primaryContact
        id: 56
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2560
              - 2160
              - 200
              - 80
            value: Find primary contact
            parent: "1"
          description: ""
        results:
          - expr: record
            target: contact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"AccountId=" + record.recordID'
            type: String
            target: query
        id: 14
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2960
              - 2160
              - 200
              - 80
            value: Is primary contact?
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 17
      - ref: ""
        kind: break
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 3584
              - 2160
              - 200
              - 80
            value: Found it!
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 18
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 3320
              - 2160
              - 200
              - 80
            value: Set primary contact
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: contact
            type: ComposeRecord
            target: primaryContact
        id: 19
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2960
              - 2400
              - 200
              - 80
            value: Keep looking
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 20
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 2560
              - 2600
              - 200
              - 80
            value: Found primary contact?
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 28
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "29"
            xywh:
              - 2560
              - 2760
              - 200
              - 80
            value: No primary contact
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: The primary contact is not defined
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 29
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "34"
            xywh:
              - 3240
              - 2600
              - 200
              - 80
            value: Prepare record
            parent: "1"
          description: ""
        results:
          - expr: record
            target: case
        arguments:
          - type: Handle
            value: Case
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 34
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "36"
            xywh:
              - 3240
              - 2760
              - 200
              - 80
            value: Set record values
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"(no subject)"'
            type: String
            target: case.values.Subject
          - expr: primaryContact.recordID
            type: ID
            target: case.values.ContactId
          - expr: record.recordID
            type: ID
            target: case.values.AccountId
          - expr: '"New"'
            type: String
            target: case.values.Status
          - expr: '"Low"'
            type: String
            target: case.values.Priority
          - expr: trim(format("%s %s", primaryContact.values.FirstName, primaryContact.values.LastName))
            type: String
            target: case.values.SuppliedName
          - expr: primaryContact.values.Email
            type: String
            target: case.values.SuppliedEmail
          - expr: primaryContact.values.Phone
            type: String
            target: case.values.SuppliedPhone
          - expr: record.values.OwnerId
            type: ID
            target: case.values.OwnerId
          - expr: nextCaseNumber
            type: Integer
            target: case.values.CaseNumber
        id: 36
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 3520
              - 2600
              - 200
              - 80
            value: Create case
            parent: "1"
          description: ""
        results:
          - expr: record
            target: case
        arguments:
          - expr: case
            type: ComposeRecord
            target: record
        id: 38
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "40"
            xywh:
              - 3800
              - 2600
              - 200
              - 80
            value: Notify Case created
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: The new case has been created
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 40
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "42"
            xywh:
              - 3800
              - 2760
              - 200
              - 80
            value: Go to record editor
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Case
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: case
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
        id: 42
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "44"
            xywh:
              - 2960
              - 2600
              - 200
              - 80
            value: Fetch settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
        id: 44
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "45"
            xywh:
              - 2960
              - 2760
              - 200
              - 80
            value: Set nextCaseNumber
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: 'settings.values.CaseNextNumber ? settings.values.CaseNextNumber : 0'
            type: Integer
            target: nextCaseNumber
          - expr: settings.values.CaseNextNumber + 1
            type: Integer
            target: settings.values.CaseNextNumber
        id: 45
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "50"
            xywh:
              - 3520
              - 2760
              - 200
              - 80
            value: Save settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
        id: 50
    paths:
      - expr: contact.values.IsPrimary
        meta:
          name: ""
          visual:
            id: "24"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 19
        parentid: 17
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 17
      - meta:
          name: ""
          visual:
            id: "26"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 18
        parentid: 19
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Loop body'
            parent: "1"
            points: []
          description: ""
        childid: 17
        parentid: 14
      - expr: 'primaryContact ? false : true'
        meta:
          name: ""
          visual:
            id: "30"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 29
        parentid: 28
      - meta:
          name: ""
          visual:
            id: "33"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Loop end'
            parent: "1"
            points: []
          description: ""
        childid: 28
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "35"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 44
        parentid: 28
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 36
        parentid: 34
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 38
        parentid: 36
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 42
        parentid: 40
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 45
        parentid: 44
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 34
        parentid: 45
      - meta:
          name: ""
          visual:
            id: "51"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 50
        parentid: 38
      - meta:
          name: ""
          visual:
            id: "52"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 40
        parentid: 50
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 56
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Account
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 56
        meta:
          visual:
            id: "2"
            xywh:
              - 2000
              - 2160
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "2"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "56"
                parentID: "2"
            value: From Account
            parent: "1"
          description: ""
  CRM-Lead-ToAccount:
    enabled: true
    meta:
      name: CRM - Lead - To Account
      visual: null
      description: Converts Lead to Account record
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2520
              - 2200
              - 200
              - 80
            value: Already converted?
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 3
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2888
              - 2200
              - 200
              - 80
            value: Lead already converted
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: Info
            target: title
          - type: String
            value: This lead is already converted
            target: message
          - type: String
            value: info
            target: variant
        id: 5
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2528
              - 2400
              - 200
              - 80
            value: Prepare account record
            parent: "1"
          description: ""
        results:
          - expr: record
            target: account
        arguments:
          - type: Handle
            value: Account
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 6
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2816
              - 2400
              - 200
              - 80
            value: Populate account data
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: record.values.Street
            type: String
            target: account.values.BillingStreet
          - expr: record.values.City
            type: String
            target: account.values.BillingCity
          - expr: record.values.State
            type: String
            target: account.values.BillingState
          - expr: record.values.PostalCode
            type: String
            target: account.values.BillingPostalCode
          - expr: record.values.Country
            type: String
            target: account.values.BillingCountry
          - expr: record.values.Street
            type: String
            target: account.values.ShippingStreet
          - expr: record.values.City
            type: String
            target: account.values.ShippingCity
          - expr: record.values.State
            type: String
            target: account.values.ShippingState
          - expr: record.values.PostalCode
            type: String
            target: account.values.ShippingPostalCode
          - expr: record.values.Country
            type: String
            target: account.values.ShippingCountry
          - expr: record.values.AnnualRevenue
            type: String
            target: account.values.AnnualRevenue
          - expr: record.values.Description
            type: String
            target: account.values.Description
          - expr: record.values.Company
            type: String
            target: account.values.AccountName
          - expr: record.values.Fax
            type: String
            target: account.values.Fax
          - expr: record.values.Industry
            type: String
            target: account.values.Industry
          - expr: record.values.LeadSource
            type: String
            target: account.values.AccountSource
          - expr: record.values.Phone
            type: String
            target: account.values.Phone
          - expr: record.values.NumberOfEmployees
            type: Integer
            target: account.values.NumberOfEmployees
          - expr: record.values.Rating
            type: String
            target: account.values.Rating
          - expr: record.values.Website
            type: String
            target: account.values.Website
          - expr: record.values.Twitter
            type: String
            target: account.values.Twitter
          - expr: record.values.Facebook
            type: String
            target: account.values.Facebook
          - expr: record.values.LinkedIn
            type: String
            target: account.values.LinkedIn
          - expr: record.values.OwnerId
            type: ID
            target: account.values.OwnerId
          - expr: record.values.CampaignId
            type: Array
            target: account.values.CampaignId
        id: 7
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 3080
              - 2400
              - 200
              - 80
            value: Create account
            parent: "1"
          description: ""
        results:
          - expr: record
            target: account
        arguments:
          - type: ComposeRecord
            source: account
            target: record
        id: 8
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2544
              - 2584
              - 200
              - 80
            value: Prepare contact record
            parent: "1"
          description: ""
        results:
          - expr: record
            target: contact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 9
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 2800
              - 2584
              - 200
              - 80
            value: Populate contact data
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: record.values.Street
            type: String
            target: contact.values.MailingStreet
          - expr: record.values.City
            type: String
            target: contact.values.MailingCity
          - expr: record.values.State
            type: String
            target: contact.values.MailingState
          - expr: record.values.PostalCode
            type: String
            target: contact.values.MailingPostalCode
          - expr: record.values.Country
            type: String
            target: contact.values.MailingCountry
          - expr: record.values.Description
            type: String
            target: contact.values.Description
          - expr: record.values.DoNotCall
            type: Boolean
            target: contact.values.DoNotCall
          - expr: record.values.Email
            type: String
            target: contact.values.Email
          - expr: record.values.HasOptedOutOfEmail
            type: Boolean
            target: contact.values.HasOptedOutOfEmail
          - expr: record.values.Fax
            type: String
            target: contact.values.Fax
          - expr: record.values.HasOptedOutOfFax
            type: Boolean
            target: contact.values.HasOptedOutOfFax
          - expr: record.values.LeadSource
            type: String
            target: contact.values.LeadSource
          - expr: record.values.Twitter
            type: String
            target: contact.values.Twitter
          - expr: record.values.Facebook
            type: String
            target: contact.values.Facebook
          - expr: record.values.LinkedIn
            type: String
            target: contact.values.LinkedIn
          - expr: record.values.Salutation
            type: String
            target: contact.values.Salutation
          - expr: record.values.FirstName
            type: String
            target: contact.values.FirstName
          - expr: record.values.LastName
            type: String
            target: contact.values.LastName
          - expr: record.values.MobilePhone
            type: String
            target: contact.values.MobilePhone
          - expr: record.values.Phone
            type: String
            target: contact.values.Phone
          - expr: record.values.Title
            type: String
            target: contact.values.Title
          - expr: "true"
            type: Boolean
            target: contact.values.IsPrimary
          - expr: account.recordID
            type: ID
            target: contact.values.AccountId
          - expr: record.values.OwnerId
            type: ID
            target: contact.values.OwnerId
          - expr: record.values.CampaignId
            type: Array
            target: contact.values.CampaignId
        id: 10
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 3064
              - 2584
              - 200
              - 80
            value: Create contact
            parent: "1"
          description: ""
        results:
          - expr: record
            target: contact
        arguments:
          - type: ComposeRecord
            source: contact
            target: record
        id: 11
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 2560
              - 2760
              - 200
              - 80
            value: Update lead data
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"Converted"'
            type: String
            target: record.values.Status
          - expr: '"Yes"'
            type: String
            target: record.values.IsConverted
          - expr: account.recordID
            type: ID
            target: record.values.ConvertedAccountId
          - expr: contact.recordID
            type: ID
            target: record.values.ConvertedContactId
          - expr: account.createdAt
            type: DateTime
            target: record.values.ConvertedDate
        id: 12
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 2832
              - 2760
              - 200
              - 80
            value: Save lead
            parent: "1"
          description: ""
        results:
          - expr: record
            target: record
        arguments:
          - type: ComposeRecord
            source: record
            target: record
        id: 13
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2560
              - 3080
              - 200
              - 80
            value: Lead converted
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הליד הומר
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 17
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "79"
            xywh:
              - 2840
              - 3080
              - 200
              - 80
            value: Redirect to account page
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Account
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: account
            type: ComposeRecord
            target: record
        id: 79
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "81"
            xywh:
              - 2840
              - 2920
              - 200
              - 80
            value: Prepare email content
            parent: "1"
          description: ""
        results:
          - expr: document
            target: content
        arguments:
          - type: Handle
            value: lead_converted_content
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: contentRenderVariables
            type: Vars
            target: variables
        id: 81
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "83"
            xywh:
              - 3120
              - 2920
              - 200
              - 80
            value: Prepare email subject
            parent: "1"
          description: ""
        results:
          - expr: document
            target: subject
        arguments:
          - type: Handle
            value: lead_converted_subject
            target: lookup
          - type: String
            value: subject
            target: documentName
          - type: String
            value: text/plain
            target: documentType
          - expr: subjectRenderVariables
            type: Vars
            target: variables
        id: 83
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "85"
            xywh:
              - 3680
              - 2920
              - 200
              - 80
            value: Send email
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: subject.document
            type: Reader
            target: subject
          - expr: owner
            type: User
            target: to
          - expr: content.document
            type: Reader
            target: html
        id: 85
      - ref: usersLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "88"
            xywh:
              - 3400
              - 2920
              - 200
              - 80
            value: Get owner
            parent: "1"
          description: ""
        results:
          - expr: user
            target: owner
        arguments:
          - expr: record.values.OwnerId
            type: ID
            target: lookup
        id: 88
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "136"
            xywh:
              - 3120
              - 2760
              - 200
              - 80
            value: Has owner?
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 136
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "139"
            xywh:
              - 2560
              - 2920
              - 200
              - 80
            value: Prepare render Vars
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: Vars
            target: subjectRenderVariables
          - expr: record
            type: ComposeRecord
            target: subjectRenderVariables.lead
          - type: Vars
            target: contentRenderVariables
          - expr: record
            type: ComposeRecord
            target: contentRenderVariables.lead
          - expr: account
            type: ComposeRecord
            target: contentRenderVariables.account
        id: 139
    paths:
      - expr: record.values.Status == "Converted"
        meta:
          name: ""
          visual:
            id: "19"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "20"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 6
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "23"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 6
      - meta:
          name: ""
          visual:
            id: "26"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 10
        parentid: 9
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 10
      - meta:
          name: ""
          visual:
            id: "80"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 79
        parentid: 17
      - meta:
          name: ""
          visual:
            id: "82"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 136
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "84"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 83
        parentid: 81
      - meta:
          name: ""
          visual:
            id: "86"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 88
        parentid: 83
      - meta:
          name: ""
          visual:
            id: "87"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 17
        parentid: 85
      - meta:
          name: ""
          visual:
            id: "89"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 85
        parentid: 88
      - meta:
          name: ""
          visual:
            id: "107"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 8
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "108"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 9
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "109"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 12
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "110"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 13
        parentid: 12
      - expr: record.values.OwnerId != 0
        meta:
          name: ""
          visual:
            id: "137"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 139
        parentid: 136
      - meta:
          name: ""
          visual:
            id: "138"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points:
              - x: 3960
                "y": 2800
              - x: 3960
                "y": 3040
              - x: 2520
                "y": 3040
              - x: 2520
                "y": 3120
          description: ""
        childid: 17
        parentid: 136
      - meta:
          name: ""
          visual:
            id: "140"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 81
        parentid: 139
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Lead
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2200
              - 2200
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "111"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: To Account
            parent: "1"
          description: ""
  CRM-Account-CreateNewContract:
    enabled: true
    meta:
      name: CRM - Account - Create New Contract
      visual: null
      description: Creates new Contract record from an existing Account
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2424
              - 2200
              - 200
              - 80
            value: Fetch settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
        id: 3
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2680
              - 2200
              - 200
              - 80
            value: Prepare setting values
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: 'settings.values.ContractNextNumber ? settings.values.ContractNextNumber : 0'
            type: Integer
            target: nextContractNumber
          - expr: 'settings.values.ContractDefaultTime ? settings.values.ContractDefaultTime : 0'
            type: Integer
            target: contractDefaultTime
          - expr: settings.values.ContractNextNumber + 1
            type: Integer
            target: settings.values.ContractNextNumber
        id: 4
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2392
              - 2360
              - 200
              - 80
            value: Prepare contract record
            parent: "1"
          description: ""
        results:
          - expr: record
            target: contract
        arguments:
          - type: Handle
            value: Contract
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 5
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2648
              - 2360
              - 200
              - 80
            value: Update contract data
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: record.recordID
            type: ID
            target: contract.values.AccountId
          - expr: '"Draft"'
            type: String
            target: contract.values.Status
          - expr: record.values.BillingStreet
            type: String
            target: contract.values.BillingStreet
          - expr: record.values.BillingCity
            type: String
            target: contract.values.BillingCity
          - expr: record.values.BillingState
            type: String
            target: contract.values.BillingState
          - expr: record.values.BillingPostalCode
            type: String
            target: contract.values.BillingPostalCode
          - expr: record.values.BillingCountry
            type: String
            target: contract.values.BillingCountry
          - expr: record.values.BillingStreet
            type: String
            target: contract.values.ShippingStreet
          - expr: record.values.BillingCity
            type: String
            target: contract.values.ShippingCity
          - expr: record.values.BillingState
            type: String
            target: contract.values.ShippingState
          - expr: record.values.BillingPostalCode
            type: String
            target: contract.values.ShippingPostalCode
          - expr: record.values.BillingCountry
            type: String
            target: contract.values.ShippingCountry
          - expr: contractDefaultTime
            type: Integer
            target: contract.values.ContractTerm
          - expr: nextContractNumber
            type: Integer
            target: contract.values.ContractNumber
          - expr: record.values.OwnerId
            type: ID
            target: contract.values.OwnerId
        id: 6
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2920
              - 2360
              - 200
              - 80
            value: Save contract
            parent: "1"
          description: ""
        results:
          - expr: record
            target: contract
        arguments:
          - type: ComposeRecord
            source: contract
            target: record
        id: 7
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2400
              - 2560
              - 200
              - 80
            value: Update settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: ComposeRecord
            source: settings
            target: record
        id: 8
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2400
              - 2720
              - 200
              - 80
            value: Notify user
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: The new contract record has been created
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 9
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "22"
            xywh:
              - 2680
              - 2720
              - 200
              - 80
            value: Redirect user
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Contract
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: contract
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
        id: 22
    paths:
      - meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 4
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 4
      - meta:
          name: ""
          visual:
            id: "14"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 6
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "17"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 6
      - meta:
          name: ""
          visual:
            id: "18"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 8
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "19"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 9
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "23"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 22
        parentid: 9
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Account
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2120
              - 2200
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "11"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: Create new Contract
            parent: "1"
          description: ""
  CRM-Case-SetStatusToWorking:
    enabled: true
    meta:
      name: CRM - Case - Set Status To Working
      visual: null
      description: Creates new Contract record from an existing Account
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2680
              - 2000
              - 200
              - 80
            value: Set status
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '"Working"'
            type: String
            target: record.values.Status
        id: 3
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2680
              - 2200
              - 200
              - 80
            value: Update case
            parent: "1"
          description: ""
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 4
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2960
              - 2000
              - 200
              - 80
            value: Prepare case update
            parent: "1"
          description: ""
        results:
          - expr: record
            target: caseUpdate
        arguments:
          - type: Handle
            value: CaseUpdate
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 5
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2960
              - 2200
              - 200
              - 80
            value: Set case update data
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: record.recordID
            type: ID
            target: caseUpdate.values.CaseId
          - expr: '"State set to \"Working\""'
            type: String
            target: caseUpdate.values.Description
          - expr: '"State change"'
            type: String
            target: caseUpdate.values.Type
        id: 6
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 3240
              - 2000
              - 200
              - 80
            value: Create case update
            parent: "1"
          description: ""
        results:
          - expr: record
            target: caseUpdate
        arguments:
          - expr: caseUpdate
            type: ComposeRecord
            target: record
        id: 7
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2320
              - 2000
              - 200
              - 80
            value: Check if Status is "Working"
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 14
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2320
              - 2200
              - 200
              - 80
            value: 'Warning: Status already set to "Working"'
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Case Status already set to "Working"
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 19
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 3240
              - 2200
              - 200
              - 80
            value: Refresh page
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
          - expr: "false"
            type: Boolean
            target: edit
        id: 20
    paths:
      - meta:
          name: ""
          visual:
            id: "10"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 4
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "11"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 4
      - meta:
          name: ""
          visual:
            id: "12"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 6
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 6
      - expr: record.values.Status != "Working"
        meta:
          name: ""
          visual:
            id: "16"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 3
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "18"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 19
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "21"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 7
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Case
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 14
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2000
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "15"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "14"
                parentID: "2"
            value: Set case working
            parent: "1"
          description: ""
  CRM-Lead-UpdateCampaigns:
    enabled: true
    meta:
      name: CRM - Lead - Update Campaigns
      visual: null
      description: Update related Campaigns after a Lead is created, updated or deleted
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2440
              - 2120
              - 200
              - 80
            value: Set CampaignIds
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '[]'
            type: Array
            target: campaignIDs
        id: 5
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2680
              - 2120
              - 200
              - 80
            value: Iterate record CampaignIDs
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'record.recordID != "0" ? record.values.CampaignId : []'
            type: Array
            target: items
        id: 14
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2680
              - 2440
              - 200
              - 80
            value: Push campaignID
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: push(campaignIDs, "recordID = " + campaignID)
            type: Array
            target: campaignIDs
        id: 16
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2440
              - 200
              - 80
            value: Check next ID
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 21
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2680
              - 2280
              - 200
              - 80
            value: If already pushed
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 26
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 3040
              - 2120
              - 200
              - 80
            value: Iterate oldRecord CampaignIDs
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'oldRecord.recordID != "0" ? oldRecord.values.CampaignId : []'
            type: Array
            target: items
        id: 49
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3400
              - 2120
              - 200
              - 80
            value: Set campaign filter
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: join(campaignIDs, " OR ")
            type: String
            target: campaignFilter
        id: 58
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 3400
              - 2280
              - 200
              - 80
            value: Get Campaigns
            parent: "1"
          description: ""
        results:
          - expr: records
            target: campaigns
          - expr: total
            target: numOfCampaigns
        arguments:
          - type: Handle
            value: Campaigns
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: campaignFilter
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 61
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 3400
              - 2440
              - 200
              - 80
            value: Iterate over Campaigns
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaign
        arguments:
          - expr: campaigns
            type: Array
            target: items
        id: 63
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 3040
              - 2440
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 65
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3720
              - 2120
              - 200
              - 80
            value: Get NumberOfLeads
            parent: "1"
          description: ""
        results:
          - expr: total
            target: NumberOfLeads
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: '"CampaignId = " + campaign.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 66
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "71"
            xywh:
              - 3720
              - 2280
              - 200
              - 80
            value: Get NumberOfConvertedLeads
            parent: "1"
          description: ""
        results:
          - expr: total
            target: NumberOfConvertedLeads
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: '"(CampaignId = " + campaign.recordID + ") AND IsConverted"'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 71
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 3720
              - 2440
              - 200
              - 80
            value: Set Campaign Values
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: NumberOfLeads
            type: Integer
            target: campaign.values.NumberOfLeads
          - expr: NumberOfConvertedLeads
            type: Integer
            target: campaign.values.NumberOfConvertedLeads
        id: 73
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 4040
              - 2280
              - 200
              - 80
            value: Save Campaign
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: campaign
            type: ComposeRecord
            target: record
        id: 75
    paths:
      - expr: has(campaignIDs, campaignID)
        meta:
          name: ""
          visual:
            id: "28"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 49
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 58
        parentid: 49
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 61
        parentid: 58
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 63
        parentid: 61
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 66
        parentid: 63
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 65
        parentid: 63
      - meta:
          name: ""
          visual:
            id: "72"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 71
        parentid: 66
      - meta:
          name: ""
          visual:
            id: "74"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 73
        parentid: 71
      - meta:
          name: ""
          visual:
            id: "76"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 75
        parentid: 73
      - meta:
          name: ""
          visual:
            id: "91"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "93"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "94"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 49
        parentid: 14
    triggers:
      - resourceType: compose:record
        eventType: afterDelete
        constraints:
          - op: =
            name: module.handle
            values:
              - Lead
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 5
        meta:
          visual:
            id: "4"
            xywh:
              - 2160
              - 2240
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "10"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points:
                      - x: 2400
                        "y": 2280
                      - x: 2400
                        "y": 2200
                  description: ""
                childID: "5"
                parentID: "4"
            value: After Delete Lead
            parent: "1"
          description: ""
  CRM-Account-UpdateCampaigns:
    enabled: true
    meta:
      name: CRM - Account - Update Campaigns
      visual: null
      description: Update related Campaigns after a Account is created, updated or deleted
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2440
              - 2120
              - 200
              - 80
            value: Set CampaignIds
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '[]'
            type: Array
            target: campaignIDs
        id: 5
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2680
              - 2120
              - 200
              - 80
            value: Iterate record CampaignIDs
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'record.recordID != "0" ? record.values.CampaignId : []'
            type: Array
            target: items
        id: 14
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2680
              - 2440
              - 200
              - 80
            value: Push campaignID
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: push(campaignIDs, "recordID = " + campaignID)
            type: Array
            target: campaignIDs
        id: 16
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2440
              - 200
              - 80
            value: Check next ID
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 21
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2680
              - 2280
              - 200
              - 80
            value: If already pushed
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 26
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 3000
              - 2120
              - 200
              - 80
            value: Iterate oldrecord CampaignIDs
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'oldRecord.recordID != "0" ? oldRecord.values.CampaignId : []'
            type: Array
            target: items
        id: 49
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3320
              - 2120
              - 200
              - 80
            value: Set campaign filter
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: join(campaignIDs, " OR ")
            type: String
            target: campaignFilter
        id: 58
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 3320
              - 2280
              - 200
              - 80
            value: Get Campaigns
            parent: "1"
          description: ""
        results:
          - expr: records
            target: campaigns
          - expr: total
            target: numOfCampaigns
        arguments:
          - type: Handle
            value: Campaigns
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: campaignFilter
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 61
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 3320
              - 2440
              - 200
              - 80
            value: Iterate over Campaigns
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaign
        arguments:
          - expr: campaigns
            type: Array
            target: items
        id: 63
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 3000
              - 2440
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 65
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3640
              - 2120
              - 200
              - 80
            value: Get NumberOfAccounts
            parent: "1"
          description: ""
        results:
          - expr: total
            target: NumberOfAccounts
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: '"CampaignId = " + campaign.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 66
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 3640
              - 2280
              - 200
              - 80
            value: Set Campaign Values
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: NumberOfAccounts
            type: Integer
            target: campaign.values.NumberOfAccounts
        id: 73
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 3640
              - 2440
              - 200
              - 80
            value: Save Campaign
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: campaign
            type: ComposeRecord
            target: record
        id: 75
    paths:
      - expr: has(campaignIDs, campaignID)
        meta:
          name: ""
          visual:
            id: "28"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 49
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 49
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 58
        parentid: 49
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 61
        parentid: 58
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 63
        parentid: 61
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 66
        parentid: 63
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 65
        parentid: 63
      - meta:
          name: ""
          visual:
            id: "76"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 75
        parentid: 73
      - meta:
          name: ""
          visual:
            id: "77"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 73
        parentid: 66
    triggers:
      - resourceType: compose:record
        eventType: afterDelete
        constraints:
          - op: =
            name: module.handle
            values:
              - Account
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 5
        meta:
          visual:
            id: "4"
            xywh:
              - 2160
              - 2240
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "10"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points:
                      - x: 2400
                        "y": 2280
                      - x: 2400
                        "y": 2200
                  description: ""
                childID: "5"
                parentID: "4"
            value: After Delete Account
            parent: "1"
          description: ""
  CRM-Contact-UpdateCampaigns:
    enabled: true
    meta:
      name: CRM - Contact - Update Campaigns
      visual: null
      description: Update related Campaigns after a Contact is created, updated or deleted
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2440
              - 2120
              - 200
              - 80
            value: Set CampaignIds
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '[]'
            type: Array
            target: campaignIDs
        id: 5
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2680
              - 2120
              - 200
              - 80
            value: Iterate record CampaignIDs
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'record.recordID != "0" ? record.values.CampaignId : []'
            type: Array
            target: items
        id: 14
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2680
              - 2440
              - 200
              - 80
            value: Push campaignID
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: push(campaignIDs, "recordID = " + campaignID)
            type: Array
            target: campaignIDs
        id: 16
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2440
              - 200
              - 80
            value: Check next ID
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 21
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2680
              - 2280
              - 200
              - 80
            value: If already pushed
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 26
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 3000
              - 2120
              - 200
              - 80
            value: Iterate oldrecord CampaignIDs
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'oldRecord.recordID != "0" ? oldRecord.values.CampaignId : []'
            type: Array
            target: items
        id: 49
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3320
              - 2120
              - 200
              - 80
            value: Set campaign filter
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: join(campaignIDs, " OR ")
            type: String
            target: campaignFilter
        id: 58
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 3320
              - 2280
              - 200
              - 80
            value: Get Campaigns
            parent: "1"
          description: ""
        results:
          - expr: records
            target: campaigns
          - expr: total
            target: numOfCampaigns
        arguments:
          - type: Handle
            value: Campaigns
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: campaignFilter
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 61
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 3320
              - 2440
              - 200
              - 80
            value: Iterate over Campaigns
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaign
        arguments:
          - expr: campaigns
            type: Array
            target: items
        id: 63
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 3000
              - 2440
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 65
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3640
              - 2120
              - 200
              - 80
            value: Get NumberOfContacts
            parent: "1"
          description: ""
        results:
          - expr: total
            target: NumberOfContacts
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: '"CampaignId = " + campaign.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 66
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 3640
              - 2280
              - 200
              - 80
            value: Set Campaign Values
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: NumberOfContacts
            type: Integer
            target: campaign.values.NumberOfContacts
        id: 73
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 3640
              - 2440
              - 200
              - 80
            value: Save Campaign
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: campaign
            type: ComposeRecord
            target: record
        id: 75
    paths:
      - expr: has(campaignIDs, campaignID)
        meta:
          name: ""
          visual:
            id: "28"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 49
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 49
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 58
        parentid: 49
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 61
        parentid: 58
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 63
        parentid: 61
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 66
        parentid: 63
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 65
        parentid: 63
      - meta:
          name: ""
          visual:
            id: "76"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 75
        parentid: 73
      - meta:
          name: ""
          visual:
            id: "77"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 73
        parentid: 66
    triggers:
      - resourceType: compose:record
        eventType: afterDelete
        constraints:
          - op: =
            name: module.handle
            values:
              - Contact
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 5
        meta:
          visual:
            id: "4"
            xywh:
              - 2160
              - 2240
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "10"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points:
                      - x: 2400
                        "y": 2280
                      - x: 2400
                        "y": 2200
                  description: ""
                childID: "5"
                parentID: "4"
            value: After Delete Contact
            parent: "1"
          description: ""
  CRM-Contact-CreateNewCase:
    enabled: true
    meta:
      name: CRM - Contact - Create New Case
      visual: null
      description: Creates a new Case record from and existing Contact
    steps:
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2280
              - 2000
              - 200
              - 80
            value: Fetch settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
        id: 3
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2560
              - 2000
              - 200
              - 80
            value: Set nextCaseNumber
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: 'settings.values.CaseNextNumber ? settings.values.CaseNextNumber : 0'
            type: Integer
            target: nextCaseNumber
          - expr: settings.values.CaseNextNumber + 1
            type: Integer
            target: settings.values.CaseNextNumber
        id: 5
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2000
              - 2160
              - 200
              - 80
            value: Make Case
            parent: "1"
          description: ""
        results:
          - expr: record
            target: case
        arguments:
          - type: Handle
            value: Case
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
        id: 7
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2280
              - 2160
              - 200
              - 80
            value: Set Case Values
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: record.values.OwnerId
            type: ID
            target: case.values.OwnerId
          - expr: '"(no subject)"'
            type: String
            target: case.values.Subject
          - expr: record.recordID
            type: ID
            target: case.values.ContactId
          - expr: 'record.values.AccountId ? record.values.AccountId : 0'
            type: ID
            target: case.values.AccountId
          - expr: '"New"'
            type: String
            target: case.values.Status
          - expr: '"Low"'
            type: String
            target: case.values.Priority
          - expr: trim(format("%s %s", record.values.FirstName, record.values.LastName))
            type: String
            target: case.values.SuppliedName
          - expr: record.values.Email
            type: String
            target: case.values.SuppliedEmail
          - expr: record.values.Phone
            type: String
            target: case.values.SuppliedPhone
          - expr: nextCaseNumber
            type: Integer
            target: case.values.CaseNumber
        id: 9
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2560
              - 2160
              - 200
              - 80
            value: Create Case
            parent: "1"
          description: ""
        results:
          - expr: record
            target: case
        arguments:
          - expr: case
            type: ComposeRecord
            target: record
        id: 11
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 2000
              - 2320
              - 200
              - 80
            value: Save settings
            parent: "1"
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - expr: settings
            type: ComposeRecord
            target: record
        id: 13
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 2280
              - 2320
              - 200
              - 80
            value: Notify Case created
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: The new case has been created
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 15
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 2560
              - 2320
              - 200
              - 80
            value: Go to record editor
            parent: "1"
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Case
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: case
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
        id: 18
    paths:
      - meta:
          name: ""
          visual:
            id: "6"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "8"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "10"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 9
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 9
      - meta:
          name: ""
          visual:
            id: "16"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 15
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "17"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 13
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "19"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 18
        parentid: 15
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: namespace.handle
            values:
              - Contact
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2000
              - 2000
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: OnManual Contact
            parent: "1"
          description: ""
  CRM-Opportunity-UpdateCampaigns:
    enabled: true
    meta:
      name: CRM - Opportunity - Update Campaigns
      visual: null
      description: Update related Campaigns after an Opportunity is created, updated or deleted
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2440
              - 2120
              - 200
              - 80
            value: Set CampaignIds
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: '[]'
            type: Array
            target: campaignIDs
        id: 5
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2680
              - 2120
              - 200
              - 80
            value: Iterate record CampaignIDs
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'record.recordID != "0" ? record.values.CampaignId : []'
            type: Array
            target: items
        id: 14
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2680
              - 2440
              - 200
              - 80
            value: Push campaignID
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: push(campaignIDs, "recordID = " + campaignID)
            type: Array
            target: campaignIDs
        id: 16
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2440
              - 200
              - 80
            value: Check next ID
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 21
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2680
              - 2280
              - 200
              - 80
            value: If already pushed
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 26
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 3040
              - 2120
              - 200
              - 80
            value: Iterate oldRecord CampaignIDs
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaignID
        arguments:
          - expr: 'oldRecord.recordID != "0" ? oldRecord.values.CampaignId : []'
            type: Array
            target: items
        id: 49
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3400
              - 2120
              - 200
              - 80
            value: Set campaign filter
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: join(campaignIDs, " OR ")
            type: String
            target: campaignFilter
        id: 58
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 3400
              - 2280
              - 200
              - 80
            value: Get Campaigns
            parent: "1"
          description: ""
        results:
          - expr: records
            target: campaigns
          - expr: total
            target: numOfCampaigns
        arguments:
          - type: Handle
            value: Campaigns
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - expr: campaignFilter
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 61
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "63"
            xywh:
              - 3400
              - 2440
              - 200
              - 80
            value: Iterate over Campaigns
            parent: "1"
          description: ""
        results:
          - expr: item
            target: campaign
        arguments:
          - expr: campaigns
            type: Array
            target: items
        id: 63
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 3040
              - 2440
              - 200
              - 80
            value: End
            parent: "1"
          description: ""
        results: []
        arguments: []
        id: 65
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "73"
            xywh:
              - 4240
              - 2120
              - 200
              - 80
            value: Set Campaign Values
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: NumberOfOpportunities
            type: Integer
            target: campaign.values.NumberOfOpportunities
          - expr: AmountAllOpportunities
            type: Float
            target: campaign.values.AmountAllOpportunities
          - expr: NumberOfWonOpportunities
            type: Integer
            target: campaign.values.NumberOfWonOpportunities
          - expr: AmountWonOpportunities
            type: Float
            target: campaign.values.AmountWonOpportunities
        id: 73
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "75"
            xywh:
              - 4240
              - 2280
              - 200
              - 80
            value: Save Campaign
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: campaign
            type: ComposeRecord
            target: record
        id: 75
      - ref: composeRecordsReport
        kind: function
        meta:
          name: ""
          visual:
            id: "104"
            xywh:
              - 3680
              - 2280
              - 200
              - 80
            value: Generate Report All
            parent: "1"
          description: ""
        results:
          - expr: report
            target: report
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - type: String
            value: sum(Amount) AS amount
            target: metrics
          - expr: '"DATE_FORMAT(created_at, ''%Y-01-01'')"'
            type: String
            target: dimensons
          - expr: '"CampaignId = " + campaign.recordID'
            type: String
            target: filter
        id: 104
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "110"
            xywh:
              - 3680
              - 2120
              - 200
              - 80
            value: Set Number and Amount
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: "0"
            type: Integer
            target: NumberOfOpportunities
          - expr: "0"
            type: Float
            target: AmountAllOpportunities
        id: 110
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "112"
            xywh:
              - 3680
              - 2440
              - 200
              - 80
            value: Iterate report items
            parent: "1"
          description: ""
        results:
          - expr: item
            target: dimension
        arguments:
          - expr: 'report ? report : []'
            type: Array
            target: items
        id: 112
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "123"
            xywh:
              - 3680
              - 2600
              - 200
              - 80
            value: Update Number and Amount
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: NumberOfOpportunities + dimension.count
            type: Integer
            target: NumberOfOpportunities
          - expr: 'AmountAllOpportunities + (dimension.amount ? dimension.amount : 0)'
            type: Float
            target: AmountAllOpportunities
        id: 123
      - ref: composeRecordsReport
        kind: function
        meta:
          name: ""
          visual:
            id: "126"
            xywh:
              - 3960
              - 2280
              - 200
              - 80
            value: Generate Report Won
            parent: "1"
          description: ""
        results:
          - expr: report
            target: report
        arguments:
          - expr: module
            type: ComposeModule
            target: module
          - expr: namespace
            type: ComposeNamespace
            target: namespace
          - type: String
            value: sum(Amount) AS amount
            target: metrics
          - expr: '"DATE_FORMAT(created_at, ''%Y-01-01'')"'
            type: String
            target: dimensons
          - expr: '"(CampaignId = " + campaign.recordID + ") AND (StageName = ''Closed Won'')"'
            type: String
            target: filter
        id: 126
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "127"
            xywh:
              - 3960
              - 2120
              - 200
              - 80
            value: Set Number and Amount
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: "0"
            type: Integer
            target: NumberOfWonOpportunities
          - expr: "0"
            type: Float
            target: AmountWonOpportunities
        id: 127
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "128"
            xywh:
              - 3960
              - 2440
              - 200
              - 80
            value: Iterate report items
            parent: "1"
          description: ""
        results:
          - expr: item
            target: dimension
        arguments:
          - expr: 'report ? report : []'
            type: Array
            target: items
        id: 128
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "131"
            xywh:
              - 3960
              - 2600
              - 200
              - 80
            value: Update Number and Amount
            parent: "1"
          description: ""
        results: []
        arguments:
          - expr: NumberOfWonOpportunities + dimension.count
            type: Integer
            target: NumberOfWonOpportunities
          - expr: 'AmountWonOpportunities + (dimension.amount ? dimension.amount : 0)'
            type: Float
            target: AmountWonOpportunities
        id: 131
    paths:
      - expr: has(campaignIDs, campaignID)
        meta:
          name: ""
          visual:
            id: "28"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 49
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 58
        parentid: 49
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 61
        parentid: 58
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 63
        parentid: 61
      - meta:
          name: ""
          visual:
            id: "76"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 75
        parentid: 73
      - meta:
          name: ""
          visual:
            id: "91"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "105"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 110
        parentid: 63
      - meta:
          name: ""
          visual:
            id: "106"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 65
        parentid: 63
      - meta:
          name: ""
          visual:
            id: "111"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 104
        parentid: 110
      - meta:
          name: ""
          visual:
            id: "113"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 112
        parentid: 104
      - meta:
          name: ""
          visual:
            id: "124"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 123
        parentid: 112
      - meta:
          name: ""
          visual:
            id: "125"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 127
        parentid: 112
      - meta:
          name: ""
          visual:
            id: "129"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 126
        parentid: 127
      - meta:
          name: ""
          visual:
            id: "130"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 128
        parentid: 126
      - meta:
          name: ""
          visual:
            id: "132"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 131
        parentid: 128
      - meta:
          name: ""
          visual:
            id: "133"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 73
        parentid: 128
      - meta:
          name: ""
          visual:
            id: "134"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "135"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 49
        parentid: 14
    triggers:
      - resourceType: compose:record
        eventType: afterDelete
        constraints:
          - op: =
            name: module.handle
            values:
              - Opportunity
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 5
        meta:
          visual:
            id: "4"
            xywh:
              - 2160
              - 2240
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "10"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=1;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points:
                      - x: 2400
                        "y": 2280
                      - x: 2400
                        "y": 2200
                  description: ""
                childID: "5"
                parentID: "4"
            value: After Delete Opportunity
            parent: "1"
          description: ""
  CRM-Quote-SendReminderWithPDFToPriContact:
    enabled: true
    meta:
      name: CRM - Quote - Send reminder with PDF To Pri Contact
      visual: null
      description: ""
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 808
              - 1040
              - 200
              - 80
            value: Check recipient
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 6
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 1448
              - 1040
              - 200
              - 80
            value: Get LineItems
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            target: lineItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
        id: 7
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 808
              - 1200
              - 200
              - 80
            value: 'אזהרה: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי.'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 8
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 528
              - 1840
              - 200
              - 80
            value: Set Render Variables
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: Vars
            target: renderVariables
          - expr: record
            type: ComposeRecord
            target: renderVariables.quote
          - expr: lineItems
            type: Array
            target: renderVariables.lineItems
          - expr: |-
              {
                  "documentSize": "A4",
                  "contentScale": "1",
                  "orientation": "portrait",
                  "margin": "0.3"
                }
            type: Vars
            target: renderOptions
          - expr: join(["http://local.cortezaproject.org:18080/api/compose",coverImgUrl],'')
            type: String
            target: renderVariables.coverImgUrl
          - expr: strftime(now(),"%d/%m/%Y")
            type: String
            target: renderVariables.now
          - expr: priContact
            type: ComposeRecord
            target: renderVariables.priContact
          - expr: productImages
            type: Vars
            target: renderVariables.productImages
          - expr: productNames
            type: Vars
            target: renderVariables.productNames
          - expr: |
              join(["http://local.cortezaproject.org:18080/api/compose",aboutImgUrl],"")
            type: String
            target: renderVariables.aboutImgUrl
          - expr: ExpirationDate
            type: String
            target: renderVariables.expirationDate
          - expr: termItems
            type: Array
            target: renderVariables.termItems
        id: 9
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 528
              - 2000
              - 200
              - 80
            value: Mail Message Template
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            type: RenderedDocument
            target: mailHtml
        arguments:
          - type: Handle
            value: quote_pdf_reminder_email
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
        id: 10
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 808
              - 1360
              - 200
              - 80
            value: Prepare settings
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: settings.values.DefaultQuoteImage
            type: String
            target: DefaultQuoteImage
          - expr: settings.values.DefaultAboutImage
            type: String
            target: DefaultAboutImage
        id: 11
      - ref: oauth2Authenticate
        kind: function
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 1080
              - 1360
              - 200
              - 80
            value: get api token
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: accessToken
            type: String
            target: accessToken
        arguments:
          - expr: settings.values.Api_Auth_Client_User_Id
            type: String
            target: client
          - expr: settings.values.Api_Auth_Client_Secret
            type: String
            target: secret
          - type: String
            value: profile api
            target: scope
          - expr: join([settings.values.Domain,"/auth/oauth2/token"],'')
            type: String
            target: tokenUrl
        id: 12
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 528
              - 1680
              - 200
              - 80
            value: get cover image
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: status
            type: String
            target: attachemtResStatus
          - expr: body
            type: Reader
            target: attachmentReader
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", DefaultQuoteImage],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
        id: 13
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 808
              - 1680
              - 200
              - 80
            value: Prepare cover image results
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
        id: 14
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 1088
              - 1680
              - 200
              - 80
            value: jsenv get cover image preview url
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            target: coverImgUrl
        arguments:
          - expr: attachmentString
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
        id: 15
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 1088
              - 1840
              - 200
              - 80
            value: Quote to HTML Header
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            type: RenderedDocument
            target: headerHtml
        arguments:
          - type: Handle
            value: quote_pdf_header
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
        id: 16
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2008
              - 1040
              - 200
              - 80
            value: Get pri contact record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: priContact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.values.ContactId
            type: ID
            target: record
        id: 17
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 1368
              - 1840
              - 200
              - 80
            value: Quote to HTML Footer
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            target: footerHtml
        arguments:
          - type: Handle
            value: quote_pdf_footer
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
        id: 18
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 808
              - 1520
              - 200
              - 80
            value: get product data
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: item
            type: Any
            target: lineItem
        arguments:
          - expr: lineItems
            type: Array
            target: items
        id: 19
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 1088
              - 1520
              - 200
              - 80
            value: set product data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: lineItem.values.ProductId
            type: String
            target: ProductId
        id: 20
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 1648
              - 1520
              - 200
              - 80
            value: http get product image attachment
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: body
            type: Reader
            target: productImage
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
        id: 21
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "22"
            xywh:
              - 1928
              - 1520
              - 200
              - 80
            value: cast product image to string
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: productImage
            type: String
            target: productImage
        id: 22
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 2208
              - 1520
              - 200
              - 80
            value: jsenv image preview
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            type: String
            target: imagePreviewUrl
        arguments:
          - expr: productImage
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
        id: 23
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 528
              - 1520
              - 200
              - 80
            value: Prepare product Data Arrays
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: Vars
            target: productImages
          - type: Vars
            target: productNames
        id: 24
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "25"
            xywh:
              - 2488
              - 1520
              - 200
              - 80
            value: add product data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: |-
              {
                ProductId: join(["http://local.cortezaproject.org:18080/api/compose",imagePreviewUrl],'')}
            type: Vars
            target: imageItem
          - expr: merge(productImages,imageItem)
            type: Vars
            target: productImages
          - expr: '{ProductId: LineItemProduct.values.Name}'
            type: Vars
            target: nameItem
          - expr: merge(productNames,nameItem)
            type: Vars
            target: productNames
        id: 25
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2768
              - 1520
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 26
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "27"
            xywh:
              - 1368
              - 1680
              - 200
              - 80
            value: get about image
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: body
            type: Reader
            target: attachmentReader
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", DefaultAboutImage],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
        id: 27
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 1648
              - 1680
              - 200
              - 80
            value: Prepare about image results
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
        id: 28
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "29"
            xywh:
              - 1928
              - 1680
              - 200
              - 80
            value: jsenv get about image preview url
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            type: String
            target: aboutImgUrl
        arguments:
          - expr: attachmentString
            type: Any
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return `https://crm.tilnet.co.il/api/compose${js.response.url}`;
            target: source
        id: 29
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "30"
            xywh:
              - 1088
              - 1040
              - 200
              - 80
            value: Check quote name
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 30
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "31"
            xywh:
              - 1088
              - 1200
              - 200
              - 80
            value: Prepare quote name
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: '"הצעת מחיר לפיתוח"'
            type: String
            target: record.values.Name
        id: 31
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "32"
            xywh:
              - 2288
              - 1040
              - 200
              - 80
            value: jsenv set expiration date
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            type: String
            target: ExpirationDate
        arguments:
          - expr: record.values.ExpirationDate
            type: String
            target: scope
          - type: String
            value: return arguments[0].replace(/([\d]{4})-([\d]{2})-([\d]{2}).*/,"$3/$2/$1")
            target: source
        id: 32
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "33"
            xywh:
              - 1728
              - 1040
              - 200
              - 80
            value: Get TermItems
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            target: termItems
        arguments:
          - type: Handle
            value: QuoteTermItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
        id: 33
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "35"
            xywh:
              - 1368
              - 1520
              - 200
              - 80
            value: get LineItem Product record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: LineItemProduct
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: ProductId
            type: ID
            target: record
        id: 35
      - ref: corredorExec
        kind: function
        meta:
          name: ""
          visual:
            id: "36"
            xywh:
              - 1088
              - 2000
              - 200
              - 80
            value: Send PDF using Auto Script
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: results
            type: Vars
            target: res
        arguments:
          - type: String
            value: /server-scripts/tilnet-scripts/crm/send-pdf.js:default
            target: script
          - expr: |-
              {
                "record":record,
                "templateHtml": templateHtml,
                "headerHtml": headerHtml,
                "footerHtml": footerHtml,
                "mailTo": record.values.Email,
                "mailSubject":  quoteName,
                "quoteFileName":  join([quoteName],".pdf"),
                "messageHtml": messageHtml
              }
            type: Vars
            target: args
        id: 36
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "37"
            xywh:
              - 1088
              - 2160
              - 200
              - 80
            value: 'הצלחה: תזכורת נשלחה במייל'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נשלחה במייל
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 37
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 800
              - 1840
              - 200
              - 80
            value: Quote to HTML
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            type: RenderedDocument
            target: html
        arguments:
          - type: Handle
            value: quote_pdf
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
        id: 38
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "39"
            xywh:
              - 528
              - 1360
              - 200
              - 80
            value: get settings
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 39
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "40"
            xywh:
              - 808
              - 2000
              - 200
              - 80
            value: Prepare Automation Script Vars
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: html.document
            type: String
            target: templateHtml
          - expr: mailHtml.document
            type: String
            target: messageHtml
          - expr: headerHtml.document
            type: String
            target: headerHtml
          - expr: footerHtml.document
            type: String
            target: footerHtml
          - expr: join([record.values.Name,record.values.QuoteNumber]," - ")
            type: String
            target: quoteName
        id: 40
    paths:
      - expr: 'record.values.Email ? true : false'
        meta:
          name: ""
          visual:
            id: "41"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Yes'
            parent: "1"
            points: []
          description: ""
        childid: 30
        parentid: 6
      - meta:
          name: ""
          visual:
            id: "42"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - No'
            parent: "1"
            points: []
          description: ""
        childid: 8
        parentid: 6
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 38
        parentid: 9
      - meta:
          name: ""
          visual:
            id: "44"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 10
        parentid: 18
      - meta:
          name: ""
          visual:
            id: "45"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 40
        parentid: 10
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 39
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "49"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 9
        parentid: 29
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 15
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "51"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 36
        parentid: 40
      - meta:
          name: ""
          visual:
            id: "52"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 38
      - meta:
          name: ""
          visual:
            id: "53"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 37
        parentid: 36
      - meta:
          name: ""
          visual:
            id: "54"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 18
        parentid: 16
      - meta:
          name: ""
          visual:
            id: "55"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 19
      - meta:
          name: ""
          visual:
            id: "56"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 35
        parentid: 20
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 35
      - meta:
          name: ""
          visual:
            id: "58"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 22
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 25
        parentid: 23
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 33
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "61"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 39
        parentid: 32
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 24
        parentid: 12
      - meta:
          name: ""
          visual:
            id: "63"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 19
        parentid: 24
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 23
        parentid: 22
      - meta:
          name: ""
          visual:
            id: "65"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 25
      - meta:
          name: ""
          visual:
            id: "66"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 13
        parentid: 19
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 28
        parentid: 27
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 29
        parentid: 28
      - meta:
          name: ""
          visual:
            id: "69"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 27
        parentid: 15
      - expr: 'record.values.Name=="(unnamed)" ? true : false'
        meta:
          name: ""
          visual:
            id: "70"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 31
        parentid: 30
      - meta:
          name: ""
          visual:
            id: "71"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 30
      - meta:
          name: ""
          visual:
            id: "72"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 32
        parentid: 17
      - meta:
          name: ""
          visual:
            id: "73"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 17
        parentid: 33
      - meta:
          name: ""
          visual:
            id: "74"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 31
      - meta:
          name: ""
          visual:
            id: "80"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 12
        parentid: 11
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 6
        meta:
          visual:
            id: "34"
            xywh:
              - 528
              - 1040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "75"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: 6
                parentID: 34
            value: On Manual Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-Add-Note:
    enabled: true
    meta:
      name: CRM - Quote - Add Note
      visual: null
      description: Add not after sending quote or reminder
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2440
              - 2000
              - 200
              - 80
            value: Check Status
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 16
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2800
              - 2000
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 17
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 2120
              - 2160
              - 200
              - 80
            value: Prepate note to quote
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: note
        arguments:
          - type: Handle
            value: Note
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 18
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2800
              - 2320
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 19
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2800
              - 2160
              - 200
              - 80
            value: Save note
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: note
        arguments:
          - expr: note
            type: ComposeRecord
            target: record
        id: 20
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2440
              - 2160
              - 200
              - 80
            value: Set note parameters
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'record.values.Status == "Presented" ? "<p>נשלחה הצעת מחיר</p>": "<p>נשלחה תזכורת</p>"'
            type: String
            target: note.values.Body
          - expr: 'record.values.Status == "Presented" ? "נשלחה הצעת מחיר": "נשלחה תזכורת"'
            type: String
            target: note.values.Title
          - expr: record.recordID
            type: ID
            target: note.values.QuoteId
        id: 21
    paths:
      - expr: oldRecord.values.Status != record.values.Status && (record.values.Status == "Presented" || record.values.Status == "Reminder")
        meta:
          name: ""
          visual:
            id: "23"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: status changed
            parent: "1"
            points: []
          description: ""
        childid: 18
        parentid: 16
      - meta:
          name: ""
          visual:
            id: "24"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 17
        parentid: 16
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 18
      - meta:
          name: ""
          visual:
            id: "26"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 19
        parentid: 20
    triggers:
      - resourceType: compose:record
        eventType: beforeUpdate
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 16
        meta:
          visual:
            id: "9"
            xywh:
              - 2120
              - 2000
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "28"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: null
                  description: ""
                childID: "16"
                parentID: "9"
            value: Quote Before Update Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Lead-ToAccountAndOpportunity:
    enabled: true
    meta:
      name: CRM - Lead - To Account and Opportunity
      visual: null
      description: Converts Lead to Account and Opportunity
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "35"
            xywh:
              - 2488
              - 2520
              - 200
              - 80
            value: Already converted?
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 35
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "37"
            xywh:
              - 2496
              - 2720
              - 200
              - 80
            value: Prepare account record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: account
        arguments:
          - type: Handle
            value: Account
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 37
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 2728
              - 2720
              - 200
              - 80
            value: Populate account data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: record.values.Street
            type: String
            target: account.values.BillingStreet
          - expr: record.values.City
            type: String
            target: account.values.BillingCity
          - expr: record.values.State
            type: String
            target: account.values.BillingState
          - expr: record.values.PostalCode
            type: String
            target: account.values.BillingPostalCode
          - expr: record.values.Country
            type: String
            target: account.values.BillingCountry
          - expr: record.values.Street
            type: String
            target: account.values.ShippingStreet
          - expr: record.values.City
            type: String
            target: account.values.ShippingCity
          - expr: record.values.State
            type: String
            target: account.values.ShippingState
          - expr: record.values.PostalCode
            type: String
            target: account.values.ShippingPostalCode
          - expr: record.values.Country
            type: String
            target: account.values.ShippingCountry
          - expr: record.values.AnnualRevenue
            type: String
            target: account.values.AnnualRevenue
          - expr: record.values.Description
            type: String
            target: account.values.Description
          - expr: record.values.Company
            type: String
            target: account.values.AccountName
          - expr: record.values.Fax
            type: String
            target: account.values.Fax
          - expr: record.values.Industry
            type: String
            target: account.values.Industry
          - expr: record.values.OwnerId
            type: ID
            target: account.values.OwnerId
          - expr: record.values.LeadSource
            type: String
            target: account.values.AccountSource
          - expr: record.values.Phone
            type: String
            target: account.values.Phone
          - expr: record.values.NumberOfEmployees
            type: Integer
            target: account.values.NumberOfEmployees
          - expr: record.values.Rating
            type: String
            target: account.values.Rating
          - expr: record.values.Website
            type: String
            target: account.values.Website
          - expr: record.values.Twitter
            type: String
            target: account.values.Twitter
          - expr: record.values.Facebook
            type: String
            target: account.values.Facebook
          - expr: record.values.LinkedIn
            type: String
            target: account.values.LinkedIn
          - expr: record.values.OwnerId
            type: ID
            target: account.values.OwnerId
          - expr: record.values.CampaignId
            type: Array
            target: account.values.CampaignId
        id: 38
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "39"
            xywh:
              - 2968
              - 2720
              - 200
              - 80
            value: Create account
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: account
        arguments:
          - type: ComposeRecord
            source: account
            target: record
        id: 39
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "40"
            xywh:
              - 2512
              - 2904
              - 200
              - 80
            value: Prepare contact record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: contact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 40
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "41"
            xywh:
              - 2768
              - 2904
              - 200
              - 80
            value: Populate contact data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: record.values.Street
            type: String
            target: contact.values.MailingStreet
          - expr: record.values.City
            type: String
            target: contact.values.MailingCity
          - expr: record.values.State
            type: String
            target: contact.values.MailingState
          - expr: record.values.PostalCode
            type: String
            target: contact.values.MailingPostalCode
          - expr: record.values.Country
            type: String
            target: contact.values.MailingCountry
          - expr: record.values.Description
            type: String
            target: contact.values.Description
          - expr: record.values.DoNotCall
            type: Boolean
            target: contact.values.DoNotCall
          - expr: record.values.Email
            type: String
            target: contact.values.Email
          - expr: record.values.HasOptedOutOfEmail
            type: Boolean
            target: contact.values.HasOptedOutOfEmail
          - expr: record.values.Fax
            type: String
            target: contact.values.Fax
          - expr: record.values.HasOptedOutOfFax
            type: Boolean
            target: contact.values.HasOptedOutOfFax
          - expr: record.values.OwnerId
            type: ID
            target: contact.values.OwnerId
          - expr: record.values.LeadSource
            type: String
            target: contact.values.LeadSource
          - expr: record.values.Twitter
            type: String
            target: contact.values.Twitter
          - expr: record.values.Facebook
            type: String
            target: contact.values.Facebook
          - expr: record.values.LinkedIn
            type: String
            target: contact.values.LinkedIn
          - expr: record.values.Salutation
            type: String
            target: contact.values.Salutation
          - expr: record.values.FirstName
            type: String
            target: contact.values.FirstName
          - expr: record.values.LastName
            type: String
            target: contact.values.LastName
          - expr: record.values.MobilePhone
            type: String
            target: contact.values.MobilePhone
          - expr: record.values.Phone
            type: String
            target: contact.values.Phone
          - expr: record.values.Title
            type: String
            target: contact.values.Title
          - expr: "true"
            type: Boolean
            target: contact.values.IsPrimary
          - expr: account.recordID
            type: ID
            target: contact.values.AccountId
          - expr: record.values.OwnerId
            type: ID
            target: contact.values.OwnerId
          - expr: record.values.CampaignId
            type: Array
            target: contact.values.CampaignId
        id: 41
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "42"
            xywh:
              - 3032
              - 2904
              - 200
              - 80
            value: Create contact
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: contact
        arguments:
          - type: ComposeRecord
            source: contact
            target: record
        id: 42
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "43"
            xywh:
              - 2480
              - 3400
              - 200
              - 80
            value: Update lead data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: '"Converted"'
            type: String
            target: record.values.Status
          - expr: '"Yes"'
            type: String
            target: record.values.IsConverted
          - expr: account.recordID
            type: ID
            target: record.values.ConvertedAccountId
          - expr: contact.recordID
            type: ID
            target: record.values.ConvertedContactId
          - expr: account.createdAt
            type: DateTime
            target: record.values.ConvertedDate
          - expr: opportunity.recordID
            type: ID
            target: record.values.ConvertedOpportunityId
        id: 43
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "44"
            xywh:
              - 2760
              - 3400
              - 200
              - 80
            value: Save lead
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 44
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "64"
            xywh:
              - 2512
              - 3064
              - 200
              - 80
            value: Prepare opportunity record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: opportunity
        arguments:
          - type: Handle
            value: Opportunity
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 64
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "65"
            xywh:
              - 2768
              - 3064
              - 200
              - 80
            value: Populate opportunity data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: record.values.Description
            type: String
            target: opportunity.values.Description
          - expr: record.values.OwnerId
            type: ID
            target: opportunity.values.OwnerId
          - expr: record.values.LeadSource
            type: String
            target: opportunity.values.LeadSource
          - expr: '"(unnamed)"'
            type: String
            target: opportunity.values.Name
          - expr: account.recordID
            type: ID
            target: opportunity.values.AccountId
          - expr: '"No"'
            type: String
            target: opportunity.values.IsClosed
          - expr: '"No"'
            type: String
            target: opportunity.values.IsWon
          - expr: modDate(now(), settings.values.OpportunityCloseDateDays)
            type: DateTime
            target: opportunity.values.CloseDate
          - expr: settings.values.OpportunityProbability
            type: Float
            target: opportunity.values.Probability
          - expr: settings.values.OpportunityForecaseCategory
            type: String
            target: opportunity.values.ForecastCategory
          - expr: settings.values.OpportunityStagename
            type: String
            target: opportunity.values.StageName
          - expr: record.values.CampaignId
            type: Array
            target: opportunity.values.CampaignId
          - expr: record.values.Description
            type: String
            target: opportunity.values.Name
          - expr: record.recordID
            type: ID
            target: opportunity.values.LeadRef
        id: 65
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "66"
            xywh:
              - 3032
              - 3064
              - 200
              - 80
            value: Create opportunity
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: opportunity
        arguments:
          - type: ComposeRecord
            source: opportunity
            target: record
        id: 66
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "69"
            xywh:
              - 2488
              - 3216
              - 200
              - 80
            value: Prepare opportunity contact role record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: contactRole
        arguments:
          - type: Handle
            value: OpportunityContactRole
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 69
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "70"
            xywh:
              - 2784
              - 3224
              - 200
              - 80
            value: Populate opportunity contact role data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: contact.recordID
            type: ID
            target: contactRole.values.ContactId
          - expr: opportunity.recordID
            type: ID
            target: contactRole.values.OpportunityId
          - expr: "true"
            type: Boolean
            target: contactRole.values.IsPrimary
        id: 70
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "71"
            xywh:
              - 3064
              - 3224
              - 200
              - 80
            value: Create opportunity contact role
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: contactRole
        arguments:
          - type: ComposeRecord
            source: contactRole
            target: record
        id: 71
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "77"
            xywh:
              - 2208
              - 2520
              - 200
              - 80
            value: Fetch settings
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
        id: 77
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "113"
            xywh:
              - 2480
              - 3720
              - 200
              - 80
            value: Lead converted
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הליד הומר
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 113
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "115"
            xywh:
              - 2768
              - 3720
              - 200
              - 80
            value: Redirect to opportunity page
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Account
            target: module
          - type: Handle
            value: crm
            target: namespace
          - type: ComposeRecord
            source: opportunity
            target: record
        id: 115
      - ref: emailSend
        kind: function
        meta:
          name: ""
          visual:
            id: "118"
            xywh:
              - 3608
              - 3560
              - 200
              - 80
            value: Send email
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: subject.document
            type: Reader
            target: subject
          - expr: owner
            type: User
            target: to
          - expr: content.document
            type: Reader
            target: html
        id: 118
      - ref: usersLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "119"
            xywh:
              - 3328
              - 3560
              - 200
              - 80
            value: Get owner
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: user
            target: owner
        arguments:
          - expr: record.values.OwnerId
            type: ID
            target: lookup
        id: 119
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "132"
            xywh:
              - 3040
              - 3400
              - 200
              - 80
            value: Has owner?
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 132
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "139"
            xywh:
              - 2840
              - 2520
              - 200
              - 80
            value: Lead already converted
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: Info
            target: title
          - type: String
            value: This lead is already converted
            target: message
          - type: String
            value: info
            target: variant
        id: 139
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "140"
            xywh:
              - 2760
              - 3560
              - 200
              - 80
            value: Prepare email subject
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            target: subject
        arguments:
          - type: Handle
            value: lead_converted_subject
            target: lookup
          - type: String
            value: subject
            target: documentName
          - type: String
            value: text/plain
            target: documentType
          - expr: subjectRenderVariables
            type: Vars
            target: variables
        id: 140
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "142"
            xywh:
              - 3040
              - 3560
              - 200
              - 80
            value: Prepare email content
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            target: content
        arguments:
          - type: Handle
            value: lead_converted_content
            target: lookup
          - type: String
            value: content
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: contentRenderVariables
            type: Vars
            target: variables
        id: 142
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "145"
            xywh:
              - 2480
              - 3560
              - 200
              - 80
            value: Prepare render Vars
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: Vars
            target: subjectRenderVariables
          - expr: record
            type: ComposeRecord
            target: subjectRenderVariables.lead
          - type: Vars
            target: contentRenderVariables
          - expr: record
            type: ComposeRecord
            target: contentRenderVariables.lead
          - expr: account
            type: ComposeRecord
            target: contentRenderVariables.account
        id: 145
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "162"
            xywh:
              - 1640
              - 2720
              - 200
              - 80
            value: Search Account record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            type: ComposeRecord
            target: accounts
          - expr: total
            type: UnsignedInteger
            target: accountsTotal
        arguments:
          - type: Handle
            value: Account
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"AccountName=''" + record.values.Company + "'' AND AccountSource=''" + record.values.LeadSource + "''"'
            type: String
            target: query
          - type: Boolean
            value: "true"
            target: incTotal
        id: 162
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "163"
            xywh:
              - 1920
              - 2720
              - 200
              - 80
            value: Found Account?
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 163
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "164"
            xywh:
              - 1920
              - 2904
              - 200
              - 80
            value: Search Contact record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            type: ComposeRecord
            target: contacts
          - expr: total
            type: UnsignedInteger
            target: totalContacts
        arguments:
          - type: Handle
            value: Contact
            target: module
          - expr: namespace.namespaceID
            type: ID
            target: namespace
          - expr: '"LeadSource=''" + (record.values.LeadSource ?? "") + "'' AND FirstName=''" + (record.values.FirstName ?? "") + "'' AND LastName = ''" + (record.values.LastName ?? "") + "''"'
            type: String
            target: query
          - type: Boolean
            value: "true"
            target: incTotal
        id: 164
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "165"
            xywh:
              - 1640
              - 2904
              - 200
              - 80
            value: Define account record
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: accounts[0]
            type: ComposeRecord
            target: account
        id: 165
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "166"
            xywh:
              - 2192
              - 3064
              - 200
              - 80
            value: Set contact record
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: contacts[0]
            type: ComposeRecord
            target: contact
        id: 166
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "167"
            xywh:
              - 2192
              - 2904
              - 200
              - 80
            value: Found Contact?
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 167
    paths:
      - expr: record.values.Status == "Converted"
        meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 139
        parentid: 35
      - meta:
          name: ""
          visual:
            id: "51"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 37
        parentid: 35
      - meta:
          name: ""
          visual:
            id: "53"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 38
        parentid: 37
      - meta:
          name: ""
          visual:
            id: "54"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 39
        parentid: 38
      - meta:
          name: ""
          visual:
            id: "55"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 40
        parentid: 39
      - meta:
          name: ""
          visual:
            id: "56"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 41
        parentid: 40
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 42
        parentid: 41
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 44
        parentid: 43
      - meta:
          name: ""
          visual:
            id: "63"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: ""
            parent: "1"
            points: []
          description: ""
        childid: 35
        parentid: 77
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 65
        parentid: 64
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 66
        parentid: 65
      - meta:
          name: ""
          visual:
            id: "74"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 64
        parentid: 42
      - meta:
          name: ""
          visual:
            id: "75"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 69
        parentid: 66
      - meta:
          name: ""
          visual:
            id: "120"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 115
        parentid: 113
      - meta:
          name: ""
          visual:
            id: "123"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 113
        parentid: 118
      - meta:
          name: ""
          visual:
            id: "124"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 118
        parentid: 119
      - meta:
          name: ""
          visual:
            id: "129"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 71
        parentid: 70
      - meta:
          name: ""
          visual:
            id: "130"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 43
        parentid: 71
      - meta:
          name: ""
          visual:
            id: "131"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 70
        parentid: 69
      - meta:
          name: ""
          visual:
            id: "133"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 132
        parentid: 44
      - expr: record.values.OwnerId != 0
        meta:
          name: ""
          visual:
            id: "134"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 145
        parentid: 132
      - meta:
          name: ""
          visual:
            id: "135"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points:
              - x: 3880
                "y": 3440
              - x: 3880
                "y": 3680
              - x: 2440
                "y": 3680
              - x: 2440
                "y": 3760
          description: ""
        childid: 113
        parentid: 132
      - meta:
          name: ""
          visual:
            id: "143"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 142
        parentid: 140
      - meta:
          name: ""
          visual:
            id: "144"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 119
        parentid: 142
      - meta:
          name: ""
          visual:
            id: "146"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 140
        parentid: 145
      - meta:
          name: ""
          visual:
            id: "168"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 164
        parentid: 165
      - meta:
          name: ""
          visual:
            id: "169"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 167
        parentid: 164
      - meta:
          name: ""
          visual:
            id: "170"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 163
        parentid: 162
      - expr: totalContacts > 0
        meta:
          name: ""
          visual:
            id: "171"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 166
        parentid: 167
      - expr: accountsTotal > 0
        meta:
          name: ""
          visual:
            id: "172"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 165
        parentid: 163
      - meta:
          name: ""
          visual:
            id: "173"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: null
          description: ""
        childid: 37
        parentid: 163
      - meta:
          name: ""
          visual:
            id: "174"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: null
          description: ""
        childid: 40
        parentid: 167
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module
            values:
              - Lead
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 77
        meta:
          visual:
            id: "49"
            xywh:
              - 1920
              - 2520
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "78"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "77"
                parentID: "49"
            value: To Account and Opportunity
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-Before-Update-Or-Create:
    enabled: true
    meta:
      name: CRM - Quote - Before Update or Create
      visual: null
      description: Update cover text before a update/create of quote
    steps:
      - ref: ""
        kind: exec-workflow
        meta:
          name: ""
          visual:
            id: "41"
            xywh:
              - 2240
              - 1600
              - 200
              - 80
            value: Update Cover Text
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: ID
            value: "331905895061520386"
            target: workflow
          - expr: |-
              {
                "record": record,
                "oldRecord": oldRecord,
                "namespace": namespace
              }
            type: Vars
            target: scope
        id: 41
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "44"
            xywh:
              - 2560
              - 1600
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 44
    paths:
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: null
          description: ""
        childid: 44
        parentid: 41
    triggers:
      - resourceType: compose:record
        eventType: beforeUpdate
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 41
        meta:
          visual:
            id: "6"
            xywh:
              - 1880
              - 1520
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "33"
                    style: exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "41"
                parentID: "6"
            value: Quote Before Update Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-Update-Cover-Text:
    enabled: true
    meta:
      name: CRM - Quote - Update Cover Text
      visual: null
      description: Update quote cover text
      subWorkflow: true
    steps:
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2680
              - 1840
              - 200
              - 80
            value: Compose record lookup
            parent: "1"
            defaultName: true
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: coverLetterRec
        arguments:
          - type: Handle
            value: CoverTemplate
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: coverTemplateId
            type: ID
            target: record
        id: 3
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2680
              - 2000
              - 200
              - 80
            value: Define and mutate scope variables
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments:
          - expr: coverLetterRec.values.Content
            type: String
            target: coverLetter
          - expr: coverLetterRec.values.Content
            type: String
            target: record.values.CoverText
        id: 4
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2680
              - 2160
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 5
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2680
              - 1680
              - 200
              - 80
            value: Define and mutate scope variables
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments:
          - expr: record.values.CoverTemplate
            type: ID
            target: coverTemplateId
        id: 6
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2200
              - 1872
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 8
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2200
              - 1680
              - 200
              - 80
            value: Exclusive
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 9
    paths:
      - meta:
          name: ""
          visual:
            id: "12"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 4
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 3
        parentid: 6
      - meta:
          name: ""
          visual:
            id: "14"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 4
      - expr: 'record.values.CoverTemplate ? true : false'
        meta:
          name: ""
          visual:
            id: "15"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 6
        parentid: 9
      - meta:
          name: ""
          visual:
            id: "16"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 8
        parentid: 9
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 9
        meta:
          visual:
            id: "17"
            xywh:
              - 1840
              - 1888
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "18"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: null
                  description: ""
                childID: "9"
                parentID: "17"
            value: Compose record - onManual
            parent: "1"
            defaultName: true
          description: ""
  CRM-Quote-Set-totals:
    enabled: true
    meta:
      name: CRM - Quote - Set totals
      visual: null
      description: Set quote totals
    steps:
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 1160
              - 2480
              - 200
              - 80
            value: Fetch Included Items
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
          - expr: index
            type: UnsignedInteger
            target: index
          - expr: total
            type: UnsignedInteger
            target: numOfLineItems
        arguments:
          - type: Handle
            value: QuoteIncludedItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 3
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 880
              - 2480
              - 200
              - 80
            value: Set Quote Total
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: "0"
            type: Float
            target: quoteTotal
        id: 5
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 1240
              - 2640
              - 200
              - 80
            value: Set Amount
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: quoteTotal
            type: Float
            target: record.values.TotalPrice
          - expr: quoteTotal
            type: Float
            target: record.values.Subtotal
        id: 11
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 1480
              - 2480
              - 200
              - 80
            value: Set line item values
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'lineItem.values.ListPrice ? lineItem.values.ListPrice : 0'
            type: Float
            target: lineItem.values.ListPrice
          - expr: 'lineItem.values.UnitPrice ? lineItem.values.UnitPrice : 0'
            type: Float
            target: lineItem.values.UnitPrice
          - expr: 'lineItem.values.UnitPrice * (lineItem.values.Quantity ? lineItem.values.Quantity : 1)'
            type: Float
            target: lineItem.values.Subtotal
          - expr: 'lineItem.values.Subtotal - (lineItem.values.Discount ? lineItem.values.Discount : 0)'
            type: Float
            target: lineItem.values.TotalPrice
          - expr: quoteTotal + lineItem.values.TotalPrice
            type: Float
            target: quoteTotal
        id: 26
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "31"
            xywh:
              - 880
              - 3000
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 31
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "36"
            xywh:
              - 880
              - 2640
              - 200
              - 80
            value: Totals changed?
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 36
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "39"
            xywh:
              - 1560
              - 2640
              - 200
              - 80
            value: Update quote record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 39
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "41"
            xywh:
              - 1840
              - 2640
              - 200
              - 80
            value: Redirect user to the record page
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Quote
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.recordID
            type: ID
            target: record
        id: 41
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "45"
            xywh:
              - 880
              - 2840
              - 200
              - 80
            value: Show non-blocking message to user
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments:
          - type: String
            value: העדכון הצליח
            target: title
          - type: String
            value: סכום ההצעה עודכן
            target: message
        id: 45
    paths:
      - meta:
          name: ""
          visual:
            id: "16"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 3
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "25"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 39
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "30"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 36
        parentid: 3
      - expr: record.values.TotalPrice != quoteTotal || record.values.Subtotal != quoteTotal
        meta:
          name: ""
          visual:
            id: "37"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Changed
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 36
      - meta:
          name: ""
          visual:
            id: "38"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Not changed
            parent: "1"
            points: []
          description: ""
        childid: 45
        parentid: 36
      - meta:
          name: ""
          visual:
            id: "40"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 45
        parentid: 41
      - meta:
          name: ""
          visual:
            id: "42"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 41
        parentid: 39
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 31
        parentid: 45
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 5
        meta:
          visual:
            id: "43"
            xywh:
              - 880
              - 2320
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "44"
                    style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "5"
                parentID: "43"
            value: Compose record - onManual
            parent: "1"
            defaultName: true
          description: ""
  CRM-Quote-ApplyTermBooks:
    enabled: true
    meta:
      name: CRM - Quote - Apply Term Books
      visual: null
      description: ""
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2400
              - 1920
              - 200
              - 80
            value: Set termbooks ids
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: record.values.TermbookIds
            type: Array
            target: termbookIds
        id: 4
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2680
              - 1920
              - 200
              - 80
            value: Check Termbook Ids
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 8
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 3120
              - 1920
              - 200
              - 80
            value: 'Warning: no termbooks'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: נא לבחור לפחות ספר תנאים אחד
            target: message
          - type: String
            value: warning
            target: variant
        id: 12
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 2120
              - 2080
              - 200
              - 80
            value: Iterate term books
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: item
            target: termbookId
        arguments:
          - expr: termbookIds
            type: Array
            target: items
        id: 13
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2120
              - 2480
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 16
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 2120
              - 2280
              - 200
              - 80
            value: Add items to quote
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: TermbookEntry
        arguments:
          - type: Handle
            value: TermbookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"TermbookId = " + termbookId'
            type: String
            target: query
          - type: String
            value: Order
            target: sort
        id: 24
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 3408
              - 2280
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 28
      - ref: composeRecordsNew
        kind: function
        meta:
          name: ""
          visual:
            id: "31"
            xywh:
              - 2520
              - 2280
              - 200
              - 80
            value: 'Prepare quote term '
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: QuoteTermItem
        arguments:
          - type: Handle
            value: QuoteTermItem
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 31
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "32"
            xywh:
              - 2800
              - 2280
              - 200
              - 80
            value: Set quote term item fields
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: TermbookEntry.values.Name
            type: String
            target: QuoteTermItem.values.Name
          - expr: TermbookEntry.values.Description
            type: Array
            target: QuoteTermItem.values.Description
          - expr: record.recordID
            type: ID
            target: QuoteTermItem.values.QuoteId
        id: 32
      - ref: composeRecordsCreate
        kind: function
        meta:
          name: ""
          visual:
            id: "35"
            xywh:
              - 3080
              - 2280
              - 200
              - 80
            value: Save quote term item
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: QuoteTermItem
        arguments:
          - expr: QuoteTermItem
            type: ComposeRecord
            target: record
        id: 35
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "39"
            xywh:
              - 2120
              - 2640
              - 200
              - 80
            value: הצלחה
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: ספרי תנאים יושמו
            target: title
          - type: String
            value: כל התנאים מספרי התנאים שנבחרו יובאו להצעה
            target: message
        id: 39
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "42"
            xywh:
              - 2400
              - 2640
              - 200
              - 80
            value: redirect to quote edit page
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Quote
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
          - expr: "true"
            type: Boolean
            target: edit
        id: 42
    paths:
      - meta:
          name: ""
          visual:
            id: "7"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 8
        parentid: 4
      - expr: count(termbookIds) != 0
        meta:
          name: ""
          visual:
            id: "9"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Termbooks'
            parent: "1"
            points: []
          description: ""
        childid: 13
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "11"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No termbooks'
            parent: "1"
            points: []
          description: ""
        childid: 12
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "15"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 24
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "27"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 31
        parentid: 24
      - meta:
          name: ""
          visual:
            id: "33"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 32
        parentid: 31
      - meta:
          name: ""
          visual:
            id: "36"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 35
        parentid: 32
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 28
        parentid: 35
      - meta:
          name: ""
          visual:
            id: "38"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 24
      - meta:
          name: ""
          visual:
            id: "41"
            style: exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 39
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 42
        parentid: 39
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 4
        meta:
          visual:
            id: "3"
            xywh:
              - 2120
              - 1920
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "6"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "4"
                parentID: "3"
            value: On manual Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-QuoteIncludedItem-Calculate-Totals:
    enabled: true
    meta:
      name: CRM - QuoteIncludedItem - Calculate Totals
      visual: null
      description: Calculate QuoteIncludedItem totals
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2400
              - 2040
              - 200
              - 80
            value: Calculate Totals
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: '(record.values.UnitPrice ? record.values.UnitPrice : 0) * ( record.values.Quantity ? record.values.Quantity : 1)'
            type: Float
            target: record.values.Subtotal
          - expr: 'record.values.Subtotal - (record.values.Discount ? record.values.Discount : 0)'
            type: Float
            target: record.values.TotalPrice
          - expr: record.values.QuoteId
            type: ID
            target: quoteId
        id: 5
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2720
              - 2040
              - 200
              - 80
            value: Exclusive
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 8
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2720
              - 1880
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 11
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 3040
              - 2040
              - 200
              - 80
            value: Save Include Item
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 21
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 2400
              - 2280
              - 200
              - 80
            value: Define and mutate scope variables
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments:
          - expr: oldRecord.values.QuoteId
            type: Any
            target: quoteId
        id: 24
      - ref: ""
        kind: termination
        meta:
          name: ""
          visual:
            id: "27"
            xywh:
              - 2720
              - 2280
              - 200
              - 80
            value: Terminate workflow execution
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments: []
        id: 27
    paths:
      - expr: '!oldRecord.values.Subtotal || oldRecord.values.Subtotal != record.values.Subtotal || !oldRecord.values.TotalPrice || oldRecord.values.TotalPrice != record.values.TotalPrice'
        meta:
          name: ""
          visual:
            id: "12"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "13"
            style: exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "22"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 27
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "26"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 27
        parentid: 24
    triggers:
      - resourceType: compose:record
        eventType: beforeCreate
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - QuoteIncludedItem
        enabled: false
        stepID: 5
        meta:
          visual:
            id: "3"
            xywh:
              - 2120
              - 1960
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "6"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "5"
                parentID: "3"
            value: Before create QuoteIncludedItem
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-Pdf-SendToCustomEmail:
    enabled: true
    meta:
      name: CRM - Quote - Send PDF To Custom Email
      visual: null
      description: Sends quote PDF to custom address address
    steps:
      - ref: input
        kind: prompt
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2320
              - 2040
              - 200
              - 80
            value: Prompt for Email
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: value
            target: email
        arguments:
          - type: String
            value: הזנת מייל מותאם
            target: title
          - type: String
            value: 'נא להזין מייל אליו תישלח ההצעה:'
            target: message
          - expr: '"אימייל"'
            type: String
            target: label
          - type: String
            value: email
            target: type
        id: 3
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2600
              - 2040
              - 200
              - 80
            value: Check if email entered
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 5
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 2600
              - 2200
              - 200
              - 80
            value: 'Warning: Please enter an email to send this quote to'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please enter an email to send this quote to
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 19
    paths:
      - meta:
          name: ""
          visual:
            id: "6"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "22"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 19
        parentid: 5
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: namespace.handle
            values:
              - crm
          - op: =
            name: module.handle
            values:
              - Quote
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "2"
            xywh:
              - 2040
              - 2040
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "4"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "2"
            value: On Manual Quote
            parent: "1"
            defaultName: false
          description: ""
  CRM-Quote-Send-PDF-by-Email:
    enabled: true
    meta:
      name: CRM - Quote - Send PDF by Email
      visual: null
      description: Send PDF by mail
      subWorkflow: true
    steps:
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2000
              - 2040
              - 200
              - 80
            value: Check recipient
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 3
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 2640
              - 2040
              - 200
              - 80
            value: Get Included tems
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            type: ComposeRecord
            target: lineItems
        arguments:
          - type: Handle
            value: QuoteIncludedItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - type: String
            value: SortOrder
            target: sort
        id: 4
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 2048
              - 3368
              - 200
              - 80
            value: 'הצלחה: הצעת המחיר נשלחה במייל'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: הצעת המחיר נשלחה במייל
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 5
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 2608
              - 3048
              - 200
              - 80
            value: Set Render Variables
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: Vars
            target: renderVariables
          - expr: record
            type: ComposeRecord
            target: renderVariables.quote
          - expr: lineItems
            type: Array
            target: renderVariables.lineItems
          - expr: |-
              {
                  "documentSize": "A4",
                  "contentScale": "1",
                  "orientation": "portrait",
                  "margin": "0.3"
                }
            type: Vars
            target: renderOptions
          - expr: join([settings.values.Domain, "/api/compose",coverImgUrl],'')
            type: String
            target: renderVariables.coverImgUrl
          - expr: strftime(now(),"%d/%m/%Y")
            type: String
            target: renderVariables.now
          - expr: priContact
            type: ComposeRecord
            target: renderVariables.priContact
          - expr: productImages
            type: Vars
            target: renderVariables.productImages
          - expr: productNames
            type: Vars
            target: renderVariables.productNames
          - expr: |
              join([settings.values.Domain, "/api/compose",aboutImgUrl],"")
            type: String
            target: renderVariables.aboutImgUrl
          - expr: ExpirationDate
            type: String
            target: renderVariables.expirationDate
          - expr: termItems
            type: Any
            target: renderVariables.termItems
          - expr: productFamilies
            type: Vars
            target: renderVariables.productFamilies
          - expr: extensionItems
            type: Array
            target: renderVariables.extensionItems
          - expr: quoteTotalPrice
            type: String
            target: renderVariables.quoteTotalPrice
          - expr: productUnitPrices
            type: Vars
            target: renderVariables.productUnitPrices
          - expr: productTotals
            type: Vars
            target: renderVariables.productTotals
          - expr: productSubTotals
            type: Vars
            target: renderVariables.productSubTotals
        id: 6
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 2048
              - 3208
              - 200
              - 80
            value: Mail Message Template
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            type: RenderedDocument
            target: mailHtml
        arguments:
          - type: Handle
            value: quote_pdf_email
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
        id: 7
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2888
              - 3048
              - 200
              - 80
            value: Quote to HTML
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            target: html
        arguments:
          - type: Handle
            value: quote_pdf
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
          - expr: renderVariables
            type: Vars
            target: variables
        id: 8
      - ref: corredorExec
        kind: function
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 2608
              - 3208
              - 200
              - 80
            value: Send PDF using Auto Script
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: results
            type: Vars
            target: res
        arguments:
          - type: String
            value: /server-scripts/tilnet-scripts/crm/send-pdf.js:default
            target: script
          - expr: |-
              {
                "record":record,
                "templateHtml": templateHtml,
                "headerHtml": headerHtml,
                "footerHtml": footerHtml,
                "mailTo": email,
                "mailSubject":  quoteName,
                "quoteFileName":  join([quoteName],".pdf"),
                "messageHtml": messageHtml
              }
            type: Vars
            target: args
        id: 9
      - ref: oauth2Authenticate
        kind: function
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 2608
              - 2368
              - 200
              - 80
            value: get api token
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: accessToken
            type: String
            target: accessToken
        arguments:
          - type: String
            value: "255224430584660239"
            target: client
          - type: String
            value: 5ymwycOOMwdpwWOsBwmYVndbf4QAOF1zX46lr1SZloYzSwtPvaX126Mar0HPgAYB
            target: secret
          - type: String
            value: profile api
            target: scope
          - expr: join([settings.values.Domain,"/auth/oauth2/token"],'')
            type: String
            target: tokenUrl
        id: 10
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2048
              - 2888
              - 200
              - 80
            value: get cover image
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: status
            type: String
            target: attachemtResStatus
          - expr: body
            type: Reader
            target: attachmentReader
        arguments:
          - expr: format("%v%v%v/%v/%v", settings.values.Domain, "/api/compose/namespace/",record.namespaceID, "attachment/record", DefaultQuoteImage)
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
        id: 11
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 2608
              - 2888
              - 200
              - 80
            value: jsenv get cover image preview url
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            type: String
            target: coverImgUrl
        arguments:
          - expr: attachmentString
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
        id: 12
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 3168
              - 3048
              - 200
              - 80
            value: Quote to HTML Header
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            target: headerHtml
        arguments:
          - type: Handle
            value: quote_pdf_header
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
        id: 13
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 3480
              - 2040
              - 200
              - 80
            value: Get pri contact record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: priContact
        arguments:
          - type: Handle
            value: Contact
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.values.ContactId
            type: ID
            target: record
        id: 14
      - ref: templatesRender
        kind: function
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 3448
              - 3048
              - 200
              - 80
            value: Quote to HTML Footer
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: document
            target: footerHtml
        arguments:
          - type: Handle
            value: quote_pdf_footer
            target: lookup
          - type: String
            value: body
            target: documentName
          - type: String
            value: text/html
            target: documentType
        id: 15
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2608
              - 2528
              - 200
              - 80
            value: set product data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: lineItem.values.ProductId
            type: String
            target: ProductId
        id: 16
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 2888
              - 2528
              - 200
              - 80
            value: get LineItem Product record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: LineItemProduct
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: ProductId
            type: ID
            target: record
        id: 17
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 3168
              - 2528
              - 200
              - 80
            value: http get product image attachment
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: body
            type: Reader
            target: productImage
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
        id: 18
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 3448
              - 2528
              - 200
              - 80
            value: prepare product image request
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: productImage
            type: String
            target: productImage
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: productImageUrl
        id: 19
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 3728
              - 2528
              - 200
              - 80
            value: jsenv image preview
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            type: String
            target: imagePreviewUrl
        arguments:
          - expr: productImage
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
        id: 20
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 2048
              - 2528
              - 200
              - 80
            value: Prepare included product Data Arrays
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: Vars
            target: productImages
          - type: Vars
            target: productNames
          - type: Vars
            target: productFamilies
          - type: Vars
            target: productTotals
          - type: Vars
            target: productSubTotals
          - type: Vars
            target: productUnitPrices
        id: 21
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "22"
            xywh:
              - 4008
              - 2528
              - 200
              - 80
            value: add product data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: |-
              {
                ProductId: join([settings.values.Domain, "/api/compose",imagePreviewUrl],'')}
            type: Vars
            target: imageItem
          - expr: merge(productImages,imageItem)
            type: Vars
            target: productImages
          - expr: '{ProductId: LineItemProduct.values.Name}'
            type: Vars
            target: nameItem
          - expr: merge(productNames,nameItem)
            type: Vars
            target: productNames
          - expr: '{ProductId: LineItemProduct.values.Family}'
            type: Vars
            target: familyItem
          - expr: merge(productFamilies,familyItem)
            type: Vars
            target: productFamilies
        id: 22
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 4288
              - 2528
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 23
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 2888
              - 2888
              - 200
              - 80
            value: get about image
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: body
            type: Reader
            target: attachmentReader
        arguments:
          - expr: format("%v%v%v/%v/%v",settings.values.Domain, "/api/compose/namespace/",record.namespaceID, "attachment/record", DefaultAboutImage)
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
        id: 24
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "25"
            xywh:
              - 3168
              - 2888
              - 200
              - 80
            value: Prepare about image results
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
        id: 25
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "26"
            xywh:
              - 2280
              - 2040
              - 200
              - 80
            value: Check quote name
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 26
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "27"
            xywh:
              - 2280
              - 2200
              - 200
              - 80
            value: Prepare quote name
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: '"הצעת מחיר לפיתוח"'
            type: String
            target: record.values.Name
        id: 27
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "28"
            xywh:
              - 3760
              - 2040
              - 200
              - 80
            value: jsenv set expiration date
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            target: ExpirationDate
        arguments:
          - expr: record.values.ExpirationDate
            type: String
            target: scope
          - type: String
            value: return arguments[0].replace(/([\d]{4})-([\d]{2})-([\d]{2}).*/,"$3/$2/$1")
            target: source
        id: 28
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "29"
            xywh:
              - 3200
              - 2040
              - 200
              - 80
            value: Get TermItems
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            type: ComposeRecord
            target: termItems
        arguments:
          - type: Handle
            value: QuoteTermItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - type: String
            value: Order
            target: sort
        id: 29
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "30"
            xywh:
              - 2888
              - 3208
              - 200
              - 80
            value: Set quote status
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: '"Presented"'
            type: String
            target: record.values.Status
        id: 30
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "31"
            xywh:
              - 2328
              - 3368
              - 200
              - 80
            value: Redirect user to the record page
            parent: "1"
            defaultName: true
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Quote
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record.recordID
            type: ID
            target: record
        id: 31
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "32"
            xywh:
              - 2920
              - 2040
              - 200
              - 80
            value: Get Extension tems
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            type: ComposeRecord
            target: extensionItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - type: String
            value: SortOrder
            target: sort
        id: 32
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "33"
            xywh:
              - 4000
              - 2680
              - 200
              - 80
            value: add product data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: |-
              {
                ProductId: join([settings.values.Domain, "/api/compose",imagePreviewUrl],'')}
            type: Vars
            target: imageItem
          - expr: merge(productImages,imageItem)
            type: Vars
            target: productImages
          - expr: '{ProductId: LineItemProduct.values.Name}'
            type: Vars
            target: nameItem
          - expr: merge(productNames,nameItem)
            type: Vars
            target: productNames
          - expr: '{ProductId: LineItemProduct.values.Family}'
            type: Vars
            target: familyItem
          - expr: merge(productFamilies,familyItem)
            type: Vars
            target: productFamilies
          - expr: '{ProductId: totals[0]}'
            type: Vars
            target: unitPriceItem
          - expr: merge(productUnitPrices, unitPriceItem)
            type: Vars
            target: productUnitPrices
          - expr: '{ProductId: totals[1]}'
            type: Vars
            target: totalPriceItem
          - expr: merge(productTotals, totalPriceItem)
            type: Vars
            target: productTotals
          - expr: '{ProductId: totals[2]}'
            type: Vars
            target: subtotalItem
          - expr: merge(productSubTotals, subtotalItem)
            type: Vars
            target: productSubTotals
        id: 33
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "34"
            xywh:
              - 4280
              - 2680
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 34
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "35"
            xywh:
              - 2320
              - 2680
              - 200
              - 80
            value: set product data
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: extensionItem.values.ProductId
            type: String
            target: ProductId
        id: 35
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "36"
            xywh:
              - 3440
              - 2680
              - 200
              - 80
            value: jsenv image preview
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            type: String
            target: imagePreviewUrl
        arguments:
          - expr: productImage
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
        id: 36
      - ref: httpRequestSend
        kind: function
        meta:
          name: ""
          visual:
            id: "37"
            xywh:
              - 2880
              - 2680
              - 200
              - 80
            value: http get product image attachment
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: body
            type: Reader
            target: productImage
        arguments:
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: url
          - type: String
            value: GET
            target: method
          - expr: accessToken
            type: String
            target: headerAuthBearer
        id: 37
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "38"
            xywh:
              - 3160
              - 2680
              - 200
              - 80
            value: prepare product image request
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: productImage
            type: String
            target: productImage
          - expr: join([ settings.values.Domain, "api/compose/namespace",record.namespaceID, "attachment/record", LineItemProduct.values.Photo],"/")
            type: String
            target: productImageUrl
        id: 38
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "39"
            xywh:
              - 2000
              - 2200
              - 200
              - 80
            value: 'אזהרה: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי.'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: לא קושר אימייל להצעת המחיר. נא להזין פרטי איש קשר ראשי
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 39
      - ref: composeRecordsLast
        kind: function
        meta:
          name: ""
          visual:
            id: "41"
            xywh:
              - 2048
              - 2368
              - 200
              - 80
            value: get settings
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            target: settings
        arguments:
          - type: Handle
            value: Settings
            target: module
          - type: Handle
            value: crm
            target: namespace
        id: 41
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "42"
            xywh:
              - 3168
              - 3208
              - 200
              - 80
            value: Compose record update
            parent: "1"
            defaultName: true
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 42
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "43"
            xywh:
              - 3448
              - 2888
              - 200
              - 80
            value: jsenv get about image preview url
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            type: String
            target: aboutImgUrl
        arguments:
          - expr: attachmentString
            type: String
            target: scope
          - type: String
            value: |-
              const js = JSON.parse(arguments[0])
              return js.response.url;
            target: source
        id: 43
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "44"
            xywh:
              - 2600
              - 2680
              - 200
              - 80
            value: get LineItem Product record
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: LineItemProduct
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: ProductId
            type: ID
            target: record
        id: 44
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "45"
            xywh:
              - 2328
              - 3208
              - 200
              - 80
            value: Prepare Automation Script Vars
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: html.document
            type: String
            target: templateHtml
          - expr: mailHtml.document
            type: String
            target: messageHtml
          - expr: headerHtml.document
            type: String
            target: headerHtml
          - expr: footerHtml.document
            type: String
            target: footerHtml
          - expr: join([record.values.Name,record.values.QuoteNumber]," - ")
            type: String
            target: quoteName
        id: 45
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "46"
            xywh:
              - 2328
              - 2888
              - 200
              - 80
            value: Prepare cover image results
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: attachmentReader
            type: String
            target: attachmentString
        id: 46
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "47"
            xywh:
              - 2040
              - 2680
              - 200
              - 80
            value: get extension product data
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: item
            type: Any
            target: extensionItem
        arguments:
          - expr: extensionItems
            type: Array
            target: items
        id: 47
      - ref: loopEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "48"
            xywh:
              - 2328
              - 2528
              - 200
              - 80
            value: get product data
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: item
            type: Any
            target: lineItem
        arguments:
          - expr: lineItems
            type: Array
            target: items
        id: 48
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "49"
            xywh:
              - 2328
              - 2368
              - 200
              - 80
            value: Prepare settings
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: settings.values.DefaultQuoteImage
            type: String
            target: DefaultQuoteImage
          - expr: settings.values.DefaultAboutImage
            type: String
            target: DefaultAboutImage
        id: 49
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "99"
            xywh:
              - 2048
              - 3048
              - 200
              - 80
            value: Jsenv set quoteTotalPrice
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultString
            type: String
            target: quoteTotalPrice
        arguments:
          - expr: record.values.TotalPrice
            type: Any
            target: scope
          - type: String
            value: |-
              const parts = arguments[0].toString().split('.');
              parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
              return parts.join(".");
            target: source
        id: 99
      - ref: jsenvExecute
        kind: function
        meta:
          name: ""
          visual:
            id: "118"
            xywh:
              - 3720
              - 2680
              - 200
              - 80
            value: Jsenv - set product prices
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: resultAny
            type: Any
            target: totals
        arguments:
          - expr: |-
              [
                extensionItem.values.UnitPrice,
                extensionItem.values.TotalPrice,
                extensionItem.values.Subtotal
              ]
            type: Any
            target: scope
          - type: String
            value: |-
              let totals = arguments[0];
              let result=[];

              totals.forEach(function(total) {
                let parts = total.toString().split('.');
                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                result.push(parts.join("."));
              })
              return result
            target: source
        id: 118
    paths:
      - expr: 'email ? true : false'
        meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#1 - Yes'
            parent: "1"
            points: []
          description: ""
        childid: 26
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "51"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#2 - No'
            parent: "1"
            points: []
          description: ""
        childid: 39
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "52"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 8
        parentid: 6
      - meta:
          name: ""
          visual:
            id: "53"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 15
      - meta:
          name: ""
          visual:
            id: "54"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 45
        parentid: 7
      - meta:
          name: ""
          visual:
            id: "55"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 49
        parentid: 41
      - meta:
          name: ""
          visual:
            id: "56"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 46
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "57"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 99
        parentid: 43
      - meta:
          name: ""
          visual:
            id: "58"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 12
        parentid: 46
      - meta:
          name: ""
          visual:
            id: "59"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 9
        parentid: 45
      - meta:
          name: ""
          visual:
            id: "60"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 13
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "61"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 15
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "62"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 48
      - meta:
          name: ""
          visual:
            id: "63"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 17
        parentid: 16
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 18
        parentid: 17
      - meta:
          name: ""
          visual:
            id: "65"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 19
        parentid: 18
      - meta:
          name: ""
          visual:
            id: "66"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 22
        parentid: 20
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 32
        parentid: 4
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 41
        parentid: 28
      - meta:
          name: ""
          visual:
            id: "69"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 10
      - meta:
          name: ""
          visual:
            id: "70"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 48
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "71"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 19
      - meta:
          name: ""
          visual:
            id: "72"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 47
        parentid: 48
      - meta:
          name: ""
          visual:
            id: "73"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 25
        parentid: 24
      - meta:
          name: ""
          visual:
            id: "74"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 43
        parentid: 25
      - meta:
          name: ""
          visual:
            id: "75"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 24
        parentid: 12
      - expr: 'record.values.Name=="(unnamed)" ? true : false'
        meta:
          name: ""
          visual:
            id: "76"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - If'
            parent: "1"
            points: []
          description: ""
        childid: 27
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "77"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - Else (if)'
            parent: "1"
            points: []
          description: ""
        childid: 4
        parentid: 26
      - meta:
          name: ""
          visual:
            id: "78"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 28
        parentid: 14
      - meta:
          name: ""
          visual:
            id: "79"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 29
      - meta:
          name: ""
          visual:
            id: "80"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 4
        parentid: 27
      - meta:
          name: ""
          visual:
            id: "81"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 23
        parentid: 22
      - meta:
          name: ""
          visual:
            id: "82"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 30
        parentid: 9
      - meta:
          name: ""
          visual:
            id: "83"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 42
      - meta:
          name: ""
          visual:
            id: "84"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 42
        parentid: 30
      - meta:
          name: ""
          visual:
            id: "85"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 31
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "86"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 10
        parentid: 49
      - meta:
          name: ""
          visual:
            id: "87"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 29
        parentid: 32
      - meta:
          name: ""
          visual:
            id: "88"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Body
            parent: "1"
            points: []
          description: ""
        childid: 35
        parentid: 47
      - meta:
          name: ""
          visual:
            id: "89"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 44
        parentid: 35
      - meta:
          name: ""
          visual:
            id: "90"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 37
        parentid: 44
      - meta:
          name: ""
          visual:
            id: "91"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 38
        parentid: 37
      - meta:
          name: ""
          visual:
            id: "92"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 118
        parentid: 36
      - meta:
          name: ""
          visual:
            id: "93"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 36
        parentid: 38
      - meta:
          name: ""
          visual:
            id: "94"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 34
        parentid: 33
      - meta:
          name: ""
          visual:
            id: "95"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 47
      - meta:
          name: ""
          visual:
            id: "116"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 6
        parentid: 99
      - meta:
          name: ""
          visual:
            id: "122"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: null
          description: ""
        childid: 33
        parentid: 118
  CRM-Quote-ApplyPriceBook:
    enabled: true
    meta:
      name: CRM - Quote - Apply Price Book
      visual: null
      description: עדכון מחירים מספר מחירים ונתוני הנחה
    steps:
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "3"
            xywh:
              - 2336
              - 2056
              - 200
              - 80
            value: Set pricebookId
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'record.values.PricebookId ? record.values.PricebookId : 0'
            type: ID
            target: pricebookId
        id: 3
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "4"
            xywh:
              - 3056
              - 2056
              - 200
              - 80
            value: Fetch Pricebooks
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            type: ComposeRecord
            target: pricebooks
          - expr: total
            type: UnsignedInteger
            target: numOfPricebooks
        arguments:
          - type: Handle
            value: Pricebook
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"IsActive AND IsStandard"'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 4
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "5"
            xywh:
              - 3336
              - 2056
              - 200
              - 80
            value: Check Pricebooks
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 5
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "6"
            xywh:
              - 3056
              - 2216
              - 200
              - 80
            value: Set pricebookIds
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'pricebooks[0] ? pricebooks[0] : undefined'
            type: ComposeRecord
            target: pricebook
          - expr: 'pricebook ? pricebook.recordID : undefined'
            type: ID
            target: pricebookId
          - expr: pricebookId
            type: ID
            target: record.values.PricebookId
        id: 6
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "7"
            xywh:
              - 3776
              - 2056
              - 200
              - 80
            value: 'Warning: No Pricebooks'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - expr: '"לא הוגדרו ספרי מחיר להזדמנות זו. נא לבחור ספר מחירים"'
            type: String
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 7
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "8"
            xywh:
              - 2616
              - 2416
              - 200
              - 80
            value: Check pricebookId
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 8
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "9"
            xywh:
              - 3336
              - 2416
              - 200
              - 80
            value: 'Warning: No Pricebook'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: אזהרה
            target: title
          - type: String
            value: Please select a Price book for this opportunity first.
            target: message
          - type: String
            value: אזהרה
            target: variant
        id: 9
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "10"
            xywh:
              - 3336
              - 2216
              - 200
              - 80
            value: Save Quote
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 10
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "11"
            xywh:
              - 2320
              - 3088
              - 200
              - 80
            value: Fetch Included Items
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
          - expr: index
            type: UnsignedInteger
            target: index
          - expr: total
            type: UnsignedInteger
            target: numOfLineItems
        arguments:
          - type: Handle
            value: QuoteIncludedItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 11
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "12"
            xywh:
              - 2880
              - 3088
              - 200
              - 80
            value: Fetch Product
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: product
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: lineItem.values.ProductId
            type: ID
            target: record
        id: 12
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "13"
            xywh:
              - 2040
              - 3088
              - 200
              - 80
            value: Set Quote Total
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: "0"
            type: Float
            target: quoteTotal
        id: 13
      - ref: recordPage
        kind: prompt
        meta:
          name: ""
          visual:
            id: "14"
            xywh:
              - 2320
              - 3408
              - 200
              - 80
            value: Reload page
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: Handle
            value: Quote
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: record
            type: ComposeRecord
            target: record
        id: 14
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "15"
            xywh:
              - 3600
              - 3088
              - 200
              - 80
            value: Fetch Pricebook entry
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            type: ComposeRecord
            target: pricebookEntries
          - expr: total
            type: UnsignedInteger
            target: numOfPricebookEntries
        arguments:
          - type: Handle
            value: PricebookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"PricebookId = " + pricebookId + " AND ProductId = " + lineItem.values.ProductId'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 15
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "16"
            xywh:
              - 2600
              - 3248
              - 200
              - 80
            value: Set pricebookEntry
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'numOfPricebookEntries > 0 ? pricebookEntries[0] : undefined'
            type: ComposeRecord
            target: pricebookEntry
        id: 16
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "17"
            xywh:
              - 3560
              - 3248
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 17
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "18"
            xywh:
              - 2880
              - 3248
              - 200
              - 80
            value: Set line item values
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'lineItem.values.Quantity ? lineItem.values.Quantity : 1'
            type: Float
            target: quantity
          - expr: 'lineItem.values.Discount ? lineItem.values.Discount : 0'
            type: Float
            target: discount
          - expr: 'pricebookEntry.values.UnitPrice ? pricebookEntry.values.UnitPrice : 0'
            type: Float
            target: listprice
          - expr: '(lineItem.values.UnitPrice ? false : true) ? listprice : (lineItem.values.UnitPrice ? lineItem.values.UnitPrice : 0)'
            type: Any
            target: unitprice
          - expr: unitprice * quantity
            type: Float
            target: subtotal
          - expr: subtotal - discount
            type: Float
            target: totalprice
          - expr: product.values.ProductCode
            type: String
            target: lineItem.values.ProductCode
          - expr: listprice
            type: Float
            target: lineItem.values.ListPrice
          - expr: unitprice
            type: Float
            target: lineItem.values.UnitPrice
          - expr: subtotal
            type: Float
            target: lineItem.values.Subtotal
          - expr: totalprice
            type: Float
            target: lineItem.values.TotalPrice
          - expr: quoteTotal + totalprice
            type: Float
            target: quoteTotal
        id: 18
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "19"
            xywh:
              - 3160
              - 3248
              - 200
              - 80
            value: Save lineItem
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
        arguments:
          - expr: lineItem
            type: ComposeRecord
            target: record
        id: 19
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "20"
            xywh:
              - 2616
              - 2056
              - 200
              - 80
            value: Check pricebookId
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 20
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "21"
            xywh:
              - 3840
              - 3088
              - 200
              - 80
            value: Check numOfPricebookEntries > 0
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 21
      - ref: notification
        kind: prompt
        meta:
          name: ""
          visual:
            id: "22"
            xywh:
              - 2040
              - 3408
              - 200
              - 80
            value: 'הצלחה: ספר המחירים ייושם'
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - type: String
            value: הצלחה
            target: title
          - type: String
            value: ספר המחירים ייושם
            target: message
          - type: String
            value: הצלחה
            target: variant
        id: 22
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "23"
            xywh:
              - 2320
              - 3248
              - 200
              - 80
            value: Save Quote
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: record
        arguments:
          - expr: record
            type: ComposeRecord
            target: record
        id: 23
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "24"
            xywh:
              - 3232
              - 3088
              - 200
              - 80
            value: SSet line item product details
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: product.values.Description
            type: String
            target: lineItem.values.Description
        id: 24
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "25"
            xywh:
              - 2040
              - 3248
              - 200
              - 80
            value: Set Amount
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: quoteTotal
            type: Float
            target: record.values.TotalPrice
          - expr: quoteTotal
            type: Float
            target: record.values.Subtotal
        id: 25
      - ref: composeRecordsSearch
        kind: function
        meta:
          name: ""
          visual:
            id: "54"
            xywh:
              - 3600
              - 2760
              - 200
              - 80
            value: Fetch Pricebook entry
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: records
            target: pricebookEntries
          - expr: total
            target: numOfPricebookEntries
        arguments:
          - type: Handle
            value: PricebookEntry
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"PricebookId = " + pricebookId + " AND ProductId = " + lineItem.values.ProductId'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 54
      - ref: ""
        kind: continue
        meta:
          name: ""
          visual:
            id: "55"
            xywh:
              - 3560
              - 2920
              - 200
              - 80
            value: null
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 55
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "56"
            xywh:
              - 2880
              - 2920
              - 200
              - 80
            value: Set line item values
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'lineItem.values.Quantity ? lineItem.values.Quantity : 1'
            type: Float
            target: quantity
          - expr: 'lineItem.values.Discount ? lineItem.values.Discount : 0'
            type: Float
            target: discount
          - expr: 'pricebookEntry.values.UnitPrice ? pricebookEntry.values.UnitPrice : 0'
            type: Float
            target: listprice
          - expr: '(lineItem.values.UnitPrice ? false : true) ? listprice : (lineItem.values.UnitPrice ? lineItem.values.UnitPrice : 0)'
            type: Any
            target: unitprice
          - expr: unitprice * quantity
            type: Float
            target: subtotal
          - expr: subtotal - discount
            type: Float
            target: totalprice
          - expr: product.values.ProductCode
            type: String
            target: lineItem.values.ProductCode
          - expr: listprice
            type: Float
            target: lineItem.values.ListPrice
          - expr: unitprice
            type: Float
            target: lineItem.values.UnitPrice
          - expr: subtotal
            type: Float
            target: lineItem.values.Subtotal
          - expr: totalprice
            type: Float
            target: lineItem.values.TotalPrice
        id: 56
      - ref: excl
        kind: gateway
        meta:
          name: ""
          visual:
            id: "57"
            xywh:
              - 3840
              - 2760
              - 200
              - 80
            value: Check numOfPricebookEntries > 0
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments: []
        id: 57
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "58"
            xywh:
              - 3232
              - 2760
              - 200
              - 80
            value: Set included item product details
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: product.values.Description
            type: String
            target: lineItem.values.Description
          - expr: product.values.Name
            type: String
            target: lineItem.values.Name
        id: 58
      - ref: composeRecordsLookup
        kind: function
        meta:
          name: ""
          visual:
            id: "59"
            xywh:
              - 2880
              - 2760
              - 200
              - 80
            value: Fetch Product
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: product
        arguments:
          - type: Handle
            value: Product
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: lineItem.values.ProductId
            type: ID
            target: record
        id: 59
      - ref: composeRecordsUpdate
        kind: function
        meta:
          name: ""
          visual:
            id: "60"
            xywh:
              - 3160
              - 2920
              - 200
              - 80
            value: Save lineItem
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
        arguments:
          - expr: lineItem
            type: ComposeRecord
            target: record
        id: 60
      - ref: ""
        kind: expressions
        meta:
          name: ""
          visual:
            id: "61"
            xywh:
              - 2600
              - 2920
              - 200
              - 80
            value: Set pricebookEntry
            parent: "1"
            defaultName: false
          description: ""
        results: []
        arguments:
          - expr: 'numOfPricebookEntries > 0 ? pricebookEntries[0] : undefined'
            type: ComposeRecord
            target: pricebookEntry
        id: 61
      - ref: composeRecordsEach
        kind: iterator
        meta:
          name: ""
          visual:
            id: "62"
            xywh:
              - 2320
              - 2760
              - 200
              - 80
            value: Fetch Line tems
            parent: "1"
            defaultName: false
          description: ""
        results:
          - expr: record
            type: ComposeRecord
            target: lineItem
          - expr: index
            type: UnsignedInteger
            target: index
          - expr: total
            type: UnsignedInteger
            target: numOfLineItems
        arguments:
          - type: Handle
            value: QuoteLineItem
            target: module
          - type: Handle
            value: crm
            target: namespace
          - expr: '"QuoteId = " + record.recordID'
            type: String
            target: query
          - expr: "true"
            type: Boolean
            target: incTotal
        id: 62
    paths:
      - meta:
          name: ""
          visual:
            id: "29"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 5
        parentid: 4
      - expr: numOfPricebooks > 0
        meta:
          name: ""
          visual:
            id: "30"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Pricebook'
            parent: "1"
            points: []
          description: ""
        childid: 6
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "31"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No Pricebooks'
            parent: "1"
            points: []
          description: ""
        childid: 7
        parentid: 5
      - meta:
          name: ""
          visual:
            id: "32"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 10
        parentid: 6
      - expr: pricebookId != 0
        meta:
          name: ""
          visual:
            id: "33"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has Pricebook'
            parent: "1"
            points: []
          description: ""
        childid: 62
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "34"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No pricebook'
            parent: "1"
            points: []
          description: ""
        childid: 9
        parentid: 8
      - meta:
          name: ""
          visual:
            id: "35"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Iterate over included items
            parent: "1"
            points: []
          description: ""
        childid: 12
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "36"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 11
        parentid: 13
      - meta:
          name: ""
          visual:
            id: "37"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 25
        parentid: 11
      - meta:
          name: ""
          visual:
            id: "38"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 22
        parentid: 23
      - meta:
          name: ""
          visual:
            id: "39"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 14
        parentid: 22
      - meta:
          name: ""
          visual:
            id: "40"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 19
        parentid: 18
      - expr: pricebookId != 0
        meta:
          name: ""
          visual:
            id: "41"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;
            value: '#1 - Has pricebookId'
            parent: "1"
            points: []
          description: ""
        childid: 62
        parentid: 20
      - meta:
          name: ""
          visual:
            id: "42"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 8
        parentid: 10
      - meta:
          name: ""
          visual:
            id: "43"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No pricebookId'
            parent: "1"
            points: []
          description: ""
        childid: 4
        parentid: 20
      - expr: numOfPricebookEntries > 0
        meta:
          name: ""
          visual:
            id: "44"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has pricebook entries'
            parent: "1"
            points: []
          description: ""
        childid: 16
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "45"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No entry'
            parent: "1"
            points: []
          description: ""
        childid: 17
        parentid: 21
      - meta:
          name: ""
          visual:
            id: "46"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 18
        parentid: 16
      - meta:
          name: ""
          visual:
            id: "47"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 21
        parentid: 15
      - meta:
          name: ""
          visual:
            id: "48"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 20
        parentid: 3
      - meta:
          name: ""
          visual:
            id: "49"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 24
        parentid: 12
      - meta:
          name: ""
          visual:
            id: "50"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 15
        parentid: 24
      - meta:
          name: ""
          visual:
            id: "51"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 23
        parentid: 25
      - meta:
          name: ""
          visual:
            id: "64"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: Iterate over Lineitems
            parent: "1"
            points: []
          description: ""
        childid: 59
        parentid: 62
      - meta:
          name: ""
          visual:
            id: "65"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 60
        parentid: 56
      - expr: numOfPricebookEntries > 0
        meta:
          name: ""
          visual:
            id: "66"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: '#1 - Has pricebook entries'
            parent: "1"
            points: []
          description: ""
        childid: 61
        parentid: 57
      - meta:
          name: ""
          visual:
            id: "67"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;
            value: '#2 - No entry'
            parent: "1"
            points: []
          description: ""
        childid: 55
        parentid: 57
      - meta:
          name: ""
          visual:
            id: "68"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 56
        parentid: 61
      - meta:
          name: ""
          visual:
            id: "69"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 57
        parentid: 54
      - meta:
          name: ""
          visual:
            id: "70"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 58
        parentid: 59
      - meta:
          name: ""
          visual:
            id: "71"
            style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
            value: null
            parent: "1"
            points: []
          description: ""
        childid: 54
        parentid: 58
      - meta:
          name: ""
          visual:
            id: "72"
            style: exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;
            value: End
            parent: "1"
            points: []
          description: ""
        childid: 13
        parentid: 62
    triggers:
      - resourceType: compose:record
        eventType: onManual
        constraints:
          - op: =
            name: module.handle
            values:
              - Quote
          - op: =
            name: namespace.handle
            values:
              - crm
        enabled: true
        stepID: 3
        meta:
          visual:
            id: "27"
            xywh:
              - 2056
              - 2056
              - 200
              - 80
            edges:
              - meta:
                  label: ""
                  visual:
                    id: "53"
                    style: exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;
                    value: null
                    parent: "1"
                    points: []
                  description: ""
                childID: "3"
                parentID: "27"
            value: On Manual Quote
            parent: "1"
            defaultName: false
          description: ""
